{
  "lesson_id": "D2-LESSON-007",
  "domain": 2,
  "title": "Vulnerability Management",
  "objectives_covered": ["2.3"],
  "estimated_duration": "85-100 minutes (Core: 45 min, Deep Dives: 40-55 min)",
  "difficulty": "intermediate",
  "prerequisites": ["D2-LESSON-006"],
  "version": "2.0-enhanced",

  "introduction": {
    "hook": "The Equifax breach exposed 147 million Americans' data. The cause? A known vulnerability in Apache Struts with a patch available for two months before the breach. Most breaches don't exploit zero-days—they exploit known vulnerabilities organizations failed to remediate. Vulnerability management isn't glamorous, but it's one of the most effective security practices.",
    
    "learning_goals": [
      "Understand the vulnerability management lifecycle",
      "Interpret CVSS scores and risk-based prioritization",
      "Differentiate between scanning, penetration testing, and bug bounties",
      "Use vulnerability scanning tools effectively",
      "Apply context and asset criticality to prioritization",
      "Implement effective remediation strategies"
    ],
    
    "why_it_matters": "Every organization has vulnerabilities—the question is whether you find and fix them before attackers exploit them. Vulnerability management directly reduces risk. The Security+ exam tests this extensively—expect 6-8 questions.",
    
    "career_relevance": {
      "soc_analyst": "You'll review vulnerability scan results, validate findings, and prioritize what needs immediate attention. Understanding CVSS helps you communicate severity to stakeholders.",
      "incident_responder": "When investigating breaches, you'll determine if known vulnerabilities were exploited. Understanding what wasn't patched helps identify attack vectors.",
      "grc_analyst": "You'll assess vulnerability management program maturity, track remediation SLAs, and report metrics to leadership. Many compliance frameworks require vulnerability management.",
      "penetration_tester": "Your findings feed into vulnerability management. Understanding how organizations prioritize helps you communicate impact effectively.",
      "security_engineer": "You'll deploy and configure scanners, integrate with ticketing systems, and automate remediation workflows. Understanding the full lifecycle is essential."
    }
  },

  "linux_fundamentals": {
    "why_it_matters": "Vulnerability scanning and management require command-line proficiency.",
    
    "essential_commands": {
      "vulnerability_scanning": [
        {
          "command": "nmap scripts",
          "purpose": "Basic vulnerability detection",
          "examples": [
            "nmap --script vuln 192.168.1.100      # Run vuln scripts",
            "nmap --script=http-vuln* 192.168.1.100  # HTTP vulnerabilities"
          ]
        },
        {
          "command": "nikto",
          "purpose": "Web server vulnerability scanner",
          "example": "nikto -h https://target.com"
        }
      ],
      "package_management": [
        {
          "command": "apt / yum",
          "purpose": "Check for and apply updates",
          "examples": [
            "apt list --upgradable                  # Show available updates",
            "apt update && apt upgrade -y          # Apply updates",
            "apt-cache policy <package>            # Check installed version"
          ]
        },
        {
          "command": "Check CVE databases",
          "purpose": "Research specific vulnerabilities",
          "resources": ["NVD (nvd.nist.gov)", "CVE Details", "Exploit-DB"]
        }
      ]
    }
  },

  "sections": [
    {
      "section_id": "D2-L007-S01",
      "title": "Vulnerability Management Lifecycle",
      "estimated_time": "15 minutes",
      
      "content": {
        "overview": "Vulnerability management is the continuous process of identifying, evaluating, prioritizing, and addressing security weaknesses.",
        
        "lifecycle": [
          {
            "phase": "1. Discovery/Identification",
            "activities": ["Vulnerability scanning", "Penetration testing", "Bug bounties", "Code review", "Threat intelligence"],
            "goal": "Find vulnerabilities before attackers do"
          },
          {
            "phase": "2. Assessment/Analysis",
            "activities": ["Validate findings (reduce false positives)", "Determine severity", "Assess exploitability", "Identify affected systems"],
            "goal": "Understand true risk"
          },
          {
            "phase": "3. Prioritization",
            "activities": ["Consider asset criticality", "Evaluate threat context", "Assess exposure", "Apply risk-based ranking"],
            "goal": "Focus on what matters most"
          },
          {
            "phase": "4. Remediation",
            "options": [
              {"option": "Patch", "description": "Apply vendor fix (preferred)"},
              {"option": "Mitigate", "description": "Reduce risk without full fix"},
              {"option": "Compensating Control", "description": "Alternative protection"},
              {"option": "Accept", "description": "Document and accept risk"}
            ],
            "goal": "Eliminate or reduce vulnerability"
          },
          {
            "phase": "5. Verification",
            "activities": ["Re-scan to confirm fix", "Validate remediation effective", "Close tickets"],
            "goal": "Confirm vulnerability resolved"
          },
          {
            "phase": "6. Reporting",
            "activities": ["Track metrics", "Report to stakeholders", "Identify trends", "Measure program effectiveness"],
            "goal": "Demonstrate value and improvement"
          }
        ],
        
        "discovery_methods": [
          {
            "method": "Vulnerability Scanning",
            "description": "Automated tools identify known vulnerabilities",
            "types": [
              {"type": "Non-credentialed", "description": "External view, limited depth"},
              {"type": "Credentialed/Authenticated", "description": "Logs in, deeper analysis"}
            ],
            "frequency": "Weekly to monthly for most assets"
          },
          {
            "method": "Penetration Testing",
            "description": "Human testers attempt to exploit vulnerabilities",
            "value": "Validates exploitability, finds business logic flaws",
            "frequency": "Annually or after major changes"
          },
          {
            "method": "Bug Bounty",
            "description": "Pay external researchers for valid findings",
            "value": "Continuous testing by diverse researchers",
            "consideration": "Requires mature security program"
          }
        ],
        
        "key_metrics": [
          {"metric": "Mean Time to Remediate (MTTR)", "description": "Average time from discovery to fix", "goal": "Reduce over time"},
          {"metric": "Vulnerability Density", "description": "Vulnerabilities per system/application", "goal": "Reduce over time"},
          {"metric": "Scan Coverage", "description": "Percentage of assets scanned", "goal": ">95%"},
          {"metric": "SLA Compliance", "description": "Percent remediated within target time", "goal": ">90%"},
          {"metric": "Exception Rate", "description": "Vulnerabilities accepted vs fixed", "goal": "Minimize"}
        ],
        
        "visualization": {
          "type": "ascii_diagram",
          "title": "Vulnerability Management Lifecycle",
          "diagram": [
            "╔══════════════════════════════════════════════════════════════════════════════╗",
            "║              VULNERABILITY MANAGEMENT LIFECYCLE                              ║",
            "╠══════════════════════════════════════════════════════════════════════════════╣",
            "║                                                                               ║",
            "║      ┌────────────┐        ┌────────────┐        ┌────────────┐             ║",
            "║      │  DISCOVER  │───────▶│   ASSESS   │───────▶│ PRIORITIZE │             ║",
            "║      │  (Scan)    │        │ (Validate) │        │  (Rank)    │             ║",
            "║      └────────────┘        └────────────┘        └─────┬──────┘             ║",
            "║           ▲                                            │                     ║",
            "║           │                                            ▼                     ║",
            "║      ┌────┴───────┐        ┌────────────┐        ┌────────────┐             ║",
            "║      │   REPORT   │◀───────│   VERIFY   │◀───────│ REMEDIATE  │             ║",
            "║      │ (Metrics)  │        │ (Re-scan)  │        │  (Fix)     │             ║",
            "║      └────────────┘        └────────────┘        └────────────┘             ║",
            "║                                                                               ║",
            "║   REMEDIATION OPTIONS:                                                       ║",
            "║   ┌─────────┬─────────────┬─────────────────────┬────────────────┐         ║",
            "║   │  PATCH  │  MITIGATE   │ COMPENSATING CONTROL│    ACCEPT      │         ║",
            "║   │ (Best)  │ (Reduce)    │ (Alternative)       │ (Document)     │         ║",
            "║   └─────────┴─────────────┴─────────────────────┴────────────────┘         ║",
            "║                                                                               ║",
            "╚══════════════════════════════════════════════════════════════════════════════╝"
          ]
        }
      },
      
      "key_points": [
        "Lifecycle: Discover → Assess → Prioritize → Remediate → Verify → Report",
        "Credentialed scans provide deeper insight than non-credentialed",
        "Penetration testing validates exploitability; scanning finds known issues",
        "Key metrics: MTTR, vulnerability density, scan coverage, SLA compliance",
        "Goal: continuous improvement in finding and fixing before exploitation"
      ],
      
      "exam_tips": [
        "Know the lifecycle phases in order",
        "Credentialed scan = authenticated, more thorough",
        "Penetration testing validates exploitability manually",
        "Bug bounty = pay external researchers",
        "MTTR = Mean Time to Remediate"
      ],
      
      "glossary_terms": [
        {
          "term": "Vulnerability Scanning",
          "definition": "Automated process of identifying known security weaknesses in systems and applications.",
          "exam_note": "Credentialed (authenticated) scans are more thorough."
        },
        {
          "term": "Penetration Testing",
          "definition": "Authorized simulated attack to identify exploitable vulnerabilities and assess security controls.",
          "exam_note": "Human testers; validates exploitability; finds logic flaws."
        }
      ]
    },

    {
      "section_id": "D2-L007-S02",
      "title": "CVSS and Vulnerability Scoring",
      "estimated_time": "15 minutes",
      
      "content": {
        "overview": "The Common Vulnerability Scoring System (CVSS) provides a standardized way to assess vulnerability severity. Understanding CVSS helps prioritize remediation efforts.",
        
        "cvss_overview": {
          "description": "Industry standard for vulnerability severity scoring",
          "current_version": "CVSS v3.1 (CVSS 4.0 released 2023)",
          "score_range": "0.0 to 10.0",
          "severity_ratings": [
            {"range": "0.0", "rating": "None"},
            {"range": "0.1-3.9", "rating": "Low"},
            {"range": "4.0-6.9", "rating": "Medium"},
            {"range": "7.0-8.9", "rating": "High"},
            {"range": "9.0-10.0", "rating": "Critical"}
          ]
        },
        
        "cvss_metric_groups": [
          {
            "group": "Base Score",
            "description": "Intrinsic characteristics of vulnerability",
            "metrics": {
              "exploitability": [
                {"metric": "Attack Vector (AV)", "values": "Network, Adjacent, Local, Physical", "note": "Network = worst"},
                {"metric": "Attack Complexity (AC)", "values": "Low, High", "note": "Low = easier to exploit"},
                {"metric": "Privileges Required (PR)", "values": "None, Low, High", "note": "None = worst"},
                {"metric": "User Interaction (UI)", "values": "None, Required", "note": "None = worse"}
              ],
              "impact": [
                {"metric": "Confidentiality Impact (C)", "values": "None, Low, High"},
                {"metric": "Integrity Impact (I)", "values": "None, Low, High"},
                {"metric": "Availability Impact (A)", "values": "None, Low, High"}
              ],
              "scope": {"metric": "Scope (S)", "values": "Unchanged, Changed", "note": "Changed = affects other components"}
            }
          },
          {
            "group": "Temporal Score",
            "description": "Changes over time",
            "metrics": [
              {"metric": "Exploit Code Maturity", "description": "Is exploit code available?"},
              {"metric": "Remediation Level", "description": "Is there a fix?"},
              {"metric": "Report Confidence", "description": "How reliable is the report?"}
            ]
          },
          {
            "group": "Environmental Score",
            "description": "Organization-specific context",
            "metrics": [
              {"metric": "Modified Base Metrics", "description": "Adjust for your environment"},
              {"metric": "Confidentiality/Integrity/Availability Requirements", "description": "How important is each for this asset?"}
            ]
          }
        ],
        
        "cvss_examples": [
          {
            "vulnerability": "Remote Code Execution, no auth required",
            "vector_string": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
            "score": "9.8 Critical",
            "analysis": "Network accessible, low complexity, no privileges, no interaction, high impact across CIA"
          },
          {
            "vulnerability": "Local privilege escalation requiring user click",
            "vector_string": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
            "score": "7.8 High",
            "analysis": "Local only, requires user interaction, but complete system compromise possible"
          },
          {
            "vulnerability": "Information disclosure, limited data",
            "vector_string": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
            "score": "5.3 Medium",
            "analysis": "Network accessible but only low confidentiality impact"
          }
        ],
        
        "beyond_cvss": {
          "description": "CVSS alone isn't enough for prioritization",
          "additional_factors": [
            {"factor": "Asset Criticality", "question": "How important is this system?"},
            {"factor": "Exposure", "question": "Internet-facing or internal?"},
            {"factor": "Exploit Availability", "question": "Is it being exploited in the wild?"},
            {"factor": "Compensating Controls", "question": "What else protects this?"},
            {"factor": "Business Context", "question": "What's the business impact?"}
          ],
          "frameworks": ["EPSS (Exploit Prediction Scoring System)", "CISA KEV (Known Exploited Vulnerabilities)", "Vendor severity ratings"]
        }
      },
      
      "key_points": [
        "CVSS provides standardized severity scoring (0-10)",
        "Critical: 9.0-10.0; High: 7.0-8.9; Medium: 4.0-6.9; Low: 0.1-3.9",
        "Base score = intrinsic characteristics; Temporal = changes over time",
        "Environmental score = organization-specific context",
        "CVSS alone isn't enough—consider asset criticality and threat context"
      ],
      
      "exam_tips": [
        "Know CVSS severity ranges (Critical ≥9.0, High ≥7.0, Medium ≥4.0)",
        "Base metrics: AV, AC, PR, UI, S, C, I, A",
        "Attack Vector: Network is most severe",
        "Privileges Required: None is most severe",
        "Environmental score adjusts for your specific context"
      ],
      
      "career_callout": {
        "role": "SOC Analyst",
        "note": "Don't just look at CVSS—a 9.8 on an isolated test server matters less than a 7.0 on your internet-facing customer database. Always consider: Is it exploited in the wild? What asset is affected? What compensating controls exist?"
      },
      
      "knowledge_check": {
        "question": "A vulnerability has CVSS base score of 9.8 (Critical). However, it's on a standalone test server with no sensitive data and no network connectivity. How should this be prioritized?",
        "options": [
          "Immediate remediation—9.8 is Critical",
          "High priority—Critical vulnerabilities always come first",
          "Lower priority—environmental context reduces actual risk",
          "No action needed—test servers don't matter"
        ],
        "correct": 2,
        "explanation": "Environmental context matters. While the base CVSS is Critical, the actual risk is reduced because: isolated system (no network attack path), no sensitive data (impact limited), test server (business impact low). The environmental score would be much lower. However, it should still be tracked and remediated, not ignored."
      }
    },

    {
      "section_id": "D2-L007-S03",
      "title": "Scanning and Remediation",
      "estimated_time": "12 minutes",
      
      "content": {
        "overview": "Effective vulnerability management requires proper scanning configuration and disciplined remediation processes.",
        
        "scanning_types": [
          {
            "type": "Non-Credentialed (Unauthenticated)",
            "description": "Scanner doesn't log into target",
            "pros": ["Easy to deploy", "No credential management", "External attacker view"],
            "cons": ["Limited visibility", "More false positives/negatives", "Can't see patch levels"],
            "use_case": "External perspective, internet-facing assets"
          },
          {
            "type": "Credentialed (Authenticated)",
            "description": "Scanner logs into target with valid credentials",
            "pros": ["Deep visibility", "Accurate patch detection", "Fewer false positives"],
            "cons": ["Credential management", "More complex setup"],
            "use_case": "Internal systems, accurate patch compliance"
          },
          {
            "type": "Agent-Based",
            "description": "Software agent installed on endpoints",
            "pros": ["Real-time visibility", "Works for mobile/remote", "No credential exposure"],
            "cons": ["Agent deployment required", "Resource usage"],
            "use_case": "Endpoints, remote workers"
          }
        ],
        
        "remediation_strategies": [
          {
            "strategy": "Patching",
            "description": "Apply vendor-provided fix",
            "status": "Preferred method",
            "considerations": ["Test before production", "Change management", "Rollback plan"]
          },
          {
            "strategy": "Workaround/Mitigation",
            "description": "Reduce risk without full patch",
            "examples": ["Disable vulnerable feature", "Restrict access", "Block exploit path"],
            "when": "Patch not available or not immediately deployable"
          },
          {
            "strategy": "Compensating Control",
            "description": "Alternative control that addresses risk",
            "examples": ["WAF rule", "Network segmentation", "Enhanced monitoring"],
            "when": "Patching not possible, long-term mitigation needed"
          },
          {
            "strategy": "Risk Acceptance",
            "description": "Formally accept the risk without remediation",
            "requirements": ["Documented justification", "Management approval", "Periodic review"],
            "when": "Risk is acceptable given business context"
          }
        ],
        
        "remediation_slas": {
          "description": "Target timeframes for remediation by severity",
          "example_slas": [
            {"severity": "Critical", "target": "24-72 hours", "note": "Exploited in wild = immediate"},
            {"severity": "High", "target": "7-14 days"},
            {"severity": "Medium", "target": "30-60 days"},
            {"severity": "Low", "target": "90 days or next maintenance window"}
          ]
        }
      },
      
      "key_points": [
        "Credentialed scans are more accurate than non-credentialed",
        "Agent-based scanning works for mobile/remote endpoints",
        "Patching is preferred; compensating controls when patching isn't possible",
        "Risk acceptance requires documentation and management approval",
        "SLAs should be based on severity and business context"
      ],
      
      "deep_dive": {
        "title": "Vulnerability Scanning with Open Source Tools",
        "estimated_time": "20 minutes",
        "content": {
          "description": "Learn to use free tools for vulnerability discovery.",
          
          "lab_nmap_vuln": {
            "title": "Lab: Basic Vulnerability Scanning with Nmap",
            "objective": "Use Nmap scripts to identify vulnerabilities",
            "warning": "Only scan systems you own or have permission to test!",
            "steps": [
              {
                "step": 1,
                "action": "Basic vulnerability scan",
                "command": "nmap --script vuln 192.168.1.100",
                "note": "Runs all scripts in 'vuln' category"
              },
              {
                "step": 2,
                "action": "Specific vulnerability checks",
                "commands": [
                  "nmap --script smb-vuln* 192.168.1.100    # SMB vulnerabilities",
                  "nmap --script http-vuln* 192.168.1.100   # Web vulnerabilities",
                  "nmap --script ssl* 192.168.1.100         # SSL/TLS issues"
                ]
              },
              {
                "step": 3,
                "action": "Web server scanning with Nikto",
                "commands": [
                  "nikto -h http://192.168.1.100",
                  "nikto -h https://192.168.1.100 -ssl"
                ]
              }
            ]
          },
          
          "lab_openvas": {
            "title": "Lab: Full Vulnerability Scanning with OpenVAS",
            "objective": "Deploy open-source vulnerability scanner",
            "steps": [
              {
                "step": 1,
                "action": "Install OpenVAS (Greenbone)",
                "commands": [
                  "# On Kali Linux:",
                  "sudo apt install gvm",
                  "sudo gvm-setup",
                  "sudo gvm-start"
                ]
              },
              {
                "step": 2,
                "action": "Access web interface",
                "url": "https://localhost:9392",
                "note": "Default credentials shown after setup"
              },
              {
                "step": 3,
                "action": "Create and run scan",
                "process": ["Add target", "Select scan config", "Run scan", "Review results"]
              }
            ]
          }
        }
      },
      
      "exam_tips": [
        "Credentialed = authenticated, more thorough",
        "Agent-based = software on endpoint, works for remote",
        "Compensating control = alternative when patching not possible",
        "Risk acceptance = documented decision with management approval",
        "SLAs typically: Critical 24-72hr, High 7-14 days, Medium 30-60 days"
      ]
    }
  ],

  "tool_spotlights": {
    "tools": [
      {
        "name": "Nessus",
        "category": "Vulnerability Scanner",
        "description": "Industry-leading vulnerability scanner",
        "free_tier": "Nessus Essentials (limited)",
        "url": "https://www.tenable.com/products/nessus",
        "career_relevance": "Most common enterprise scanner"
      },
      {
        "name": "OpenVAS/Greenbone",
        "category": "Vulnerability Scanner",
        "description": "Open-source vulnerability assessment",
        "free_tier": "Completely free",
        "url": "https://www.greenbone.net/en/",
        "career_relevance": "Free alternative for learning"
      },
      {
        "name": "Qualys",
        "category": "Cloud Vulnerability Management",
        "description": "Cloud-based VM platform",
        "free_tier": "Community Edition",
        "url": "https://www.qualys.com",
        "career_relevance": "Major enterprise platform"
      },
      {
        "name": "CVSS Calculator",
        "category": "Scoring Tool",
        "description": "Calculate CVSS scores",
        "free_tier": "Free",
        "url": "https://www.first.org/cvss/calculator/3.1",
        "career_relevance": "Understanding scoring"
      }
    ]
  },

  "summary": {
    "key_takeaways": [
      "Lifecycle: Discover → Assess → Prioritize → Remediate → Verify → Report",
      "CVSS provides standardized scoring (Critical ≥9.0, High ≥7.0, Medium ≥4.0)",
      "Credentialed scans are more thorough than non-credentialed",
      "Prioritization needs context: CVSS + asset criticality + threat intelligence",
      "Patching preferred; compensating controls when patching isn't possible",
      "Risk acceptance requires documentation and approval",
      "Key metrics: MTTR, scan coverage, vulnerability density"
    ],
    
    "exam_essentials": [
      "Know vulnerability management lifecycle phases",
      "CVSS severity ranges and key metrics (AV, AC, PR, UI)",
      "Credentialed vs non-credentialed scanning",
      "Penetration testing vs vulnerability scanning",
      "Compensating controls vs risk acceptance"
    ],
    
    "skills_gained": [
      "Interpret CVSS scores and vector strings",
      "Use nmap vuln scripts for basic scanning",
      "Prioritize vulnerabilities using context",
      "Understand remediation options and SLAs"
    ],
    
    "connection_to_next": "Vulnerability management finds weaknesses. The next lesson covers Indicators of Compromise and Detection—how to identify when vulnerabilities have been exploited and attackers are in your environment."
  },

  "related_content": {
    "simulations": ["D2-SIM-002"],
    "remediation": ["D2-REM-003"],
    "next_lesson": "D2-LESSON-008",
    "previous_lesson": "D2-LESSON-006"
  }
}
