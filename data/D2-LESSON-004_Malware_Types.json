{
  "lesson_id": "D2-LESSON-004",
  "domain": 2,
  "title": "Malware Types and Characteristics",
  "objectives_covered": ["2.4"],
  "estimated_duration": "90-105 minutes (Core: 50 min, Deep Dives: 40-55 min)",
  "difficulty": "intermediate",
  "prerequisites": ["D2-LESSON-002", "D2-LESSON-003"],
  "version": "2.0-enhanced",

  "introduction": {
    "hook": "In May 2017, the WannaCry ransomware infected 230,000 computers across 150 countries in just four days. Hospitals cancelled surgeries. Factories stopped production. A global shipping company lost $300 million. All from a single piece of malware that combined a worm's self-spreading capability with ransomware's encryption payload. Malware—malicious software—is the weapon threat actors use to achieve their objectives. Understanding malware types, behaviors, and indicators is essential for detecting and defending against attacks.",
    
    "learning_goals": [
      "Classify malware by type, propagation method, and payload",
      "Differentiate between viruses, worms, trojans, ransomware, and other types",
      "Identify indicators of malware infection in systems and networks",
      "Analyze malware capabilities including persistence, evasion, and C2",
      "Use tools to safely analyze suspicious files and behavior",
      "Apply appropriate detection and prevention controls"
    ],
    
    "why_it_matters": "Every security professional encounters malware—in incident response, threat analysis, or security operations. Understanding malware helps you recognize infections, design effective defenses, and communicate about threats precisely. The Security+ exam tests malware comprehensively—expect 8-10 questions.",
    
    "career_relevance": {
      "soc_analyst": "You'll triage malware alerts daily. Understanding malware types helps you assess severity and urgency. Is it ransomware (critical)? Cryptominer (medium)? Knowing indicators helps you quickly identify affected systems.",
      "incident_responder": "You'll analyze malware to understand attacker capabilities, identify IOCs for hunting, and determine remediation steps. Knowing persistence mechanisms tells you what to clean.",
      "grc_analyst": "Understanding malware trends helps you assess organizational risk and justify security investments. Ransomware risk drives backup investments; APT malware drives detection investments.",
      "penetration_tester": "Red teams may use or simulate malware capabilities. Understanding evasion techniques helps you test security controls realistically.",
      "security_engineer": "You'll configure anti-malware, EDR, and email security. Understanding malware behavior helps you tune detection rules and reduce false positives."
    }
  },

  "linux_fundamentals": {
    "why_it_matters": "Malware analysis and detection require understanding system behavior. These commands help identify suspicious activity.",
    
    "essential_commands": {
      "process_investigation": [
        {
          "command": "ps",
          "purpose": "List running processes",
          "examples": [
            "ps aux                            # All processes with details",
            "ps aux --forest                   # Show process tree",
            "ps aux | grep -v '\\[' | sort -nrk 3 | head  # High CPU processes"
          ]
        },
        {
          "command": "top / htop",
          "purpose": "Real-time process monitoring",
          "suspicious_signs": ["Unusual high CPU", "Unknown process names", "Processes from /tmp"]
        },
        {
          "command": "lsof",
          "purpose": "List open files and network connections",
          "examples": [
            "lsof -i                           # Network connections",
            "lsof -p <PID>                     # Files opened by process",
            "lsof -i :443                      # What's using port 443"
          ]
        }
      ],
      "network_investigation": [
        {
          "command": "netstat / ss",
          "purpose": "Network connections",
          "examples": [
            "ss -tupn                          # TCP/UDP with process",
            "ss -tupn | grep ESTABLISHED       # Active connections",
            "netstat -an | grep LISTEN         # Listening ports"
          ]
        },
        {
          "command": "tcpdump",
          "purpose": "Capture network traffic",
          "examples": [
            "sudo tcpdump -i eth0 -w capture.pcap",
            "sudo tcpdump -i eth0 port 443"
          ]
        }
      ],
      "file_analysis": [
        {
          "command": "file",
          "purpose": "Identify file type",
          "example": "file suspicious.exe              # May show 'PE32 executable'"
        },
        {
          "command": "strings",
          "purpose": "Extract readable strings from binary",
          "examples": [
            "strings suspicious.exe | head -50",
            "strings suspicious.exe | grep -i 'http\\|password\\|c2'"
          ]
        },
        {
          "command": "md5sum / sha256sum",
          "purpose": "Generate file hash for IOC lookup",
          "examples": [
            "sha256sum suspicious.exe",
            "# Look up hash on VirusTotal"
          ]
        }
      ],
      "persistence_hunting": [
        {
          "command": "Check cron jobs",
          "examples": [
            "crontab -l                        # Current user cron",
            "sudo ls -la /etc/cron*            # System cron directories",
            "cat /etc/crontab"
          ]
        },
        {
          "command": "Check startup locations",
          "examples": [
            "ls -la ~/.config/autostart/",
            "systemctl list-unit-files --type=service | grep enabled"
          ]
        }
      ]
    }
  },

  "sections": [
    {
      "section_id": "D2-L004-S01",
      "title": "Malware Classification",
      "estimated_time": "15 minutes",
      
      "content": {
        "overview": "Malware is classified by three dimensions: what it is (type), how it spreads (propagation), and what it does (payload).",
        
        "malware_types": [
          {
            "type": "Virus",
            "description": "Malicious code that attaches to host files and self-replicates",
            "key_characteristic": "Requires host file/program to execute",
            "propagation": "Spreads when infected files are shared or executed",
            "subtypes": [
              {"name": "File Infector", "description": "Attaches to executable files"},
              {"name": "Boot Sector", "description": "Infects disk boot sector"},
              {"name": "Macro Virus", "description": "Uses document macros (Office)"},
              {"name": "Polymorphic", "description": "Changes code to avoid detection"}
            ],
            "example": "Melissa virus (1999) spread via infected Word documents"
          },
          {
            "type": "Worm",
            "description": "Self-replicating malware that spreads across networks",
            "key_characteristic": "Self-propagates WITHOUT host file or user action",
            "propagation": "Exploits vulnerabilities to spread automatically",
            "examples": [
              {"name": "WannaCry", "description": "Exploited EternalBlue (SMB), 2017"},
              {"name": "Conficker", "description": "Exploited Windows vulnerability, 2008"},
              {"name": "Code Red", "description": "Exploited IIS vulnerability, 2001"}
            ],
            "danger": "Can spread rapidly without user interaction"
          },
          {
            "type": "Trojan",
            "description": "Malware disguised as legitimate software",
            "key_characteristic": "Appears harmless but contains malicious payload",
            "propagation": "User downloads/installs thinking it's legitimate",
            "subtypes": [
              {"name": "RAT (Remote Access Trojan)", "description": "Provides remote control"},
              {"name": "Banking Trojan", "description": "Steals financial credentials"},
              {"name": "Downloader", "description": "Downloads additional malware"},
              {"name": "Dropper", "description": "Drops/installs other malware"}
            ],
            "note": "Does NOT self-replicate (unlike viruses/worms)"
          },
          {
            "type": "Ransomware",
            "description": "Encrypts files and demands payment for decryption",
            "key_characteristic": "Holds data hostage for ransom",
            "propagation": "Phishing, exploits, RDP brute force",
            "evolution": [
              {"era": "Early", "behavior": "Simple file encryption"},
              {"era": "Modern", "behavior": "Double extortion (encrypt + threaten leak)"},
              {"era": "Current", "behavior": "Triple extortion (+ DDoS, + notify customers)"}
            ],
            "examples": ["LockBit", "BlackCat/ALPHV", "Cl0p", "Ryuk"],
            "critical_defense": "Offline backups, tested restore procedures"
          },
          {
            "type": "Rootkit",
            "description": "Malware designed to hide itself and other malware",
            "key_characteristic": "Operates at low level to avoid detection",
            "levels": [
              {"level": "User-mode", "description": "Hooks user-level APIs"},
              {"level": "Kernel-mode", "description": "Modifies OS kernel"},
              {"level": "Bootkit", "description": "Infects boot process"},
              {"level": "Firmware", "description": "Infects BIOS/UEFI"}
            ],
            "detection": "Difficult—may require boot from clean media",
            "example": "Sony BMG rootkit (2005) hid copy protection software"
          },
          {
            "type": "Spyware",
            "description": "Software that monitors and collects user activity",
            "key_characteristic": "Surveillance and data theft",
            "subtypes": [
              {"name": "Keylogger", "description": "Records keystrokes"},
              {"name": "Screen Capture", "description": "Takes screenshots"},
              {"name": "Adware", "description": "Displays unwanted ads, tracks browsing"},
              {"name": "Stalkerware", "description": "Monitors device location and activity"}
            ]
          },
          {
            "type": "Logic Bomb",
            "description": "Malware triggered by specific conditions",
            "key_characteristic": "Dormant until trigger condition met",
            "triggers": ["Specific date/time", "User action", "File deletion", "System state"],
            "example": "Disgruntled employee plants code to delete data after termination"
          },
          {
            "type": "Cryptominer",
            "description": "Uses victim's resources to mine cryptocurrency",
            "key_characteristic": "High CPU/GPU usage, increased power consumption",
            "impact": "Performance degradation, increased costs, hardware wear",
            "also_called": "Cryptojacker"
          },
          {
            "type": "Botnet",
            "description": "Network of compromised computers controlled by attacker",
            "key_characteristic": "Centralized or P2P control of many machines",
            "uses": ["DDoS attacks", "Spam distribution", "Credential stuffing", "Cryptomining"],
            "components": {
              "bot": "Individual infected machine",
              "botnet": "Collection of bots",
              "bot_herder": "Attacker controlling botnet",
              "c2": "Command and control infrastructure"
            }
          },
          {
            "type": "Fileless Malware",
            "description": "Operates entirely in memory without writing to disk",
            "key_characteristic": "No malware files to detect",
            "techniques": [
              "Living-off-the-land (uses legitimate tools like PowerShell)",
              "Process injection",
              "Registry-resident payloads",
              "WMI event subscriptions"
            ],
            "detection": "Requires behavioral analysis, EDR, memory forensics"
          }
        ],
        
        "visualization": {
          "type": "ascii_diagram",
          "title": "Malware Type Comparison",
          "diagram": [
            "╔══════════════════════════════════════════════════════════════════════════════╗",
            "║                        MALWARE TYPE COMPARISON                               ║",
            "╠══════════════════════════════════════════════════════════════════════════════╣",
            "║                                                                               ║",
            "║   TYPE          SELF-REPLICATES?    NEEDS HOST?    KEY CHARACTERISTIC        ║",
            "║   ════          ════════════════    ═══════════    ════════════════════      ║",
            "║                                                                               ║",
            "║   Virus         Yes                 Yes            Attaches to files          ║",
            "║   Worm          Yes                 NO             Network propagation        ║",
            "║   Trojan        NO                  Disguised      Appears legitimate         ║",
            "║   Ransomware    Sometimes           No             Encrypts for ransom        ║",
            "║   Rootkit       No                  No             Hides itself/other malware ║",
            "║   Spyware       No                  No             Monitors/steals data       ║",
            "║   Botnet        Via bot malware     No             Central control of many    ║",
            "║   Fileless      No                  No             Memory-only, no files      ║",
            "║                                                                               ║",
            "║   ┌──────────────────────────────────────────────────────────────────────┐   ║",
            "║   │  KEY EXAM DISTINCTION:                                               │   ║",
            "║   │  • VIRUS needs host file, WORM doesn't                               │   ║",
            "║   │  • TROJAN doesn't self-replicate (user must download/run)            │   ║",
            "║   │  • ROOTKIT hides, RANSOMWARE encrypts, SPYWARE monitors              │   ║",
            "║   └──────────────────────────────────────────────────────────────────────┘   ║",
            "║                                                                               ║",
            "╚══════════════════════════════════════════════════════════════════════════════╝"
          ]
        }
      },
      
      "key_points": [
        "Virus requires host file and user action; Worm spreads automatically",
        "Trojan disguises as legitimate software; does NOT self-replicate",
        "Ransomware encrypts files; modern variants also threaten data leaks",
        "Rootkits hide at OS/kernel level; very difficult to detect",
        "Fileless malware operates in memory without files on disk"
      ],
      
      "exam_tips": [
        "VIRUS needs host file; WORM doesn't (key distinction!)",
        "TROJAN = disguised as legitimate; doesn't self-replicate",
        "RAT = Remote Access Trojan (remote control capability)",
        "Logic bomb = triggered by specific condition",
        "Fileless = memory-only, uses legitimate tools (LOLBins)"
      ],
      
      "glossary_terms": [
        {
          "term": "Virus",
          "definition": "Malicious code that attaches to host files and self-replicates when executed.",
          "exam_note": "Requires host file. Spreads when infected files are shared."
        },
        {
          "term": "Worm",
          "definition": "Self-replicating malware that spreads across networks without user action.",
          "exam_note": "NO host needed. Exploits vulnerabilities to spread automatically."
        },
        {
          "term": "Trojan",
          "definition": "Malware disguised as legitimate software to trick users into installing.",
          "exam_note": "Does NOT self-replicate. User must download/install."
        },
        {
          "term": "Rootkit",
          "definition": "Malware designed to hide itself and other malware at a low system level.",
          "exam_note": "Can be user-mode, kernel-mode, or bootkit. Hard to detect."
        },
        {
          "term": "RAT",
          "definition": "Remote Access Trojan - provides attacker with remote control of victim system.",
          "exam_note": "Common in targeted attacks. Provides backdoor access."
        }
      ],
      
      "knowledge_check": {
        "question": "Malware spreads rapidly across a network by exploiting an unpatched vulnerability in Windows SMB, without any user interaction. What type of malware is this?",
        "options": [
          "Virus",
          "Worm",
          "Trojan",
          "Logic Bomb"
        ],
        "correct": 1,
        "explanation": "This is a worm. Key indicators: spreads across network, exploits vulnerability, no user interaction required. Viruses require host files and user action. Trojans don't self-propagate. Logic bombs wait for triggers, don't spread. WannaCry is a famous example of this behavior."
      }
    },

    {
      "section_id": "D2-L004-S02",
      "title": "Malware Capabilities and Behaviors",
      "estimated_time": "15 minutes",
      
      "content": {
        "overview": "Beyond classification, understanding malware capabilities helps with detection and response. Key capabilities include persistence, evasion, and command-and-control.",
        
        "malware_lifecycle": {
          "stages": [
            {
              "stage": "1. Delivery",
              "description": "Malware arrives at target",
              "methods": ["Phishing email", "Malicious website", "USB drive", "Exploit kit", "Supply chain"]
            },
            {
              "stage": "2. Exploitation",
              "description": "Malware gains execution",
              "methods": ["User opens file", "Vulnerability exploited", "Macro execution", "Drive-by download"]
            },
            {
              "stage": "3. Installation",
              "description": "Malware establishes foothold",
              "activities": ["Write to disk/memory", "Modify system config", "Prepare persistence"]
            },
            {
              "stage": "4. Command & Control (C2)",
              "description": "Malware connects to attacker",
              "activities": ["Beacon to C2 server", "Receive instructions", "Exfiltrate data"]
            },
            {
              "stage": "5. Actions on Objectives",
              "description": "Attacker achieves goals",
              "activities": ["Steal data", "Encrypt files", "Move laterally", "Deploy ransomware"]
            }
          ]
        },
        
        "persistence_mechanisms": {
          "description": "How malware survives reboots and attempts to remove it",
          "windows_persistence": [
            {"mechanism": "Registry Run Keys", "location": "HKCU/HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"},
            {"mechanism": "Scheduled Tasks", "detection": "schtasks /query"},
            {"mechanism": "Services", "detection": "sc query, Get-Service"},
            {"mechanism": "Startup Folder", "location": "%AppData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup"},
            {"mechanism": "WMI Event Subscription", "description": "Triggers on system events"},
            {"mechanism": "DLL Hijacking", "description": "Legitimate apps load malicious DLLs"}
          ],
          "linux_persistence": [
            {"mechanism": "Cron Jobs", "location": "/etc/cron*, crontab -l"},
            {"mechanism": "Systemd Services", "location": "/etc/systemd/system/"},
            {"mechanism": "Shell RC Files", "location": ".bashrc, .profile"},
            {"mechanism": "SSH Keys", "location": "~/.ssh/authorized_keys"}
          ]
        },
        
        "evasion_techniques": [
          {
            "technique": "Obfuscation",
            "description": "Make code difficult to analyze",
            "methods": ["Encoded strings", "Packed executables", "Encrypted payloads"]
          },
          {
            "technique": "Polymorphism",
            "description": "Code changes each infection to avoid signatures",
            "result": "Each copy has different hash"
          },
          {
            "technique": "Metamorphism",
            "description": "Complete code rewrite while maintaining function",
            "result": "More advanced than polymorphism"
          },
          {
            "technique": "Fileless Techniques",
            "description": "Operate in memory without files on disk",
            "methods": ["PowerShell in memory", "Process injection", "Living-off-the-land"]
          },
          {
            "technique": "Sandbox Evasion",
            "description": "Detect analysis environments and behave differently",
            "checks": ["Low RAM/CPU", "VM artifacts", "Mouse movement", "Time acceleration"]
          },
          {
            "technique": "Process Injection",
            "description": "Hide in legitimate processes",
            "targets": ["explorer.exe", "svchost.exe", "browsers"]
          }
        ],
        
        "c2_communication": {
          "description": "How malware communicates with attackers",
          "methods": [
            {"method": "HTTP/HTTPS", "description": "Blends with normal web traffic", "prevalence": "Most common"},
            {"method": "DNS Tunneling", "description": "Encodes data in DNS queries", "advantage": "Often allowed through firewalls"},
            {"method": "Domain Generation Algorithm (DGA)", "description": "Generates random C2 domains daily", "purpose": "Resilient to domain takedowns"},
            {"method": "Social Media", "description": "Uses Twitter, Pastebin for commands", "advantage": "Legitimate services hard to block"},
            {"method": "Peer-to-Peer", "description": "Bots communicate with each other", "advantage": "No single C2 to take down"}
          ]
        }
      },
      
      "key_points": [
        "Lifecycle: Delivery → Exploitation → Installation → C2 → Actions",
        "Persistence mechanisms survive reboots (registry, scheduled tasks, services)",
        "Evasion: obfuscation, polymorphism, fileless, sandbox detection",
        "C2 communication often uses HTTPS to blend with normal traffic",
        "DGA (Domain Generation Algorithm) makes C2 takedowns difficult"
      ],
      
      "career_callout": {
        "role": "Incident Responder",
        "note": "When cleaning infections, you must identify ALL persistence mechanisms. Missing one means the malware returns after 'remediation.' Check registry run keys, scheduled tasks, services, startup folders, and WMI subscriptions. Tools like Autoruns show comprehensive persistence locations."
      },
      
      "exam_tips": [
        "Persistence = survives reboot (registry, scheduled tasks, services)",
        "C2 = Command and Control (attacker communication)",
        "DGA = Domain Generation Algorithm (random C2 domains)",
        "Polymorphic = code changes to avoid signatures",
        "Fileless = memory-only, uses legitimate tools (PowerShell, WMI)"
      ],
      
      "deep_dive": {
        "title": "Malware Analysis Fundamentals",
        "estimated_time": "25 minutes",
        "content": {
          "description": "Learn safe, basic techniques for analyzing suspicious files and understanding malware behavior.",
          
          "lab_static_analysis": {
            "title": "Lab: Basic Static Analysis",
            "objective": "Analyze suspicious file without executing it",
            "warning": "Always analyze malware in isolated environment!",
            "steps": [
              {
                "step": 1,
                "action": "Generate file hashes",
                "commands": [
                  "md5sum suspicious.exe",
                  "sha256sum suspicious.exe",
                  "# Look up hash on VirusTotal"
                ],
                "purpose": "Check if known malware; create IOC"
              },
              {
                "step": 2,
                "action": "Identify file type",
                "commands": [
                  "file suspicious.exe",
                  "# Check if extension matches actual type"
                ],
                "purpose": "Detect file type mismatch (e.g., .pdf that's actually .exe)"
              },
              {
                "step": 3,
                "action": "Extract strings",
                "commands": [
                  "strings suspicious.exe > strings.txt",
                  "grep -i 'http' strings.txt      # URLs",
                  "grep -i 'password' strings.txt  # Interesting terms",
                  "grep -i 'cmd\\|powershell' strings.txt  # Commands"
                ],
                "purpose": "Find URLs, IPs, commands, registry keys"
              },
              {
                "step": 4,
                "action": "Check with online services",
                "services": [
                  {"name": "VirusTotal", "url": "virustotal.com", "purpose": "Multi-AV scan"},
                  {"name": "Hybrid Analysis", "url": "hybrid-analysis.com", "purpose": "Sandbox analysis"},
                  {"name": "Any.Run", "url": "any.run", "purpose": "Interactive sandbox"}
                ]
              }
            ]
          },
          
          "lab_behavioral_indicators": {
            "title": "Lab: Identify Suspicious Behavior",
            "objective": "Recognize indicators of malware activity on running system",
            "commands": [
              {
                "action": "Check for unusual processes",
                "command": "ps aux | grep -E '/tmp|/dev/shm|\\.'",
                "suspicious": "Processes running from /tmp, hidden files, random names"
              },
              {
                "action": "Check for unusual network connections",
                "command": "ss -tupn | grep ESTABLISHED",
                "suspicious": "Connections to unknown IPs, unusual ports"
              },
              {
                "action": "Check persistence locations",
                "commands": [
                  "crontab -l",
                  "ls -la ~/.config/autostart/",
                  "systemctl list-unit-files --state=enabled"
                ],
                "suspicious": "Recently added entries, unknown services"
              },
              {
                "action": "Check for unusual listening ports",
                "command": "ss -tuln",
                "suspicious": "Unexpected open ports, especially high-numbered"
              }
            ]
          }
        }
      }
    },

    {
      "section_id": "D2-L004-S03",
      "title": "Malware Detection and Prevention",
      "estimated_time": "12 minutes",
      
      "content": {
        "overview": "Effective malware defense requires multiple layers: prevention to block initial infection, detection to identify compromises, and response capabilities.",
        
        "detection_methods": [
          {
            "method": "Signature-Based Detection",
            "description": "Matches known malware patterns/hashes",
            "pros": ["Fast", "Accurate for known threats", "Low false positives"],
            "cons": ["Cannot detect new/unknown malware", "Easily evaded by polymorphism"],
            "used_by": "Traditional antivirus"
          },
          {
            "method": "Heuristic Analysis",
            "description": "Identifies suspicious characteristics without signatures",
            "pros": ["Can detect variants", "Catches some unknown malware"],
            "cons": ["Higher false positives", "Can be evaded"],
            "example": "File that modifies registry run keys AND contacts unknown IP"
          },
          {
            "method": "Behavioral Analysis",
            "description": "Monitors actual behavior for malicious actions",
            "pros": ["Catches fileless malware", "Detects zero-days"],
            "cons": ["Requires execution", "Resource intensive"],
            "used_by": "EDR, sandboxes"
          },
          {
            "method": "Machine Learning",
            "description": "Models trained on malware characteristics",
            "pros": ["Can generalize to unknown threats", "Improves over time"],
            "cons": ["Can be fooled by adversarial techniques", "Needs good training data"]
          }
        ],
        
        "prevention_controls": [
          {
            "control": "Endpoint Protection (EPP/EDR)",
            "function": "Real-time prevention and detection on endpoints",
            "capabilities": ["Signature scanning", "Behavioral monitoring", "Threat intelligence", "Response actions"]
          },
          {
            "control": "Email Security",
            "function": "Filter malicious attachments and links",
            "capabilities": ["Attachment sandboxing", "Link rewriting", "Impersonation detection"]
          },
          {
            "control": "Network Security",
            "function": "Block malicious traffic",
            "capabilities": ["IPS signatures", "C2 domain blocking", "DNS filtering"]
          },
          {
            "control": "Application Whitelisting",
            "function": "Only allow approved applications to run",
            "effectiveness": "Very effective but operationally challenging"
          },
          {
            "control": "Patching",
            "function": "Remove vulnerabilities malware exploits",
            "critical_for": "Worms that spread via exploits"
          }
        ],
        
        "indicators_of_compromise": {
          "description": "Observable artifacts indicating possible malware infection",
          "ioc_types": [
            {"type": "File Hashes", "description": "MD5, SHA1, SHA256 of malware files"},
            {"type": "IP Addresses", "description": "C2 servers, malware distribution"},
            {"type": "Domain Names", "description": "C2 domains, phishing sites"},
            {"type": "URLs", "description": "Malware download links"},
            {"type": "File Names/Paths", "description": "Common malware locations"},
            {"type": "Registry Keys", "description": "Persistence mechanisms"},
            {"type": "Mutex Names", "description": "Malware identifiers"},
            {"type": "Email Subjects", "description": "Phishing campaign indicators"}
          ],
          "sharing_formats": ["STIX/TAXII", "OpenIOC", "YARA rules"]
        }
      },
      
      "key_points": [
        "Signature-based catches known malware; behavioral catches unknown",
        "EDR provides detection and response capabilities beyond traditional AV",
        "Application whitelisting is very effective but hard to implement",
        "IOCs (Indicators of Compromise) help identify infections across environment",
        "Defense in depth: email security + endpoint + network + patching"
      ],
      
      "exam_tips": [
        "Signature-based = known malware; Heuristic/Behavioral = unknown",
        "IOC = Indicator of Compromise (hashes, IPs, domains)",
        "YARA = rule language for malware detection",
        "Application whitelisting = only approved apps can run",
        "EDR = Endpoint Detection and Response"
      ],
      
      "knowledge_check": {
        "question": "An organization wants to detect malware that operates entirely in memory and uses legitimate Windows tools. Which detection method is MOST effective?",
        "options": [
          "Signature-based antivirus",
          "File integrity monitoring",
          "Behavioral analysis / EDR",
          "Application whitelisting"
        ],
        "correct": 2,
        "explanation": "Behavioral analysis/EDR is most effective for fileless malware. Signature-based AV needs a file to scan. File integrity monitoring won't catch memory-only malware. Application whitelisting might help if configured to restrict PowerShell/WMI, but behavioral analysis specifically monitors for malicious actions regardless of how they're executed."
      }
    }
  ],

  "tool_spotlights": {
    "tools": [
      {
        "name": "VirusTotal",
        "category": "Malware Analysis",
        "description": "Multi-engine malware scanning and threat intelligence",
        "free_tier": "Free public scanning",
        "url": "https://virustotal.com",
        "career_relevance": "Essential for IOC lookup and file analysis"
      },
      {
        "name": "Any.Run",
        "category": "Malware Sandbox",
        "description": "Interactive malware analysis sandbox",
        "free_tier": "Free public submissions",
        "url": "https://any.run",
        "career_relevance": "Watch malware execute safely"
      },
      {
        "name": "Hybrid Analysis",
        "category": "Malware Analysis",
        "description": "Free malware analysis service with detailed reports",
        "free_tier": "Free",
        "url": "https://hybrid-analysis.com",
        "career_relevance": "Detailed behavioral analysis"
      },
      {
        "name": "YARA",
        "category": "Malware Detection",
        "description": "Pattern matching tool for malware research",
        "free_tier": "Open source",
        "url": "https://virustotal.github.io/yara/",
        "career_relevance": "Write custom malware detection rules"
      },
      {
        "name": "Autoruns (Sysinternals)",
        "category": "Persistence Detection",
        "description": "Shows all Windows auto-start locations",
        "free_tier": "Free",
        "url": "https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns",
        "career_relevance": "Essential for finding Windows persistence"
      }
    ]
  },

  "summary": {
    "key_takeaways": [
      "Virus needs host file; Worm spreads automatically without host",
      "Trojan disguises as legitimate; does NOT self-replicate",
      "Ransomware encrypts data; modern variants also threaten data leaks",
      "Rootkits hide malware at OS/kernel level; very difficult to detect",
      "Fileless malware operates in memory using legitimate tools",
      "Persistence mechanisms survive reboots (registry, tasks, services)",
      "C2 communication often uses HTTPS or DNS to blend with normal traffic",
      "Defense requires multiple layers: email + endpoint + network + patching"
    ],
    
    "exam_essentials": [
      "VIRUS = needs host; WORM = self-propagates without host",
      "TROJAN = disguised, no self-replication",
      "RAT = Remote Access Trojan",
      "Polymorphic = code changes to avoid signatures",
      "IOC = Indicator of Compromise (hashes, IPs, domains)"
    ],
    
    "skills_gained": [
      "Classify malware by type, propagation, and payload",
      "Identify persistence mechanisms",
      "Perform basic static analysis (hashes, strings)",
      "Recognize behavioral indicators of infection",
      "Use online analysis tools safely"
    ],
    
    "connection_to_next": "Malware is often the payload delivered through attacks. The next lesson covers Network Attacks—the techniques attackers use to intercept, disrupt, and exploit network communications."
  },

  "related_content": {
    "simulations": ["D2-SIM-003"],
    "remediation": ["D2-REM-002"],
    "next_lesson": "D2-LESSON-005",
    "previous_lesson": "D2-LESSON-003"
  }
}
