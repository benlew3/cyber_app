{
  "lesson_id": "D2-LESSON-004",
  "domain": 2,
  "title": "Malware Types and Characteristics",
  "objectives_covered": ["2.4"],
  "estimated_duration": "45-55 minutes",
  "difficulty": "intermediate",
  "prerequisites": ["D2-LESSON-002", "D2-LESSON-003"],

  "introduction": {
    "hook": "In May 2017, the WannaCry ransomware infected 230,000 computers across 150 countries in just four days. Hospitals cancelled surgeries. Factories stopped production. A global shipping company lost $300 million. All from a single piece of malware that combined a worm's self-spreading capability with ransomware's encryption payload. Malwareâ€”malicious softwareâ€”is the weapon threat actors use to achieve their objectives: stealing data, encrypting files, controlling systems, or disrupting operations. Understanding malware types, behaviors, and indicators is essential for detecting and defending against attacks.",
    "learning_goals": [
      "Classify malware by type, propagation method, and payload",
      "Differentiate between viruses, worms, trojans, ransomware, and other malware types",
      "Identify indicators of malware infection in systems and networks",
      "Analyze malware capabilities including persistence, evasion, and communication",
      "Apply appropriate detection and prevention controls for different malware types"
    ],
    "why_it_matters": "Every security professional encounters malwareâ€”in incident response, threat analysis, security operations, or architecture decisions. Understanding malware helps you recognize infections, design effective defenses, and communicate about threats with precision. The Security+ exam tests malware comprehensivelyâ€”expect 8-10 questions on types, behaviors, and indicators of compromise."
  },

  "sections": [
    {
      "section_id": "D2-L004-S01",
      "title": "Malware Fundamentals",
      "content": "Malware (malicious software) is any software intentionally designed to cause damage, gain unauthorized access, or disrupt systems. Understanding malware requires examining three dimensions: type, propagation, and payload.\n\n**Malware Classification Framework**\n\n*By Type (What It Is)*\n- Virus (requires host, self-replicates)\n- Worm (self-propagates across networks)\n- Trojan (disguised as legitimate)\n- Ransomware (encrypts for extortion)\n- Spyware (surveillance and theft)\n- Rootkit (hides deep, maintains access)\n\n*By Propagation (How It Spreads)*\n- Email attachments\n- Web downloads\n- Network exploitation\n- Removable media\n- Software supply chain\n- Social engineering\n\n*By Payload (What It Does)*\n- Data theft\n- Encryption/destruction\n- Remote access\n- System manipulation\n- Resource hijacking\n- Espionage\n\n**Malware Lifecycle**\n\n*1. Delivery*\n- Arrive at target system\n- Email, web, USB, exploit\n- Often via social engineering\n\n*2. Exploitation*\n- Gain initial execution\n- User action (opening file)\n- Vulnerability exploitation\n- Misuse of legitimate features (macros)\n\n*3. Installation*\n- Establish foothold\n- Write to disk or memory\n- Modify system configuration\n- Prepare for persistence\n\n*4. Command and Control (C2)*\n- Connect to attacker infrastructure\n- Receive instructions\n- Exfiltrate data\n- Download additional tools\n\n*5. Actions on Objectives*\n- Execute attacker's goals\n- Steal data, encrypt files\n- Move laterally\n- Maintain access\n\n**Malware Capabilities**\n\n*Persistence*\n- Survive reboot\n- Registry modifications\n- Scheduled tasks\n- Service installation\n- Boot sector modification\n\n*Evasion*\n- Obfuscation and packing\n- Polymorphism (changing code)\n- Fileless techniques\n- Sandbox detection\n- Rootkit capabilities\n\n*Communication*\n- HTTP/HTTPS beaconing\n- DNS tunneling\n- Domain generation algorithms\n- Social media C2\n- Encrypted channels",

      "key_points": [
        "Malware classified by type (what), propagation (how spreads), and payload (what it does)",
        "Malware lifecycle: Delivery â†’ Exploitation â†’ Installation â†’ C2 â†’ Actions",
        "Persistence ensures malware survives reboot (registry, services, scheduled tasks)",
        "Evasion techniques: obfuscation, polymorphism, fileless, sandbox detection",
        "C2 communication often uses HTTP/HTTPS, DNS, or encrypted channels to blend in"
      ],

      "real_world_example": {
        "scenario": "Analyzing a sophisticated malware infection",
        "company": "Pinnacle Financial Services",
        "application": "Pinnacle's SOC investigated a suspected infection: DELIVERY (user received spear phishing email with Excel attachment), EXPLOITATION (macro executed PowerShell downloader), INSTALLATION (downloaded DLL loaded into legitimate process, created scheduled task for persistence), C2 (beaconed to attacker server every 30 minutes over HTTPS, used domain generation algorithm for backup C2), EVASION (ran entirely in memoryâ€”no malware file on disk, detected sandbox and delayed execution, encrypted C2 traffic), ACTIONS (keylogger captured credentials, accessed internal file shares, exfiltrated 2GB of data over DNS tunneling). Analysis revealed sophisticated malware combining multiple techniquesâ€”not commodity malware."
      },

      "exam_tips": [
        "Malware has three dimensions: TYPE, PROPAGATION, PAYLOAD",
        "Lifecycle stages: Delivery â†’ Exploit â†’ Install â†’ C2 â†’ Actions on Objectives",
        "Persistence = surviving reboot (registry, scheduled tasks, services)",
        "C2 = Command and Control (attacker communication channel)",
        "Fileless malware operates in memory without writing to disk"
      ],

      "glossary_terms": [
        {
          "term": "Malware",
          "definition": "Malicious software designed to damage systems, steal data, gain unauthorized access, or disrupt operations, including viruses, worms, trojans, ransomware, and spyware.",
          "exam_note": "Umbrella term. Includes viruses, worms, trojans, ransomware, spyware, rootkits."
        },
        {
          "term": "Command and Control (C2)",
          "definition": "The infrastructure and communications channel used by attackers to remotely control malware, issue commands, and receive stolen data.",
          "exam_note": "Attacker communication channel. Often HTTP/HTTPS, DNS. Key target for defenders."
        },
        {
          "term": "Persistence",
          "definition": "Techniques malware uses to maintain presence on a system across reboots and other disruptions.",
          "exam_note": "Survives reboot. Methods: registry, scheduled tasks, services, boot modification."
        },
        {
          "term": "Payload",
          "definition": "The malicious action or code that malware executes after successful infection, such as data theft, encryption, or system damage.",
          "exam_note": "What malware DOES. Separate from delivery mechanism."
        }
      ],

      "knowledge_check": {
        "question": "Malware that detects it's running in a virtual machine and refuses to execute its malicious payload is demonstrating which capability?",
        "options": [
          "Persistence through VM-aware configuration",
          "Propagation via hypervisor exploitation",
          "Evasion through sandbox detection",
          "C2 communication using VM escape"
        ],
        "correct": 2,
        "explanation": "This is sandbox/VM detectionâ€”an evasion technique where malware detects analysis environments and changes behavior to avoid detection. Security researchers often use VMs to analyze malware, so malware that detects VMs and refuses to run evades analysis. This isn't persistence (surviving reboot) or propagation (spreading)."
      }
    },
    {
      "section_id": "D2-L004-S02",
      "title": "Viruses, Worms, and Trojans",
      "content": "Viruses, worms, and trojans are foundational malware types with distinct characteristics. Understanding their differences is essential for both the exam and real-world defense.\n\n**Viruses**\n\n*Characteristics*\n- Requires host file to attach to\n- Cannot spread without user action\n- Modifies legitimate files\n- Self-replicates within system\n- Oldest form of malware\n\n*Virus Types*\n\n*Boot Sector Virus*\n- Infects Master Boot Record (MBR)\n- Executes before OS loads\n- Difficult to detect/remove\n- Less common with UEFI/Secure Boot\n\n*File Infector*\n- Attaches to executable files\n- Executes when host file runs\n- May overwrite or append to file\n- Spreads when infected files shared\n\n*Macro Virus*\n- Targets documents with macro capability\n- Microsoft Office primary target\n- Executes when document opened\n- Cross-platform (any macro-enabled app)\n\n*Polymorphic Virus*\n- Changes its code signature each replication\n- Evades signature-based detection\n- Uses encryption or code substitution\n- Each copy appears different\n\n**Worms**\n\n*Characteristics*\n- Self-replicating and self-propagating\n- NO host file required\n- Spreads across networks automatically\n- Exploits vulnerabilities to spread\n- Can cause massive damage quickly\n\n*Notable Worms*\n- Code Red (2001): IIS vulnerability\n- Slammer (2003): SQL Server, 10 minutes global spread\n- Conficker (2008): Windows vulnerability\n- WannaCry (2017): EternalBlue SMB exploit\n\n*Propagation Methods*\n- Network vulnerability exploitation\n- Email with malicious attachments\n- Instant messaging\n- File shares\n- Removable media (USB worms)\n\n**Trojans (Trojan Horse)**\n\n*Characteristics*\n- Disguised as legitimate software\n- Requires user to install/execute\n- Does NOT self-replicate\n- Hides malicious functionality\n- Named after Greek mythology\n\n*Trojan Types*\n\n*Remote Access Trojan (RAT)*\n- Provides backdoor access\n- Full remote control of system\n- Screen capture, keylogging\n- File access and exfiltration\n- Examples: DarkComet, njRAT, Remcos\n\n*Banking Trojan*\n- Targets financial credentials\n- Intercepts banking sessions\n- Form grabbing\n- Man-in-the-browser attacks\n- Examples: Zeus, TrickBot, Dridex\n\n*Downloader Trojan*\n- Downloads additional malware\n- Initial foothold for larger attack\n- Evades detection (small payload)\n- Examples: Emotet (as loader)\n\n*Info Stealer*\n- Harvests credentials and data\n- Browser passwords\n- Cryptocurrency wallets\n- Documents and files\n- Examples: RedLine, Raccoon",

      "key_points": [
        "Virus requires host file and user action; Worm self-propagates without user action",
        "Trojans disguise as legitimate software; do NOT self-replicate",
        "Boot sector viruses execute before OS; difficult to detect with BIOS-level infection",
        "Polymorphic viruses change code signature to evade detection",
        "RATs (Remote Access Trojans) provide full backdoor control to attackers"
      ],

      "real_world_example": {
        "scenario": "Worm outbreak causes global disruption",
        "company": "Multiple Organizations (WannaCry 2017)",
        "application": "WannaCry demonstrated worm devastation: PROPAGATION (exploited EternalBlue SMB vulnerability to spread automatically without user action), SPEED (infected 230,000 systems in 150 countries within 4 days), PAYLOAD (ransomware encrypted files demanding bitcoin payment), VICTIMS (UK National Health Service cancelled 19,000 appointments, Nissan and Renault halted production, FedEx, Telefonica, German railways), KILL SWITCH (accidentally discovered domain registration stopped spread), IMPACT ($4-8 billion in global damages). WannaCry combined worm propagation (self-spreading) with ransomware payload (encryption)â€”maximizing both spread speed and damage."
      },

      "exam_tips": [
        "Virus = needs host file + user action; Worm = self-spreads automatically",
        "Trojans disguise as legitimate software, do NOT replicate",
        "RAT = Remote Access Trojan (backdoor control)",
        "Boot sector virus infects MBR, executes before OS",
        "Polymorphic virus changes signature each replication (evades AV)"
      ],

      "glossary_terms": [
        {
          "term": "Virus",
          "definition": "Malware that attaches to legitimate files and replicates when the host file is executed, requiring user action to spread.",
          "exam_note": "Needs host file. Needs user action. Self-replicates locally. Oldest malware type."
        },
        {
          "term": "Worm",
          "definition": "Self-replicating malware that spreads automatically across networks without requiring a host file or user action, often by exploiting vulnerabilities.",
          "exam_note": "NO host needed. Self-propagates. Exploits vulnerabilities. Can spread very quickly."
        },
        {
          "term": "Trojan",
          "definition": "Malware disguised as legitimate software that performs malicious actions when executed, relying on deception rather than self-replication to spread.",
          "exam_note": "Disguised as legitimate. NO self-replication. Types: RAT, banking, downloader, info stealer."
        },
        {
          "term": "Remote Access Trojan (RAT)",
          "definition": "A trojan that provides attackers with remote control over an infected system, enabling surveillance, data theft, and command execution.",
          "exam_note": "Full backdoor access. Screen capture, keylogging, file access. Examples: DarkComet, njRAT."
        }
      ],

      "knowledge_check": {
        "question": "Malware is spreading rapidly across a network by exploiting an SMB vulnerability, infecting systems automatically without any user interaction. Security teams observe it moving between subnets. This malware is BEST classified as a:",
        "options": [
          "Virus because it is replicating across systems",
          "Worm because it self-propagates without user action",
          "Trojan because it exploits a vulnerability",
          "Rootkit because it is spreading at the network level"
        ],
        "correct": 1,
        "explanation": "This is a wormâ€”self-propagating malware that spreads automatically by exploiting vulnerabilities without requiring user action. The key indicators are: automatic spread, no user action, network propagation via vulnerability exploitation. Viruses require user action and host files. Trojans don't self-replicate. Rootkits focus on hiding, not spreading."
      }
    },
    {
      "section_id": "D2-L004-S03",
      "title": "Ransomware and Extortion Malware",
      "content": "Ransomware has become the dominant cybercrime threat, with attacks causing billions in damages annually. Understanding ransomware operations is critical for defense.\n\n**Ransomware Basics**\n\n*Definition*\n- Malware that encrypts victim data\n- Demands payment (ransom) for decryption key\n- Often uses cryptocurrency for payment\n- May include data theft and extortion\n\n*How Ransomware Works*\n1. Initial access (phishing, vulnerability, RDP)\n2. Reconnaissance and privilege escalation\n3. Lateral movement across network\n4. Data exfiltration (if double extortion)\n5. Encryption deployment\n6. Ransom demand displayed\n\n**Ransomware Types**\n\n*Crypto Ransomware*\n- Encrypts files with strong encryption\n- Files unusable without key\n- Targets valuable data formats\n- Key held by attacker\n\n*Locker Ransomware*\n- Locks user out of system\n- Screen locker prevents access\n- Doesn't necessarily encrypt files\n- Easier to recover from\n\n*Double Extortion Ransomware*\n- Encrypts AND exfiltrates data\n- Pay to decrypt AND to prevent leak\n- Data published on 'shame sites'\n- Current dominant model\n\n*Triple Extortion*\n- Encrypt + exfiltrate + DDoS\n- Or contact victims' customers\n- Additional pressure tactics\n- Emerging trend\n\n**Ransomware-as-a-Service (RaaS)**\n\n*Business Model*\n- Core group develops ransomware platform\n- Affiliates pay or share revenue to use\n- Platform provides encryption, negotiation, payment\n- Revenue split typically 70/30 or 80/20\n\n*Major RaaS Operations*\n- LockBit (most prolific)\n- BlackCat/ALPHV\n- Cl0p (MOVEit attacks)\n- Royal/BlackSuit\n- Black Basta\n\n**Ransomware Defense**\n\n*Prevention*\n- Email security and phishing protection\n- Patch management (especially RDP, VPN)\n- Strong authentication (MFA)\n- Limit administrative privileges\n- Network segmentation\n\n*Detection*\n- EDR monitoring for encryption behavior\n- Volume shadow copy deletion alerts\n- Mass file modifications\n- Known ransomware indicators\n\n*Recovery*\n- Offline/immutable backups (critical!)\n- Tested restoration procedures\n- Incident response plan\n- Ransomware-specific playbooks\n\n**Other Extortion Malware**\n\n*Wipers*\n- Destroy data without ransom option\n- Often nation-state tools\n- May masquerade as ransomware\n- Examples: NotPetya, WhisperGate\n\n*Doxware*\n- Threatens to publish stolen data\n- No encryption involved\n- Pure extortion based on exposure\n- Sensitive/embarrassing data targeted",

      "key_points": [
        "Crypto ransomware encrypts; Locker ransomware locks out user",
        "Double extortion: encrypt + threaten to publish stolen data",
        "RaaS (Ransomware-as-a-Service) enables affiliates to conduct attacks",
        "Offline/immutable backups are critical defenseâ€”network-accessible backups get encrypted",
        "Wipers destroy data and may disguise as ransomware (NotPetya)"
      ],

      "real_world_example": {
        "scenario": "Ransomware attack on critical infrastructure",
        "company": "Colonial Pipeline (2021)",
        "application": "Colonial Pipeline, supplying 45% of US East Coast fuel, fell to DarkSide ransomware: INITIAL ACCESS (compromised VPN account without MFAâ€”possibly from dark web credential leak), RECONNAISSANCE (attackers spent days exploring network), ENCRYPTION (deployed ransomware affecting billing systems), IMPACT (company shut down pipeline operations as precaution, fuel shortages across southeastern US, panic buying), RESPONSE (paid $4.4 million ransom in bitcoin, FBI later recovered most of it), LESSONS (legacy systems without MFA, IT-OT network separation crucial, $4.4M ransom is small compared to operational losses). The attack demonstrated how ransomware on IT systems can force OT shutdown even without infecting OT directly."
      },

      "exam_tips": [
        "Crypto ransomware encrypts FILES; Locker ransomware locks SYSTEM",
        "Double extortion = encrypt + threaten to leak (two pressure tactics)",
        "RaaS = affiliate model; developers and affiliates share ransom",
        "Offline backups CRITICALâ€”network-accessible backups get encrypted",
        "Wipers destroy data permanently; may disguise as ransomware"
      ],

      "glossary_terms": [
        {
          "term": "Ransomware",
          "definition": "Malware that encrypts victim data or locks system access, demanding payment (typically cryptocurrency) in exchange for the decryption key or unlock code.",
          "exam_note": "Encrypts data, demands ransom. Crypto (encrypts files) vs Locker (locks system)."
        },
        {
          "term": "Double Extortion",
          "definition": "A ransomware tactic combining data encryption with data exfiltration, threatening to publish stolen data if ransom isn't paid.",
          "exam_note": "Two threats: pay to decrypt AND pay to not publish. Current dominant model."
        },
        {
          "term": "Ransomware-as-a-Service (RaaS)",
          "definition": "A criminal business model where ransomware developers provide their platform to affiliates who conduct attacks, sharing the ransom payments.",
          "exam_note": "Affiliate model. Core develops, affiliates attack. Revenue split 70-80% to affiliate."
        },
        {
          "term": "Wiper",
          "definition": "Malware designed to permanently destroy data rather than encrypt it for ransom, often used in sabotage or destructive attacks.",
          "exam_note": "Destroys, doesn't encrypt. No recovery possible. May masquerade as ransomware. NotPetya example."
        }
      ],

      "knowledge_check": {
        "question": "An organization's backups were encrypted during a ransomware attack because they were stored on a network-accessible file share. What backup strategy would have BEST protected against this?",
        "options": [
          "More frequent backup schedule to minimize data loss",
          "Offline or immutable backups inaccessible from the network",
          "Cloud-based backups with synchronization enabled",
          "Encrypted backups that only administrators can access"
        ],
        "correct": 1,
        "explanation": "Offline or immutable backups are the correct answer. Ransomware targets any accessible storage, including network shares and synchronized cloud storage. Immutable backups (cannot be modified) or air-gapped offline backups (physically disconnected) cannot be encrypted by ransomware. Frequency doesn't help if backups are also encrypted. Cloud sync may also get encrypted."
      }
    },
    {
      "section_id": "D2-L004-S04",
      "title": "Spyware, Rootkits, and Advanced Malware",
      "content": "Advanced malware types focus on stealth, persistence, and specialized objectives like surveillance, credential theft, or complete system control.\n\n**Spyware**\n\n*Definition*\n- Malware that secretly monitors user activity\n- Collects data without consent\n- May be commercial or criminal\n\n*Spyware Capabilities*\n- Keylogging (recording keystrokes)\n- Screen capture\n- Webcam/microphone access\n- Browser history monitoring\n- Credential harvesting\n- Location tracking\n\n*Types of Spyware*\n\n*Keyloggers*\n- Record all keystrokes\n- Capture passwords, messages\n- Hardware or software based\n- May send logs to attacker\n\n*Stalkerware*\n- Spy on intimate partners\n- GPS tracking, message reading\n- Often installed with physical access\n- Growing legal/ethical concern\n\n*Commercial Spyware*\n- 'Legitimate' monitoring software\n- Employee monitoring\n- Parental controls\n- Can be abused maliciously\n\n**Rootkits**\n\n*Definition*\n- Malware designed to hide itself and other malware\n- Provides persistent backdoor access\n- Operates at deep system levels\n- Extremely difficult to detect/remove\n\n*Rootkit Levels*\n\n*User-Mode (Ring 3)*\n- Runs at application level\n- Hooks API calls to hide files/processes\n- Easier to detect\n- Most common type\n\n*Kernel-Mode (Ring 0)*\n- Runs at OS kernel level\n- Modifies kernel functions\n- Very difficult to detect\n- Can hide any system activity\n\n*Firmware/BIOS Rootkits*\n- Infects firmware below OS\n- Survives OS reinstallation\n- Extremely persistent\n- Examples: LoJax, MosaicRegressor\n\n*Hypervisor Rootkits (Ring -1)*\n- Controls virtualization layer\n- OS runs 'above' rootkit\n- Theoretical/proof of concept\n- Blue Pill concept\n\n**Fileless Malware**\n\n*Characteristics*\n- Operates entirely in memory\n- No malicious files on disk\n- Uses legitimate system tools\n- Evades traditional antivirus\n- Growing trend\n\n*Techniques*\n- PowerShell scripts\n- WMI (Windows Management Instrumentation)\n- Living-off-the-land binaries (LOLBins)\n- Registry storage\n- Process injection\n\n**Bots and Botnets**\n\n*Definitions*\n- Bot: Malware that allows remote control\n- Botnet: Network of infected bots\n- Bot herder: Attacker controlling botnet\n- C2 server: Command infrastructure\n\n*Botnet Uses*\n- DDoS attacks (volume)\n- Spam distribution\n- Credential stuffing\n- Cryptocurrency mining\n- Click fraud\n- Malware distribution\n\n**Logic Bombs**\n\n*Definition*\n- Malicious code that triggers on condition\n- Time-based or event-based trigger\n- Often planted by insiders\n- Dormant until triggered\n\n*Common Triggers*\n- Specific date/time\n- Employee termination\n- Failure to log in (dead man's switch)\n- Specific system event",

      "key_points": [
        "Spyware secretly monitors activity; Keyloggers record all keystrokes",
        "Rootkits hide malware presence; levels: user-mode, kernel-mode, firmware, hypervisor",
        "Fileless malware operates in memory using legitimate tools (PowerShell, WMI)",
        "Botnets are networks of infected systems controlled for DDoS, spam, mining",
        "Logic bombs trigger on conditions (time, event, employee termination)"
      ],

      "real_world_example": {
        "scenario": "Firmware rootkit discovered targeting diplomats",
        "company": "Multiple Government Organizations",
        "application": "Security researchers discovered LoJax, the first firmware rootkit found in the wild: PERSISTENCE (infected UEFI firmwareâ€”survived OS reinstallation, hard drive replacement), ATTRIBUTION (APT28/Fancy Bear, Russian intelligence), TARGETS (government organizations in Central and Eastern Europe), TECHNIQUE (modified legitimate LoJack tracking software in firmware), DETECTION (required specialized firmware scanning tools), REMEDIATION (flashing clean firmwareâ€”standard remediation ineffective). LoJax demonstrated that advanced attackers can achieve persistence below the operating system, making traditional security tools ineffective. Defense requires Secure Boot and firmware integrity monitoring."
      },

      "exam_tips": [
        "Keylogger records keystrokes; Spyware is broader surveillance category",
        "Rootkit levels: User-mode (Ring 3) â†’ Kernel (Ring 0) â†’ Firmware â†’ Hypervisor",
        "Fileless malware = in memory, no disk files, uses LOLBins like PowerShell",
        "Bot = single infected system; Botnet = network of bots; Bot herder = controller",
        "Logic bomb triggers on condition (time, event)â€”often insider threat"
      ],

      "glossary_terms": [
        {
          "term": "Rootkit",
          "definition": "Malware designed to hide itself and other malicious activity from detection, operating at deep system levels to maintain persistent access.",
          "exam_note": "HIDES malware. Levels: user-mode, kernel-mode, firmware. Very difficult to detect."
        },
        {
          "term": "Keylogger",
          "definition": "Spyware that records all keystrokes typed by a user, capturing passwords, messages, and other sensitive information.",
          "exam_note": "Records keystrokes. Can be software or hardware. Captures passwords."
        },
        {
          "term": "Fileless Malware",
          "definition": "Malware that operates entirely in system memory without writing persistent files to disk, often using legitimate system tools to evade detection.",
          "exam_note": "No files on disk. Uses PowerShell, WMI, LOLBins. Evades file-based AV."
        },
        {
          "term": "Botnet",
          "definition": "A network of compromised computers (bots) controlled by an attacker (bot herder) for coordinated malicious activities like DDoS attacks or spam distribution.",
          "exam_note": "Network of infected systems. Uses: DDoS, spam, mining, credential stuffing."
        },
        {
          "term": "Logic Bomb",
          "definition": "Malicious code that remains dormant until triggered by a specific condition such as a date, time, or event.",
          "exam_note": "Triggers on condition. Often insider threat. Examples: time-based, employee termination."
        }
      ],

      "knowledge_check": {
        "question": "An organization discovers malware on a server that was still present after a complete OS reinstallation. The malware appears to be stored in the UEFI firmware. This is characteristic of:",
        "options": [
          "User-mode rootkit hiding in application space",
          "Kernel-mode rootkit modifying OS functions",
          "Firmware rootkit persisting below the operating system",
          "Fileless malware operating in memory"
        ],
        "correct": 2,
        "explanation": "Survival across OS reinstallation indicates firmware-level infection. Firmware rootkits infect UEFI/BIOS, operating below the operating system and surviving any OS-level remediation. User-mode and kernel-mode rootkits would be removed with OS reinstall. Fileless malware doesn't persist across reboots without additional persistence mechanisms."
      }
    },
    {
      "section_id": "D2-L004-S05",
      "title": "Malware Indicators and Detection",
      "content": "Detecting malware requires understanding the indicators it producesâ€”artifacts and behaviors that reveal its presence. These Indicators of Compromise (IOCs) enable detection and response.\n\n**Indicators of Compromise (IOCs)**\n\n*Network Indicators*\n- IP addresses (C2 servers)\n- Domain names (C2, DGA domains)\n- URLs (malicious downloads)\n- Traffic patterns (beaconing)\n- Port/protocol anomalies\n\n*Host Indicators*\n- File hashes (MD5, SHA-1, SHA-256)\n- File names and paths\n- Registry keys and values\n- Scheduled tasks\n- Service installations\n- Process names and behaviors\n\n*Behavioral Indicators*\n- Unusual process activity\n- Mass file modifications\n- Network connections from unexpected processes\n- Privilege escalation attempts\n- Defense evasion behaviors\n\n**Common Malware Behaviors**\n\n*Suspicious Process Activity*\n- PowerShell with encoded commands\n- cmd.exe spawned by Office applications\n- Process injection (process hollowing)\n- Unusual parent-child relationships\n- High CPU from unknown processes\n\n*File System Changes*\n- Mass file encryption (ransomware)\n- Shadow copy deletion\n- New files in temp/startup folders\n- Modified system files\n- Hidden files and folders\n\n*Registry Modifications*\n- Run key modifications (persistence)\n- Service registrations\n- Disabled security features\n- Browser hijacking entries\n\n*Network Behaviors*\n- Beaconing (regular C2 check-ins)\n- Large data transfers out\n- DNS queries to suspicious domains\n- Traffic to known bad IPs\n- Unusual ports or protocols\n\n**Detection Technologies**\n\n*Antivirus/Antimalware*\n- Signature-based (known malware)\n- Heuristic (suspicious patterns)\n- Behavioral (runtime analysis)\n- Cloud-based (reputation)\n\n*Endpoint Detection and Response (EDR)*\n- Continuous monitoring\n- Behavioral analysis\n- Forensic data collection\n- Automated response\n- Threat hunting capability\n\n*Network Detection*\n- IDS/IPS (intrusion detection/prevention)\n- Network traffic analysis\n- DNS monitoring\n- Sandboxing/detonation\n\n*SIEM Integration*\n- Correlate indicators across sources\n- Alert on IOC matches\n- Behavioral analytics\n- Incident investigation\n\n**Indicator Sharing**\n\n*Formats*\n- STIX (Structured Threat Information Expression)\n- TAXII (transport protocol for STIX)\n- OpenIOC\n- YARA rules (malware patterns)\n\n*Sources*\n- ISACs (industry sharing)\n- Government (CISA, FBI)\n- Commercial threat intelligence\n- Open source feeds",

      "key_points": [
        "IOCs include network (IPs, domains), host (hashes, registry), and behavioral indicators",
        "Key behaviors: PowerShell encoded commands, Office spawning cmd.exe, beaconing",
        "Shadow copy deletion is strong ransomware indicator (prevents backup restoration)",
        "EDR provides continuous monitoring, behavioral analysis, and threat hunting",
        "STIX/TAXII are standards for sharing threat intelligence and IOCs"
      ],

      "real_world_example": {
        "scenario": "Detecting malware through behavioral indicators",
        "company": "MedCare Health Systems",
        "application": "MedCare's SOC detected malware through layered indicators: INITIAL ALERT (EDR flagged PowerShell with Base64-encoded command launched by Excel process), INVESTIGATION (found Excel opened from email attachment, PowerShell connected to suspicious domain, created scheduled task for persistence), CORRELATION (SIEM matched domain to known C2 indicator from threat feed), NETWORK ANALYSIS (identified beaconing patternâ€”connection every 30 minutes with slight jitter), HOST FORENSICS (found registry persistence, credential dumping tool downloaded), RESPONSE (isolated affected systems, blocked C2 domain, hunted for other infections using IOCs). Multi-layered detection caught attack that signature-based AV missed."
      },

      "exam_tips": [
        "IOC = Indicator of Compromise (evidence of malware/intrusion)",
        "File hash is the most reliable IOC (unique to specific file)",
        "Beaconing = regular C2 communication pattern (check-ins)",
        "Shadow copy deletion = strong ransomware indicator",
        "STIX = format for IOCs; TAXII = protocol to share them"
      ],

      "glossary_terms": [
        {
          "term": "Indicator of Compromise (IOC)",
          "definition": "Forensic artifacts or observable data that indicate a system may be compromised, including file hashes, IP addresses, domain names, and behavioral patterns.",
          "exam_note": "Evidence of malware/intrusion. Types: network (IPs), host (hashes), behavioral."
        },
        {
          "term": "Beaconing",
          "definition": "A pattern of regular network communications from malware to its command and control server, often at fixed intervals.",
          "exam_note": "Regular C2 check-ins. Often 30 seconds to hours interval. Look for patterns in traffic."
        },
        {
          "term": "STIX",
          "definition": "Structured Threat Information Expressionâ€”a standardized language and format for representing and sharing cyber threat intelligence.",
          "exam_note": "FORMAT for threat intel/IOCs. TAXII is the transport PROTOCOL for STIX."
        },
        {
          "term": "YARA",
          "definition": "A tool and pattern-matching language used to identify and classify malware based on textual or binary patterns.",
          "exam_note": "Malware identification rules. Pattern matching. Used for hunting and classification."
        }
      ],

      "knowledge_check": {
        "question": "A security analyst notices that a workstation makes HTTPS connections to the same IP address every 45 minutes, with connections lasting 10-30 seconds each. This traffic pattern is MOST indicative of:",
        "options": [
          "Normal web browsing behavior",
          "Software update check routine",
          "Command and control beaconing",
          "Peer-to-peer file sharing"
        ],
        "correct": 2,
        "explanation": "This patternâ€”regular connections at fixed intervals to the same destination with brief durationâ€”is characteristic of C2 beaconing. Malware checks in with its controller on a schedule (45 minutes in this case) to receive commands or report status. Normal browsing and updates would show more variable patterns. P2P would show connections to multiple peers."
      }
    }
  ],

  "hands_on_activity": {
    "title": "Malware Analysis and Classification Exercise",
    "objective": "Analyze malware indicators and classify malware samples",
    "scenario": "You're a SOC analyst at GlobalRetail Inc. investigating a potential malware incident. You have logs and indicators from multiple detection systems.",
    "steps": [
      "Step 1: Analyze these indicators and identify the malware type:\n   - Email attachment: 'Invoice_Q4.docm' with macro enabled\n   - PowerShell execution with encoded Base64 command\n   - New scheduled task created for persistence\n   - Connection to 185.x.x.x every 30 minutes\n   - Registry key added to HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run",
      "Step 2: For the identified malware, classify:\n   - Type (virus, worm, trojan, etc.)\n   - Propagation method\n   - Payload/purpose\n   - Persistence mechanism\n   - C2 communication method",
      "Step 3: Analyze this second set of indicators:\n   - Mass file modifications (.docx â†’ .encrypted extension)\n   - Volume Shadow Copy service stopped\n   - Ransom note file created on desktop\n   - Bitcoin wallet address in ransom note\n   - Files on network shares also encrypted",
      "Step 4: For the second malware, determine:\n   - Malware type and variant\n   - Whether this is double extortion (what additional evidence would you look for?)\n   - Critical defensive failure that allowed network share encryption",
      "Step 5: Create IOC list for both malware samples:\n   - Network indicators (IPs, domains)\n   - Host indicators (files, registry, hashes)\n   - Behavioral indicators",
      "Step 6: Recommend detection rules to catch similar malware in the future"
    ],
    "expected_outcome": "Complete malware analysis report with classification, IOC extraction, and detection recommendations for both samples.",
    "reflection_questions": [
      "Why is behavioral detection important when signatures may not exist?",
      "How does the malware lifecycle help structure your analysis?",
      "What makes IOC sharing valuable for the broader security community?"
    ]
  },

  "what_would_you_do": {
    "scenario": "You're the security lead at NexaTech Solutions. At 2 AM on Saturday, your EDR solution alerts on suspicious behavior: PowerShell executing encoded commands on a server, connections to an unknown IP address, and a scheduled task created. The alert was automatically contained (network isolation). The affected server hosts your customer portal.",
    "context": "The customer portal serves 50,000 users. The server was automatically isolated so it's offline. You can see the EDR logs remotely. Your IR team is on call but not yet contacted. Leadership expects the portal to be available Monday morning.",
    "question": "What is your immediate response?",
    "options": [
      {
        "id": "a",
        "text": "Remove the server from isolation to restore customer portal access while you investigate",
        "is_best": false,
        "feedback": "Removing containment before investigation could allow malware to spread, exfiltrate data, or contact C2. Customer inconvenience is preferable to potential breach. The containment action was correct and should remain until scope is understood.",
        "consequences": "Malware potentially spreads to other systems. C2 connection reestablished. Data exfiltration possible. Incident scope dramatically increases."
      },
      {
        "id": "b",
        "text": "Keep containment, contact IR team, begin preliminary log analysis to assess scope",
        "is_best": true,
        "feedback": "This is the correct response. Maintain containment to prevent spread, engage your incident response team for a coordinated response, and begin collecting information to understand the scope. The portal can waitâ€”a breach cannot.",
        "consequences": "Containment prevents spread. IR team engaged for proper response. Preliminary analysis guides next steps. Leadership can be briefed with facts."
      },
      {
        "id": "c",
        "text": "Immediately wipe and rebuild the server to restore service as quickly as possible",
        "is_best": false,
        "feedback": "Wiping destroys forensic evidence needed to understand the attack, determine scope, and identify other compromised systems. You don't know if other systems are affected, and rebuilding before understanding the attack may just result in reinfection.",
        "consequences": "Forensic evidence destroyed. Attack scope unknown. Root cause not identified. May rebuild vulnerable system. Other infections missed."
      },
      {
        "id": "d",
        "text": "Wait until Monday business hours to investigate with full team available",
        "is_best": false,
        "feedback": "Delaying incident response by 48+ hours gives attackers time to act on other potentially compromised systems, exfiltrate data, or expand their foothold. Active incidents require immediate response, not business-hours convenience.",
        "consequences": "If other systems compromised, attackers have 48 hours unimpeded. Potential data breach. Regulatory notification delays. Evidence may be lost."
      }
    ],
    "key_lesson": "When EDR detects and contains a threat, maintain that containment until you understand the scope. Immediate goals: prevent spread (containment), engage response team, gather information. Service restoration is important but secondary to understanding and containing the threat. Never destroy evidence (wipe systems) before forensic analysis."
  },

  "summary": {
    "key_takeaways": [
      "Malware classified by type (virus/worm/trojan), propagation, and payload",
      "Virus needs host + user action; Worm self-propagates; Trojan disguises as legitimate",
      "Ransomware encrypts data; Double extortion adds data leak threat",
      "Rootkits hide at multiple levels: user-mode, kernel, firmware, hypervisor",
      "Fileless malware operates in memory using legitimate tools (LOLBins)",
      "IOCs enable detection: network (IPs, domains), host (hashes, registry), behavioral"
    ],
    "exam_essentials": [
      "Virus = needs host + user action; Worm = self-propagates without user action",
      "RAT = Remote Access Trojan (backdoor control); RaaS = Ransomware-as-a-Service",
      "Rootkit HIDES malware; Levels: user-mode â†’ kernel â†’ firmware â†’ hypervisor",
      "Fileless = memory-only, uses PowerShell/WMI; Beaconing = regular C2 check-ins",
      "IOC = Indicator of Compromise; STIX = format; TAXII = transport protocol",
      "Logic bomb triggers on condition (time, event, termination)"
    ],
    "connection_to_next": "Malware is just one category of attack techniques. The next lesson explores network-based attacksâ€”the methods attackers use to attack systems and intercept communications across networks."
  },

  "related_content": {
    "simulations": ["D2-SIM-003"],
    "remediation": ["D2-REM-002"],
    "next_lesson": "D2-LESSON-005",
    "previous_lesson": "D2-LESSON-003"
  }
}
