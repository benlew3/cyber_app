{
  "lesson_id": "D2-LESSON-004",
  "domain": 2,
  "title": "Malware Types and Characteristics",
  "subtitle": "Know Your Enemy: Understanding Malicious Software",
  "version": "2.0-enhanced",
  "objectives_covered": ["2.4"],
  "estimated_duration": "90-120 minutes",
  "difficulty": "intermediate",
  "prerequisites": ["D2-LESSON-002"],

  "skill_tree": {
    "position": {"domain": 2, "sequence": 4, "tier": "intermediate"},
    "prerequisites": [{"lesson_id": "D2-LESSON-002", "title": "Threat Vectors", "why_needed": "Malware is delivered via threat vectors"}],
    "unlocks": [{"lesson_id": "D2-LESSON-008", "title": "Indicators and Detection", "connection": "Malware creates detectable indicators"}],
    "cascade_learning": {
      "this_lesson_establishes": ["Malware classification", "Infection mechanisms", "Evasion techniques", "Detection approaches"],
      "concepts_used_later": {"D2-LESSON-008": "Malware IOCs", "D4-LESSON-001": "Malware detection in SOC"}
    }
  },

  "role_relevance": {
    "soc_analyst": {"relevance": "critical", "percentage_of_job": "45-55%", "daily_tasks": ["Analyze malware alerts", "Classify detected threats", "Identify malware families"]},
    "incident_responder": {"relevance": "critical", "percentage_of_job": "50-60%", "daily_tasks": ["Contain malware infections", "Analyze malware behavior", "Eradicate threats"]},
    "security_engineer": {"relevance": "high", "percentage_of_job": "30-40%", "daily_tasks": ["Configure endpoint protection", "Implement anti-malware controls"]},
    "grc_analyst": {"relevance": "medium", "percentage_of_job": "15-25%", "daily_tasks": ["Assess malware risk", "Document malware incidents"]},
    "penetration_tester": {"relevance": "high", "percentage_of_job": "35-45%", "daily_tasks": ["Understand malware techniques", "Simulate malware behavior"]}
  },

  "introduction": {
    "hook": "In 2017, WannaCry ransomware spread to 200,000 systems in 150 countries within days, crippling hospitals, manufacturing plants, and government agencies. It used an NSA-developed exploit leaked by hackers. Understanding malwareâ€”how it spreads, persists, and damagesâ€”is essential for defense.",
    "exam_weight": {"estimated_questions": "6-8", "high_yield_topics": ["Ransomware types", "Trojan vs virus vs worm", "Rootkit characteristics", "Fileless malware"]}
  },

  "sections": [
    {
      "section_id": "D2-L004-S01",
      "title": "Malware Classification",
      "estimated_time": "15 minutes",
      "content": {
        "overview": "Malware (malicious software) is classified by behavior, propagation method, and purpose.",
        "core_concepts": [
          {
            "concept": "Primary Malware Types",
            "types": [
              {"type": "Virus", "propagation": "Requires host file/program", "user_action": "Required (open file)", "key": "Attaches to legitimate files"},
              {"type": "Worm", "propagation": "Self-replicating over network", "user_action": "Not required", "key": "Spreads automatically"},
              {"type": "Trojan", "propagation": "Disguised as legitimate software", "user_action": "Required (install)", "key": "Does NOT self-replicate"},
              {"type": "Ransomware", "purpose": "Encrypt data for extortion", "variants": "Crypto (encrypts files), Locker (locks system)"},
              {"type": "Spyware", "purpose": "Monitor and steal information", "examples": "Keyloggers, screen capture"},
              {"type": "Rootkit", "purpose": "Hide malware presence, maintain access", "key": "Operates at kernel/boot level"},
              {"type": "RAT", "purpose": "Remote Access Trojan - backdoor control", "capability": "Full remote control of system"}
            ]
          },
          {
            "concept": "Critical Distinctions",
            "distinctions": [
              {"comparison": "Virus vs Worm", "difference": "Virus needs host file and user action; Worm spreads automatically"},
              {"comparison": "Trojan vs Virus", "difference": "Trojan disguises as legitimate software; Virus attaches to files"},
              {"comparison": "Trojan vs RAT", "difference": "RAT is a type of Trojan specifically for remote access"}
            ]
          }
        ]
      },
      "memory_hooks": {
        "mnemonic": "VWTRS-RR: Virus, Worm, Trojan, Ransomware, Spyware, Rootkit, RAT",
        "analogy": "Virus = sick person spreading illness by contact. Worm = illness spreading through air without contact. Trojan = gift with hidden soldiers inside.",
        "common_mistakes": [{"mistake": "Thinking Trojans self-replicate", "correction": "Trojans do NOT self-replicate. They rely on users installing them."}]
      },
      "must_remember_for_exam": [
        {"fact": "Virus requires host file AND user action", "why_tested": "Classification"},
        {"fact": "Worm self-replicates without user action", "why_tested": "Classification"},
        {"fact": "Trojan does NOT self-replicate", "why_tested": "Key distinction"},
        {"fact": "Rootkit hides at kernel/boot level", "why_tested": "Evasion technique"},
        {"fact": "RAT = Remote Access Trojan (backdoor control)", "why_tested": "Terminology"}
      ],
      "key_points": ["Virus needs host file + user action; Worm self-replicates automatically", "Trojan disguises but does NOT self-replicate", "Rootkit hides malware presence at kernel level", "RAT provides full remote control"],
      "knowledge_check": {
        "question": "Malware spreads rapidly across a network without any user interaction, exploiting a vulnerability. This is MOST likely:",
        "options": ["Virus", "Worm", "Trojan", "Spyware"],
        "correct": 1,
        "explanation": "Worms self-replicate across networks without user action. Key indicators: no user interaction, rapid network spread, exploiting vulnerability.",
        "wrong_answer_analysis": [
          {"option": 0, "why_wrong": "Viruses require user action (opening file)"},
          {"option": 2, "why_wrong": "Trojans require user to install and don't self-replicate"},
          {"option": 3, "why_wrong": "Spyware monitors/steals but doesn't rapidly self-propagate"}
        ]
      }
    },
    {
      "section_id": "D2-L004-S02",
      "title": "Ransomware Deep Dive",
      "estimated_time": "12 minutes",
      "content": {
        "overview": "Ransomware encrypts data or locks systems, demanding payment for restoration. Dominant threat to organizations.",
        "core_concepts": [
          {
            "concept": "Ransomware Types",
            "types": [
              {"type": "Crypto Ransomware", "action": "Encrypts files", "recovery": "Decrypt with key or restore from backup"},
              {"type": "Locker Ransomware", "action": "Locks entire system", "recovery": "May require OS reinstall"}
            ]
          },
          {
            "concept": "Modern Ransomware Tactics",
            "tactics": [
              {"tactic": "Double Extortion", "description": "Encrypt + threaten to leak stolen data"},
              {"tactic": "Triple Extortion", "description": "Add DDoS or contact customers/partners"},
              {"tactic": "RaaS", "description": "Ransomware-as-a-Service affiliate model"}
            ]
          },
          {
            "concept": "Defense Priorities",
            "defenses": [
              {"defense": "Offline Backups", "why": "Ransomware can encrypt connected backups"},
              {"defense": "Endpoint Protection", "why": "Detect ransomware behavior"},
              {"defense": "User Training", "why": "Phishing is common delivery"},
              {"defense": "Patch Management", "why": "Exploits deliver ransomware"}
            ]
          }
        ]
      },
      "must_remember_for_exam": [
        {"fact": "Crypto ransomware encrypts files; Locker locks system", "why_tested": "Type distinction"},
        {"fact": "Double extortion = encrypt + threaten data leak", "why_tested": "Current tactic"},
        {"fact": "Offline backups critical (ransomware encrypts connected backups)", "why_tested": "Defense"}
      ],
      "key_points": ["Crypto encrypts files; Locker locks system", "Double extortion: encrypt + leak threat", "Offline backups are essential defense"]
    },
    {
      "section_id": "D2-L004-S03",
      "title": "Advanced Malware Techniques",
      "estimated_time": "12 minutes",
      "content": {
        "overview": "Modern malware uses sophisticated techniques to evade detection and maintain persistence.",
        "core_concepts": [
          {
            "concept": "Fileless Malware",
            "definition": "Operates in memory without files on disk",
            "techniques": ["PowerShell scripts", "WMI exploitation", "Living off the land (using legitimate tools)"],
            "challenge": "Evades file-based antivirus"
          },
          {
            "concept": "Rootkit Types",
            "types": [
              {"type": "User-mode", "level": "Application level", "detection": "Easier to detect"},
              {"type": "Kernel-mode", "level": "OS kernel", "detection": "Very difficult"},
              {"type": "Bootkit", "level": "Boot process", "detection": "Loads before OS"}
            ]
          },
          {
            "concept": "Polymorphic and Metamorphic Malware",
            "polymorphic": "Changes appearance (encryption key) each infection",
            "metamorphic": "Completely rewrites code each infection",
            "challenge": "Evades signature-based detection"
          },
          {
            "concept": "Logic Bomb",
            "definition": "Malware triggered by specific condition",
            "triggers": ["Date/time", "User action", "System state"],
            "example": "Code that deletes files after employee termination date"
          }
        ]
      },
      "must_remember_for_exam": [
        {"fact": "Fileless malware operates in memory, evades file-based AV", "why_tested": "Evasion technique"},
        {"fact": "Rootkit hides at kernel level, loads before OS", "why_tested": "Persistence mechanism"},
        {"fact": "Polymorphic changes encryption; Metamorphic rewrites code", "why_tested": "Evasion distinction"},
        {"fact": "Logic bomb = triggered by specific condition", "why_tested": "Definition"}
      ],
      "key_points": ["Fileless malware runs in memory, evades file-based detection", "Rootkits hide at kernel/boot level", "Polymorphic/metamorphic evade signatures", "Logic bombs trigger on conditions"]
    },
    {
      "section_id": "D2-L004-S04",
      "title": "Potentially Unwanted Programs (PUPs)",
      "estimated_time": "8 minutes",
      "content": {
        "overview": "Software that may not be strictly malicious but impacts security, privacy, or performance.",
        "core_concepts": [
          {
            "concept": "PUP Types",
            "types": [
              {"type": "Adware", "behavior": "Displays unwanted advertisements", "risk": "May track browsing, slow system"},
              {"type": "Bloatware", "behavior": "Pre-installed unnecessary software", "risk": "Consumes resources, may have vulnerabilities"},
              {"type": "Cryptominer", "behavior": "Uses resources to mine cryptocurrency", "risk": "Performance impact, electricity cost"}
            ]
          }
        ]
      },
      "must_remember_for_exam": [
        {"fact": "Adware displays ads and may track users", "why_tested": "PUP type"},
        {"fact": "Cryptominer hijacks resources for cryptocurrency", "why_tested": "Current threat"},
        {"fact": "Bloatware = pre-installed unnecessary software", "why_tested": "Terminology"}
      ]
    }
  ],

  "summary": {
    "key_takeaways": [
      "Virus needs host file + user action; Worm self-replicates automatically",
      "Trojan disguises as legitimate software; does NOT self-replicate",
      "Ransomware: Crypto encrypts files, Locker locks system; Double extortion adds leak threat",
      "Rootkit hides at kernel level; Fileless runs in memory",
      "Polymorphic changes appearance; Metamorphic rewrites code"
    ],
    "exam_essentials": [
      "Virus = host file + user action; Worm = self-replicates",
      "Trojan does NOT self-replicate",
      "Rootkit operates at kernel/boot level",
      "Fileless malware evades file-based detection",
      "Logic bomb = triggered by condition"
    ]
  },

  "related_content": {
    "simulations": ["D2-SIM-003"],
    "next_lesson": "D2-LESSON-005",
    "previous_lesson": "D2-LESSON-003"
  }
}
