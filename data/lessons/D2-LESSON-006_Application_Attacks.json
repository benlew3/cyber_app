{
  "lesson_id": "D2-LESSON-006",
  "domain": 2,
  "title": "Application-Based Attacks",
  "subtitle": "Exploiting Software: Injection, XSS, and Beyond",
  "version": "2.0-enhanced",
  "objectives_covered": ["2.4"],
  "estimated_duration": "90-120 minutes",
  "difficulty": "intermediate",
  "prerequisites": ["D2-LESSON-002"],

  "skill_tree": {
    "position": {"domain": 2, "sequence": 6, "tier": "intermediate"},
    "prerequisites": [{"lesson_id": "D2-LESSON-002", "title": "Threat Vectors", "why_needed": "Applications are attack vectors"}],
    "unlocks": [{"lesson_id": "D2-LESSON-007", "title": "Vulnerability Management", "connection": "Application vulnerabilities need management"}],
    "cascade_learning": {
      "this_lesson_establishes": ["Injection attacks", "Web application vulnerabilities", "Input validation importance"],
      "concepts_used_later": {"D2-LESSON-007": "Vulnerability scanning", "D3-LESSON-002": "Secure application architecture"}
    }
  },

  "role_relevance": {
    "soc_analyst": {"relevance": "high", "percentage_of_job": "35-45%", "daily_tasks": ["Monitor WAF alerts", "Analyze application attacks", "Identify injection attempts"]},
    "incident_responder": {"relevance": "high", "percentage_of_job": "30-40%", "daily_tasks": ["Investigate web compromises", "Analyze attack payloads", "Assess data exposure"]},
    "security_engineer": {"relevance": "critical", "percentage_of_job": "45-55%", "daily_tasks": ["Configure WAF rules", "Implement input validation", "Secure application deployment"]},
    "grc_analyst": {"relevance": "medium", "percentage_of_job": "20-30%", "daily_tasks": ["Assess application security", "Review secure coding standards"]},
    "penetration_tester": {"relevance": "critical", "percentage_of_job": "60-70%", "daily_tasks": ["Test for injection flaws", "Exploit application vulnerabilities", "Report findings"]}
  },

  "introduction": {
    "hook": "The 2017 Equifax breach exposed 147 million people's personal data. The cause? A single unpatched Apache Struts vulnerability. Application attacks exploit software flaws to access data, execute commands, or take control of systems.",
    "exam_weight": {"estimated_questions": "7-9", "high_yield_topics": ["SQL injection", "XSS types", "CSRF", "Buffer overflow", "Directory traversal"]}
  },

  "sections": [
    {
      "section_id": "D2-L006-S01",
      "title": "Injection Attacks",
      "estimated_time": "15 minutes",
      "content": {
        "overview": "Injection attacks insert malicious code into application inputs, executed by backend systems.",
        "core_concepts": [
          {
            "concept": "SQL Injection (SQLi)",
            "mechanism": "Insert SQL commands into input fields",
            "impact": ["Data theft", "Data modification", "Authentication bypass", "Database destruction"],
            "example": "Username: admin'--  (comments out password check)",
            "defense": "Parameterized queries (prepared statements), input validation"
          },
          {
            "concept": "Command Injection",
            "mechanism": "Insert OS commands into application inputs",
            "example": "Filename: file.txt; rm -rf /",
            "impact": "Execute arbitrary commands on server",
            "defense": "Input validation, avoid shell commands"
          },
          {
            "concept": "LDAP Injection",
            "mechanism": "Inject LDAP query commands",
            "impact": "Bypass authentication, access directory data",
            "defense": "Input validation, escape special characters"
          },
          {
            "concept": "XML Injection / XXE",
            "xxe": "XML External Entity - include external resources",
            "impact": "Read local files, SSRF, DoS",
            "defense": "Disable external entities, validate XML"
          }
        ],
        "what_would_happen_if": {
          "scenario": "What if a login form has SQL injection?",
          "consequence": "Attacker enters: admin'-- as username. The SQL becomes: SELECT * FROM users WHERE username='admin'--' AND password='anything'. The -- comments out the password check, granting access without knowing the password."
        }
      },
      "memory_hooks": {
        "mnemonic": "Injection = Inserting malicious INPUT that becomes CODE",
        "common_mistakes": [{"mistake": "Thinking input validation alone prevents SQLi", "correction": "Use parameterized queries (prepared statements) as primary defense. Input validation is additional layer."}]
      },
      "must_remember_for_exam": [
        {"fact": "SQL injection inserts SQL commands into inputs", "why_tested": "Most common injection"},
        {"fact": "Defense: Parameterized queries (prepared statements)", "why_tested": "Primary defense"},
        {"fact": "Command injection executes OS commands", "why_tested": "Attack type"},
        {"fact": "XXE = XML External Entity attack", "why_tested": "Terminology"}
      ],
      "key_points": ["SQL injection inserts SQL into input fields", "Parameterized queries prevent SQL injection", "Command injection executes OS commands", "XXE exploits XML external entity processing"],
      "knowledge_check": {
        "question": "A web application builds SQL queries by concatenating user input. What is the MOST effective defense?",
        "options": ["Input validation", "Web application firewall", "Parameterized queries", "Output encoding"],
        "correct": 2,
        "explanation": "Parameterized queries (prepared statements) separate SQL code from data, preventing injection regardless of input content.",
        "wrong_answer_analysis": [
          {"option": 0, "why_wrong": "Input validation can be bypassed; parameterized queries are definitive"},
          {"option": 1, "why_wrong": "WAF is defense-in-depth but can be bypassed"},
          {"option": 3, "why_wrong": "Output encoding prevents XSS, not SQL injection"}
        ]
      }
    },
    {
      "section_id": "D2-L006-S02",
      "title": "Cross-Site Scripting (XSS)",
      "estimated_time": "15 minutes",
      "content": {
        "overview": "XSS injects malicious scripts into web pages viewed by other users.",
        "core_concepts": [
          {
            "concept": "XSS Types",
            "types": [
              {"type": "Reflected XSS", "mechanism": "Malicious script in URL, reflected back immediately", "persistence": "Not stored", "delivery": "Via malicious link"},
              {"type": "Stored XSS", "mechanism": "Script stored in database, served to all visitors", "persistence": "Persistent", "delivery": "Automatic to all users"},
              {"type": "DOM-based XSS", "mechanism": "Script executes in browser via DOM manipulation", "persistence": "Not stored", "delivery": "Client-side only"}
            ]
          },
          {
            "concept": "XSS Impact",
            "impacts": ["Session hijacking (steal cookies)", "Credential theft", "Defacement", "Malware distribution", "Keylogging"]
          },
          {
            "concept": "XSS Defense",
            "defenses": [
              {"defense": "Output encoding", "description": "Encode special characters before display"},
              {"defense": "Content Security Policy (CSP)", "description": "Restrict script sources"},
              {"defense": "HttpOnly cookies", "description": "Prevent JavaScript cookie access"},
              {"defense": "Input validation", "description": "Filter/reject malicious input"}
            ]
          }
        ]
      },
      "must_remember_for_exam": [
        {"fact": "Reflected XSS = not stored, in URL, requires victim to click", "why_tested": "XSS type"},
        {"fact": "Stored XSS = persistent, affects all visitors", "why_tested": "XSS type"},
        {"fact": "Output encoding is primary XSS defense", "why_tested": "Defense"},
        {"fact": "HttpOnly cookies prevent JS access", "why_tested": "Defense mechanism"}
      ],
      "key_points": ["Reflected XSS in URL, not stored; Stored XSS persistent in database", "Output encoding is primary defense", "HttpOnly cookies prevent cookie theft via XSS", "CSP restricts script sources"],
      "knowledge_check": {
        "question": "An attacker posts a comment containing JavaScript. All users viewing the page execute the script. This is:",
        "options": ["Reflected XSS", "Stored XSS", "DOM-based XSS", "CSRF"],
        "correct": 1,
        "explanation": "Stored/Persistent XSS - the script is stored in the database and executed by all visitors.",
        "wrong_answer_analysis": [
          {"option": 0, "why_wrong": "Reflected XSS is not stored, requires clicking malicious link"},
          {"option": 2, "why_wrong": "DOM-based is client-side manipulation, not stored"},
          {"option": 3, "why_wrong": "CSRF tricks users into actions, not script injection"}
        ]
      }
    },
    {
      "section_id": "D2-L006-S03",
      "title": "Other Web Attacks",
      "estimated_time": "12 minutes",
      "content": {
        "overview": "Additional web application attack techniques.",
        "core_concepts": [
          {
            "concept": "Cross-Site Request Forgery (CSRF/XSRF)",
            "mechanism": "Trick authenticated user into performing unwanted action",
            "example": "Hidden form on malicious site submits request to bank using user's cookies",
            "defense": "Anti-CSRF tokens, SameSite cookies"
          },
          {
            "concept": "Directory Traversal",
            "mechanism": "Access files outside intended directory using ../ sequences",
            "example": "../../../etc/passwd",
            "defense": "Input validation, chroot jails, remove path traversal sequences"
          },
          {
            "concept": "Session Attacks",
            "attacks": [
              {"attack": "Session Hijacking", "mechanism": "Steal session token to impersonate user"},
              {"attack": "Session Fixation", "mechanism": "Force user to use known session ID"},
              {"attack": "Cookie Manipulation", "mechanism": "Modify cookie values for unauthorized access"}
            ]
          },
          {
            "concept": "Server-Side Request Forgery (SSRF)",
            "mechanism": "Trick server into making requests to internal resources",
            "impact": "Access internal services, cloud metadata",
            "example": "URL parameter causes server to fetch internal admin page"
          }
        ]
      },
      "must_remember_for_exam": [
        {"fact": "CSRF tricks authenticated users into unwanted actions", "why_tested": "Attack type"},
        {"fact": "Anti-CSRF tokens prevent CSRF", "why_tested": "Defense"},
        {"fact": "Directory traversal uses ../ to escape directories", "why_tested": "Attack mechanism"},
        {"fact": "SSRF tricks server into making internal requests", "why_tested": "Attack type"}
      ],
      "key_points": ["CSRF tricks users into unwanted actions using their session", "Directory traversal uses ../ to access restricted files", "Session hijacking steals session tokens", "SSRF makes server request internal resources"]
    },
    {
      "section_id": "D2-L006-S04",
      "title": "Memory and Code Attacks",
      "estimated_time": "10 minutes",
      "content": {
        "overview": "Attacks targeting application memory and code execution.",
        "core_concepts": [
          {
            "concept": "Buffer Overflow",
            "mechanism": "Write data beyond allocated buffer, overwrite adjacent memory",
            "impact": "Crash application, execute arbitrary code",
            "defense": "Safe coding practices, ASLR, stack canaries, DEP/NX"
          },
          {
            "concept": "Integer Overflow",
            "mechanism": "Arithmetic operation exceeds integer size limits",
            "impact": "Unexpected behavior, security bypass"
          },
          {
            "concept": "Race Condition",
            "mechanism": "Exploit timing between check and use of resource",
            "example": "TOCTOU (Time of Check to Time of Use)",
            "impact": "Bypass security checks, corrupt data"
          },
          {
            "concept": "Memory Safety Defenses",
            "defenses": [
              {"defense": "ASLR", "full": "Address Space Layout Randomization", "function": "Randomize memory addresses"},
              {"defense": "DEP/NX", "full": "Data Execution Prevention / No Execute", "function": "Prevent code execution from data areas"},
              {"defense": "Stack Canaries", "function": "Detect buffer overflow attempts"}
            ]
          }
        ]
      },
      "must_remember_for_exam": [
        {"fact": "Buffer overflow writes beyond allocated memory", "why_tested": "Classic vulnerability"},
        {"fact": "ASLR randomizes memory addresses", "why_tested": "Defense mechanism"},
        {"fact": "DEP/NX prevents code execution from data areas", "why_tested": "Defense mechanism"},
        {"fact": "Race condition = timing vulnerability (TOCTOU)", "why_tested": "Vulnerability type"}
      ],
      "key_points": ["Buffer overflow writes beyond buffer boundaries", "ASLR randomizes addresses; DEP prevents data execution", "Race conditions exploit timing gaps"]
    }
  ],

  "summary": {
    "key_takeaways": [
      "SQL injection: parameterized queries are primary defense",
      "XSS: Reflected (URL), Stored (persistent), DOM-based (client-side)",
      "Output encoding prevents XSS; HttpOnly cookies protect session",
      "CSRF tricks users into actions; anti-CSRF tokens prevent",
      "Buffer overflow defenses: ASLR, DEP/NX, stack canaries"
    ],
    "exam_essentials": [
      "SQL injection defense = parameterized queries",
      "Stored XSS = persistent; Reflected XSS = in URL",
      "CSRF = tricking authenticated user into action",
      "Directory traversal uses ../ sequences",
      "ASLR randomizes memory; DEP prevents data execution"
    ]
  },

  "related_content": {
    "next_lesson": "D2-LESSON-007",
    "previous_lesson": "D2-LESSON-005"
  }
}
