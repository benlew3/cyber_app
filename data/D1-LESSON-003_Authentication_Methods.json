{
  "lesson_id": "D1-LESSON-003",
  "domain": 1,
  "title": "Authentication Methods",
  "objectives_covered": ["1.2"],
  "estimated_duration": "50-60 minutes",
  "difficulty": "beginner",
  "prerequisites": ["D1-LESSON-002"],

  "introduction": {
    "hook": "In 2023, over 80% of data breaches involved compromised credentials. Passwords alone are no longer enough - yet many organizations still rely on them as their only authentication method. From biometrics that can't be shared to hardware tokens that can't be phished, modern authentication provides layers of identity verification. Understanding these methods isn't just about passing the exam - it's about protecting the front door to every system you'll ever manage.",
    "learning_goals": [
      "Compare and contrast authentication factors (something you know, have, are, somewhere, do)",
      "Implement multi-factor authentication strategies appropriate for different risk levels",
      "Evaluate authentication protocols and their security properties",
      "Identify authentication vulnerabilities and appropriate countermeasures",
      "Select authentication methods based on security requirements and usability constraints"
    ],
    "why_it_matters": "Authentication is the foundation of access control - every permission decision starts with 'who is this user?' As a security professional, you'll configure authentication systems, investigate authentication failures, and recommend authentication improvements. Weak authentication is the #1 attack vector. On the exam, expect 5-8 questions on authentication factors, protocols, and implementations.",
    "career_relevance": {
      "soc_analyst": "You'll investigate failed authentications, detect brute force attacks, and identify compromised credentials",
      "incident_responder": "Credential theft and authentication bypass are common attack vectors you'll need to understand",
      "grc_analyst": "You'll assess authentication controls against compliance requirements like PCI DSS and HIPAA",
      "penetration_tester": "Testing authentication is a core skill - password spraying, token theft, MFA bypass",
      "security_engineer": "You'll design and implement authentication systems, federated identity, and SSO"
    }
  },

  "linux_fundamentals": {
    "why_linux": "Linux authentication forms the backbone of enterprise security. Understanding PAM, SSH keys, and local authentication is essential for any security role.",
    "essential_commands_this_lesson": [
      {
        "command": "cat /etc/passwd",
        "purpose": "View user account information",
        "example_output": "root:x:0:0:root:/root:/bin/bash"
      },
      {
        "command": "sudo cat /etc/shadow",
        "purpose": "View password hashes (requires root)",
        "example_output": "user:$6$salt$hash...:19000:0:99999:7:::"
      },
      {
        "command": "ssh-keygen -t ed25519",
        "purpose": "Generate SSH key pair (something you have)",
        "example_output": "Generating public/private ed25519 key pair..."
      },
      {
        "command": "passwd username",
        "purpose": "Change user password",
        "example_output": "Enter new UNIX password:"
      },
      {
        "command": "faillock --user username",
        "purpose": "Check failed login attempts (account lockout)",
        "example_output": "username: failures=3"
      }
    ]
  },

  "sections": [
    {
      "section_id": "D1-L003-S01",
      "title": "Authentication Factors: The Five Types",
      "content": "Authentication verifies identity by confirming one or more factors. Each factor type has different security properties, usability characteristics, and vulnerabilities.\n\n**Factor 1: Something You Know**\nSecrets that exist only in your memory.\n\nExamples:\n- Passwords\n- PINs\n- Security questions\n- Passphrases\n\nStrengths:\n- Easy to implement\n- No hardware required\n- Users are familiar with them\n\nWeaknesses:\n- Can be guessed or cracked\n- Can be phished or socially engineered\n- Users choose weak passwords or reuse them\n- Can be forgotten\n\n**Factor 2: Something You Have**\nPhysical objects that prove possession.\n\nExamples:\n- Hardware tokens (YubiKey, RSA SecurID)\n- Smart cards\n- Mobile phones (for SMS or authenticator apps)\n- ID badges\n\nStrengths:\n- Can't be guessed remotely\n- Provides physical evidence\n- Hardware tokens are phishing-resistant\n\nWeaknesses:\n- Can be lost, stolen, or forgotten\n- Hardware costs money\n- Replacement process needed\n- Some methods (SMS) can be intercepted\n\n**Factor 3: Something You Are**\nBiometric characteristics unique to you.\n\nExamples:\n- Fingerprints\n- Facial recognition\n- Iris/retina scans\n- Voice recognition\n- Vein patterns\n\nStrengths:\n- Can't be forgotten or lost\n- Difficult to share or transfer\n- Convenient (always with you)\n\nWeaknesses:\n- Can't be changed if compromised\n- Privacy concerns\n- False acceptance/rejection rates\n- Requires special hardware\n- Can be fooled with sufficient effort\n\n**Factor 4: Somewhere You Are**\nLocation-based authentication.\n\nExamples:\n- GPS location\n- IP address geolocation\n- Network location (on corporate network)\n- Physical presence (badge reader location)\n\nStrengths:\n- Adds context to authentication decisions\n- Can detect impossible travel\n- Transparent to users\n\nWeaknesses:\n- Location can be spoofed (VPN, GPS spoofing)\n- Privacy implications\n- May block legitimate travel\n- Not reliable as sole factor\n\n**Factor 5: Something You Do**\nBehavioral patterns unique to individuals.\n\nExamples:\n- Typing patterns (keystroke dynamics)\n- Mouse movement patterns\n- Gait analysis\n- Signature dynamics\n\nStrengths:\n- Continuous authentication possible\n- Hard to impersonate\n- Transparent to users\n\nWeaknesses:\n- High false rejection rates\n- Patterns change over time\n- Requires learning period\n- Still emerging technology",

      "key_points": [
        "Five authentication factors: Know, Have, Are, Somewhere, Do",
        "Each factor has distinct security properties and vulnerabilities",
        "Something you know is most common but most vulnerable to remote attacks",
        "Something you are (biometrics) can't be changed if compromised",
        "Something you have (hardware tokens) provides phishing resistance"
      ],

      "real_world_example": {
        "scenario": "Multi-factor authentication implementation",
        "company": "Pinnacle Financial Services",
        "application": "Pinnacle implemented different authentication levels based on risk: STANDARD ACCESS (email, intranet) - Password + authenticator app (know + have). PRIVILEGED ACCESS (admin systems) - Password + hardware token + IP restriction (know + have + somewhere). CRITICAL ACCESS (wire transfers) - All above + manager approval + behavioral analysis (all five factors engaged). This tiered approach balances security with usability."
      },

      "career_callout": {
        "role": "Security Engineer",
        "insight": "When designing authentication systems, you'll balance security against usability. Requiring hardware tokens for every login might be more secure but could impact productivity and frustrate users. Understanding factor strengths helps you select appropriate authentication for each risk level."
      },

      "exam_tips": [
        "Know all five factor types and examples of each",
        "Password = something you KNOW (most common exam answer)",
        "Smart card = something you HAVE",
        "Fingerprint = something you ARE",
        "IP address restriction = somewhere you ARE",
        "Keystroke dynamics = something you DO"
      ],

      "glossary_terms": [
        {
          "term": "Authentication Factor",
          "definition": "A category of evidence used to verify identity, including something you know, have, are, somewhere you are, or something you do.",
          "exam_note": "Five types. Know all examples. Multi-factor uses 2+ DIFFERENT factor types."
        },
        {
          "term": "Biometric Authentication",
          "definition": "Authentication based on unique physical or behavioral characteristics of an individual.",
          "exam_note": "Something you ARE. Can't change if compromised. FAR/FRR are key metrics."
        },
        {
          "term": "Hardware Token",
          "definition": "A physical device that generates or stores authentication credentials, such as one-time passwords or cryptographic keys.",
          "exam_note": "Something you HAVE. Phishing-resistant. YubiKey, RSA SecurID are examples."
        }
      ],

      "knowledge_check": {
        "question": "A company requires employees to authenticate using a password and a code from their mobile authenticator app. Which authentication factors are being used?",
        "options": [
          "Two instances of something you know",
          "Something you know and something you have",
          "Something you know and something you are",
          "Something you have and somewhere you are"
        ],
        "correct": 1,
        "explanation": "The password is something you KNOW. The mobile authenticator app represents something you HAVE (possession of the enrolled phone). The code itself is generated by the device you possess. This is true multi-factor authentication using two different factor types."
      }
    },
    {
      "section_id": "D1-L003-S02",
      "title": "Multi-Factor Authentication (MFA)",
      "content": "Multi-factor authentication requires two or more different authentication factor types. Using two passwords would be two-step authentication, but NOT multi-factor because both are 'something you know.'\n\n**MFA Requirements**\nTrue MFA requires factors from DIFFERENT categories:\n- Password + Fingerprint (know + are) = MFA\n- Password + SMS code (know + have) = MFA\n- Password + Security question (know + know) = NOT MFA\n- Fingerprint + Iris scan (are + are) = NOT MFA (same category)\n\n**Common MFA Implementations**\n\n**SMS-Based**\n- How it works: Code sent via text message\n- Pros: Widely supported, no app needed\n- Cons: SIM swapping, SS7 vulnerabilities, social engineering\n- Security rating: Weak - better than nothing, but vulnerable\n\n**Authenticator Apps (TOTP)**\n- How it works: Time-based codes generated locally\n- Examples: Google Authenticator, Microsoft Authenticator, Authy\n- Pros: No network needed, more secure than SMS\n- Cons: Phone must be enrolled, backup codes needed\n- Security rating: Good - phishing-resistant to most attacks\n\n**Push Notifications**\n- How it works: Approve/deny prompt sent to phone\n- Examples: Duo Push, Microsoft Authenticator push\n- Pros: Convenient, shows context (location, app)\n- Cons: MFA fatigue attacks, requires internet\n- Security rating: Good - but vulnerable to prompt bombing\n\n**Hardware Tokens (FIDO2/WebAuthn)**\n- How it works: Cryptographic challenge-response\n- Examples: YubiKey, Titan Key\n- Pros: Phishing-proof, no shared secrets\n- Cons: Cost, loss/replacement procedures\n- Security rating: Excellent - gold standard\n\n**MFA Bypass Attacks**\n\n1. **Phishing**: Steal password and intercept MFA code in real-time\n2. **SIM Swapping**: Port victim's number to attacker's SIM\n3. **MFA Fatigue**: Spam push notifications until user approves\n4. **Man-in-the-Middle**: Proxy entire session including MFA\n5. **Session Hijacking**: Steal session token after MFA completes\n6. **Social Engineering**: Call support to bypass MFA\n\n**MFA Best Practices**\n- Prefer hardware tokens for privileged accounts\n- Use phishing-resistant methods (FIDO2)\n- Implement number matching for push notifications\n- Have backup methods and recovery procedures\n- Monitor for MFA bypass attempts",

      "key_points": [
        "True MFA requires factors from DIFFERENT categories",
        "SMS-based MFA is weakest but better than nothing",
        "Hardware tokens (FIDO2) are phishing-resistant - gold standard",
        "MFA can be bypassed through phishing, SIM swapping, and fatigue attacks",
        "Number matching helps prevent MFA fatigue attacks"
      ],

      "real_world_example": {
        "scenario": "MFA fatigue attack leads to breach",
        "company": "Global Tech Corporation (fictionalized real incident)",
        "application": "Attackers obtained an employee's password through credential stuffing. They then triggered MFA push notifications repeatedly - over 100 in one hour - in the middle of the night. Exhausted and wanting the alerts to stop, the employee finally approved one. Attackers gained access and moved laterally for weeks before detection. LESSON: Implement rate limiting, number matching, and user education about MFA fatigue attacks."
      },

      "career_callout": {
        "role": "SOC Analyst",
        "insight": "You'll monitor for MFA-related alerts: multiple failed MFA attempts, successful MFA from unusual locations, MFA enrollment changes. Understanding MFA attack patterns helps you distinguish between a user who forgot their token and an attacker trying to brute force MFA codes."
      },

      "visualization": {
        "type": "ascii_diagram",
        "title": "MFA Strength Comparison",
        "diagram": [
          "MFA METHOD SECURITY COMPARISON",
          "================================",
          "",
          "WEAKEST                                         STRONGEST",
          "  |                                                 |",
          "  v                                                 v",
          "[SMS] --> [Email] --> [TOTP App] --> [Push] --> [FIDO2/Hardware]",
          "  |          |            |            |              |",
          "  |          |            |            |              +-- Phishing-proof",
          "  |          |            |            +-- Requires user action",
          "  |          |            +-- Time-based, no network needed",
          "  |          +-- Same issues as SMS",
          "  +-- SIM swapping, SS7 attacks",
          "",
          "RECOMMENDATION: FIDO2 for privileged, TOTP minimum for standard"
        ]
      },

      "exam_tips": [
        "Two passwords is NOT MFA (same factor type)",
        "SMS is weakest MFA but still counts as 'something you have'",
        "FIDO2/WebAuthn/hardware tokens are phishing-resistant",
        "MFA fatigue = spamming push notifications until user approves",
        "Know the difference between 2FA, MFA, and two-step verification"
      ],

      "glossary_terms": [
        {
          "term": "Multi-Factor Authentication (MFA)",
          "definition": "An authentication method requiring two or more different types of authentication factors to verify identity.",
          "exam_note": "Must be DIFFERENT factor types. Two passwords is not MFA."
        },
        {
          "term": "TOTP (Time-based One-Time Password)",
          "definition": "An algorithm that generates temporary codes based on current time and a shared secret, used in authenticator apps.",
          "exam_note": "30-second codes typically. Google Authenticator, Authy. Better than SMS."
        },
        {
          "term": "FIDO2/WebAuthn",
          "definition": "A passwordless authentication standard using public-key cryptography to provide phishing-resistant authentication.",
          "exam_note": "Phishing-proof. Hardware tokens or platform authenticators. Gold standard."
        },
        {
          "term": "MFA Fatigue",
          "definition": "An attack where adversaries repeatedly trigger MFA push notifications hoping the user will approve one out of frustration.",
          "exam_note": "Counter with number matching, rate limiting, user education."
        }
      ],

      "knowledge_check": {
        "question": "An organization wants to implement the strongest possible MFA for their privileged administrator accounts. Which method should they choose?",
        "options": [
          "SMS-based codes because they're the most widely supported",
          "Security questions as a backup to passwords",
          "FIDO2 hardware security keys because they're phishing-resistant",
          "Push notifications because they're convenient for users"
        ],
        "correct": 2,
        "explanation": "FIDO2 hardware security keys provide phishing-resistant authentication through cryptographic challenge-response. Unlike SMS (vulnerable to SIM swapping), security questions (not even MFA), or push notifications (vulnerable to fatigue attacks), hardware keys cannot be phished because authentication is bound to the legitimate site."
      }
    },
    {
      "section_id": "D1-L003-S03",
      "title": "Authentication Protocols",
      "content": "Authentication protocols define how identity information is exchanged and verified. Understanding these protocols helps you configure systems securely and troubleshoot authentication issues.\n\n**Local Authentication**\nVerification against local system credentials.\n\n*Linux: PAM (Pluggable Authentication Modules)*\n- Modular authentication framework\n- Configurable per-application authentication\n- Supports various backends (local, LDAP, Kerberos)\n- Configuration in /etc/pam.d/\n\n*Windows: SAM and NTLM*\n- SAM: Security Account Manager (local accounts)\n- NTLM: NT LAN Manager (legacy protocol)\n- Still used for backward compatibility\n- Vulnerable to pass-the-hash attacks\n\n**Directory Services**\n\n*LDAP (Lightweight Directory Access Protocol)*\n- Standard protocol for directory services\n- Stores user accounts, groups, attributes\n- Used by Active Directory, OpenLDAP\n- Port 389 (LDAP), Port 636 (LDAPS - encrypted)\n\n*Active Directory*\n- Microsoft's directory service\n- Uses LDAP for queries\n- Uses Kerberos for authentication\n- Central management of Windows environments\n\n**Kerberos**\nTicket-based authentication protocol.\n\nComponents:\n- KDC (Key Distribution Center): Issues tickets\n- TGT (Ticket Granting Ticket): Initial ticket after login\n- Service Ticket: Access to specific services\n- Realm: Kerberos trust domain\n\nProcess:\n1. User authenticates to KDC, receives TGT\n2. TGT used to request service tickets\n3. Service tickets grant access to resources\n4. Single sign-on - no re-entering credentials\n\nStrengths:\n- No passwords sent over network\n- Mutual authentication\n- Single sign-on capability\n- Time-limited tickets\n\nWeaknesses:\n- Time synchronization critical\n- KDC is single point of failure\n- Pass-the-ticket attacks possible\n- Requires proper implementation\n\n**RADIUS and TACACS+**\n\n*RADIUS (Remote Authentication Dial-In User Service)*\n- Centralized authentication for network access\n- Used for VPN, Wi-Fi, network devices\n- UDP ports 1812/1813 (or legacy 1645/1646)\n- Encrypts only password, not full packet\n\n*TACACS+ (Terminal Access Controller Access-Control System Plus)*\n- Cisco-developed protocol\n- TCP port 49\n- Encrypts entire packet\n- Separates authentication, authorization, accounting\n- Preferred for network device administration",

      "key_points": [
        "Kerberos uses tickets - no passwords sent over network",
        "LDAP is for directory queries; Kerberos is for authentication",
        "RADIUS encrypts only password; TACACS+ encrypts entire packet",
        "RADIUS for network access; TACACS+ for device administration",
        "Active Directory uses both LDAP and Kerberos"
      ],

      "real_world_example": {
        "scenario": "Kerberos golden ticket attack",
        "company": "Meridian Manufacturing",
        "application": "Attackers compromised Meridian's domain controller and extracted the KRBTGT account hash. With this, they created 'golden tickets' - forged Kerberos tickets granting unlimited access to any resource. The tickets had 10-year lifetimes and persisted even after password resets. DETECTION: Unusual service ticket requests, tickets with abnormally long lifetimes. REMEDIATION: KRBTGT password must be reset TWICE (due to password history) and all user passwords changed."
      },

      "career_callout": {
        "role": "Penetration Tester",
        "insight": "Kerberos attacks (Kerberoasting, Golden Ticket, Silver Ticket, Pass-the-Ticket) are essential skills. Understanding how Kerberos works lets you identify attack opportunities and explain findings. Similarly, RADIUS and TACACS+ misconfigurations are common findings in network penetration tests."
      },

      "visualization": {
        "type": "ascii_diagram",
        "title": "Kerberos Authentication Flow",
        "diagram": [
          "      USER                    KDC                    SERVICE",
          "        |                      |                        |",
          "        |---(1) Request TGT--->|                        |",
          "        |    (username)        |                        |",
          "        |                      |                        |",
          "        |<--(2) TGT Response---|                        |",
          "        |    (encrypted TGT)   |                        |",
          "        |                      |                        |",
          "        |---(3) Request Svc--->|                        |",
          "        |    Ticket (w/ TGT)   |                        |",
          "        |                      |                        |",
          "        |<--(4) Service Ticket-|                        |",
          "        |                      |                        |",
          "        |---(5) Access Request----------------------->|",
          "        |    (with Service Ticket)                     |",
          "        |                                               |",
          "        |<--(6) Service Access Granted-----------------|",
          "",
          "KEY: Password NEVER sent over network - only encrypted tickets"
        ]
      },

      "exam_tips": [
        "Kerberos = tickets, port 88, requires time sync",
        "LDAP = directory queries, ports 389/636, NOT authentication itself",
        "RADIUS = encrypts PASSWORD only, UDP",
        "TACACS+ = encrypts ENTIRE packet, TCP, separates AAA",
        "Active Directory = LDAP + Kerberos together"
      ],

      "glossary_terms": [
        {
          "term": "Kerberos",
          "definition": "A ticket-based network authentication protocol that uses symmetric key cryptography to provide secure authentication without sending passwords over the network.",
          "exam_note": "Tickets, KDC, TGT. Port 88. Requires time sync within 5 minutes."
        },
        {
          "term": "LDAP",
          "definition": "A protocol for accessing and maintaining distributed directory information services, commonly used to store and query user account information.",
          "exam_note": "Directory queries, not authentication. Ports 389/636. Used by Active Directory."
        },
        {
          "term": "RADIUS",
          "definition": "A networking protocol providing centralized authentication, authorization, and accounting for network access.",
          "exam_note": "UDP. Encrypts password only. Network access (VPN, Wi-Fi)."
        },
        {
          "term": "TACACS+",
          "definition": "A Cisco protocol providing centralized AAA services with full packet encryption and separation of authentication, authorization, and accounting.",
          "exam_note": "TCP port 49. Full encryption. Better for device admin. Cisco preferred."
        }
      ],

      "knowledge_check": {
        "question": "A network administrator needs to centralize authentication for their network switches and routers. They need the protocol to separate authentication, authorization, and accounting functions and encrypt all communication. Which protocol should they choose?",
        "options": [
          "RADIUS because it's the industry standard for network device authentication",
          "LDAP because it provides directory services for centralized management",
          "TACACS+ because it encrypts the entire packet and separates AAA functions",
          "Kerberos because it provides ticket-based authentication"
        ],
        "correct": 2,
        "explanation": "TACACS+ is the correct answer because it encrypts the entire packet (not just the password like RADIUS) and separates authentication, authorization, and accounting functions. This is particularly important for network device administration where granular command authorization is needed. RADIUS encrypts only the password, LDAP is for directory queries, and Kerberos is for ticket-based domain authentication."
      }
    },
    {
      "section_id": "D1-L003-S04",
      "title": "Single Sign-On and Federation",
      "content": "Single Sign-On (SSO) and federation allow users to authenticate once and access multiple systems, improving usability while potentially improving security through stronger, centralized authentication.\n\n**Single Sign-On (SSO)**\nAuthenticate once, access many applications.\n\nBenefits:\n- User convenience (fewer passwords)\n- Reduced password fatigue (better password choices)\n- Centralized authentication control\n- Easier access revocation\n- Better logging and monitoring\n\nRisks:\n- Single point of failure\n- If compromised, attacker gets everything\n- Requires strong initial authentication\n- Session management critical\n\n**Federation**\nTrust between separate organizations/systems.\n\n*How It Works*:\n- Identity Provider (IdP): Authenticates users, issues assertions\n- Service Provider (SP): Relies on IdP for authentication\n- Trust relationship established between IdP and SP\n- User authenticates to IdP, receives token/assertion\n- Token presented to SP for access\n\n**Federation Protocols**\n\n*SAML (Security Assertion Markup Language)*\n- XML-based standard\n- Web browser SSO\n- Assertions contain identity and attributes\n- Common in enterprise environments\n- Uses HTTP redirects and POST\n\n*OAuth 2.0*\n- Authorization framework (not authentication)\n- Delegates access without sharing credentials\n- 'Login with Google/Facebook' uses OAuth\n- Access tokens, refresh tokens\n- Scope defines permissions\n\n*OpenID Connect (OIDC)*\n- Authentication layer on top of OAuth 2.0\n- Provides identity information\n- ID tokens contain user info\n- Modern replacement for SAML in many cases\n- REST/JSON based (easier than SAML XML)\n\n**Token Types**\n\n*Bearer Token*: Anyone with the token can use it\n*JWT (JSON Web Token)*: Self-contained token with claims\n*Refresh Token*: Long-lived token to get new access tokens\n*ID Token*: Contains identity information (OIDC)\n\n**Federated Identity Management**\n\n*SAML Flow*:\n1. User accesses Service Provider\n2. SP redirects to Identity Provider\n3. User authenticates to IdP\n4. IdP sends SAML assertion to SP\n5. SP grants access based on assertion\n\n*Common Use Cases*:\n- Enterprise SSO to cloud applications\n- Partner access to shared resources\n- Customer identity federation (social logins)\n- Cross-organization collaboration",

      "key_points": [
        "SSO = authenticate once, access many applications",
        "Federation = trust between organizations using Identity/Service Providers",
        "SAML = XML-based, enterprise SSO, assertions",
        "OAuth = authorization (not authentication), access delegation",
        "OIDC = authentication built on OAuth, modern alternative to SAML"
      ],

      "real_world_example": {
        "scenario": "SSO implementation improves security and usability",
        "company": "NexaTech Solutions",
        "application": "NexaTech had 47 different applications, each with separate credentials. Users averaged 12 passwords, leading to weak passwords and frequent resets. They implemented SSO with SAML federation: Single password + MFA for all apps. Password resets dropped 85%. Help desk tickets down 40%. Security improved - now one strong password with MFA instead of 12 weak ones. Account deprovisioning instant - disable SSO account, access to all 47 apps revoked."
      },

      "career_callout": {
        "role": "GRC Analyst",
        "insight": "SSO and federation have significant compliance implications. You'll assess whether SSO implementations meet regulatory requirements - does the MFA strength satisfy PCI DSS? Are session timeouts appropriate for HIPAA? Is access logging comprehensive for SOX? Understanding these protocols helps you evaluate control effectiveness."
      },

      "visualization": {
        "type": "ascii_diagram",
        "title": "SAML Federation Flow",
        "diagram": [
          "    USER              SERVICE PROVIDER              IDENTITY PROVIDER",
          "      |                      |                            |",
          "      |---(1) Access App---->|                            |",
          "      |                      |                            |",
          "      |<-(2) Redirect to IdP-|                            |",
          "      |                      |                            |",
          "      |---(3) Authentication Request-------------------->|",
          "      |                                                   |",
          "      |                    [User enters credentials]      |",
          "      |                                                   |",
          "      |<--(4) SAML Assertion (signed)-------------------|",
          "      |                      |                            |",
          "      |---(5) Assertion----->|                            |",
          "      |                      |                            |",
          "      |<-(6) Access Granted--|                            |",
          "",
          "NOTE: SP trusts IdP's signed assertion - never sees password"
        ]
      },

      "exam_tips": [
        "OAuth is AUTHORIZATION (not authentication) - delegating access",
        "OIDC adds AUTHENTICATION to OAuth",
        "SAML uses XML assertions; OIDC uses JSON tokens",
        "IdP authenticates users; SP relies on IdP",
        "SSO risk: if compromised, attacker accesses everything"
      ],

      "glossary_terms": [
        {
          "term": "Single Sign-On (SSO)",
          "definition": "An authentication scheme allowing users to authenticate once and gain access to multiple applications without re-entering credentials.",
          "exam_note": "One login, many apps. Improves usability. Risk: single point of compromise."
        },
        {
          "term": "SAML",
          "definition": "Security Assertion Markup Language - an XML-based standard for exchanging authentication and authorization data between identity and service providers.",
          "exam_note": "XML assertions. Enterprise SSO. IdP and SP relationship."
        },
        {
          "term": "OAuth",
          "definition": "An open standard for access delegation, commonly used to grant applications limited access to user accounts without exposing passwords.",
          "exam_note": "AUTHORIZATION, not authentication. 'Login with Google' uses this."
        },
        {
          "term": "OpenID Connect (OIDC)",
          "definition": "An authentication layer built on OAuth 2.0 that enables identity verification and retrieval of basic profile information.",
          "exam_note": "OAuth + authentication. JSON/REST based. Modern SAML alternative."
        }
      ],

      "knowledge_check": {
        "question": "A web application wants to let users sign in using their Google accounts without the application ever seeing the user's Google password. Which protocol enables this?",
        "options": [
          "LDAP because Google uses directory services",
          "Kerberos because it provides ticket-based authentication",
          "OAuth/OpenID Connect because they allow delegated authentication without sharing credentials",
          "RADIUS because it provides centralized authentication"
        ],
        "correct": 2,
        "explanation": "OAuth (for authorization) and OpenID Connect (for authentication) enable 'Sign in with Google' functionality. The user authenticates directly to Google (the Identity Provider), and Google provides the application (Service Provider) with tokens confirming the user's identity - without the application ever seeing the Google password. This is federated identity in action."
      }
    },
    {
      "section_id": "D1-L003-S05",
      "title": "Password Security and Management",
      "content": "Despite their weaknesses, passwords remain the most common authentication method. Proper password security requires understanding attacks, implementing strong policies, and using password management tools.\n\n**Password Attacks**\n\n*Brute Force*: Try every possible combination\n- Time consuming for long passwords\n- Effective against short/simple passwords\n- Counter: Length requirements, lockout policies\n\n*Dictionary Attack*: Try common words and variations\n- Faster than brute force\n- Uses wordlists of common passwords\n- Counter: Complexity requirements, not using common words\n\n*Password Spraying*: Few passwords against many accounts\n- Avoids lockout policies\n- Uses most common passwords (Password1!, Summer2024!)\n- Counter: Detect distributed failures, ban common passwords\n\n*Credential Stuffing*: Leaked credentials from other sites\n- Exploits password reuse\n- Automated testing of breach databases\n- Counter: MFA, password managers, breach monitoring\n\n*Phishing*: Social engineering for credentials\n- User willingly enters password on fake site\n- Counters: User training, anti-phishing tools, FIDO2\n\n**Password Policy Best Practices**\n\n*Modern Guidance (NIST 800-63B)*:\n- Minimum 8 characters (12+ for privileged)\n- Check against breach databases\n- Don't force periodic changes without reason\n- Don't require complexity rules (they don't help)\n- Allow paste from password managers\n- Use passphrases\n\n*What Doesn't Work*:\n- Forced regular rotation (users just increment: Password1, Password2)\n- Complexity requirements (leads to Password1!)\n- Security questions (easily researched)\n- Short minimum length (brute force easy)\n\n**Password Storage**\n\nHow systems should store passwords:\n1. Never store plaintext\n2. Use slow hashing algorithms (bcrypt, scrypt, Argon2)\n3. Use unique salt per password\n4. Consider peppering (server-side secret)\n\n*Why Slow Hashing?*\nMD5/SHA1: Billions of hashes per second (bad)\nbcrypt: Thousands of hashes per second (good)\nSlow hashing makes brute force impractical.\n\n**Password Managers**\n\nBenefits:\n- Unique password for every site\n- Complex passwords without memorizing\n- Secure storage and autofill\n- Breach detection features\n\nPopular options:\n- 1Password, Bitwarden, LastPass\n- Enterprise: CyberArk, Keeper, HashiCorp Vault",

      "key_points": [
        "Modern guidance: length > complexity, don't force rotation, ban common passwords",
        "Password spraying avoids lockouts by trying few passwords against many accounts",
        "Credential stuffing exploits password reuse from previous breaches",
        "Use slow hashing (bcrypt, Argon2) with unique salts for password storage",
        "Password managers enable unique, complex passwords for every site"
      ],

      "real_world_example": {
        "scenario": "Password spraying attack against enterprise",
        "company": "Coastal Community Bank",
        "application": "Attackers used password spraying against Coastal's VPN, trying 'Summer2024!' and 'Coastal123!' against thousands of accounts - just 2 attempts per account to avoid lockouts. Over three weeks, they gained access to 14 accounts. Attackers bypassed MFA using SIM swapping for SMS codes. DETECTION FAILURE: Logs showed 2 failures per account - didn't trigger 5-attempt lockout. LESSON: Monitor for distributed low-volume failures, implement phishing-resistant MFA, ban company name and seasonal passwords."
      },

      "career_callout": {
        "role": "SOC Analyst",
        "insight": "You'll hunt for password attacks daily. Key indicators: distributed authentication failures (spray), single account rapid failures (brute force), logins from impossible locations after credential dumps. Build SIEM queries that detect these patterns. Also monitor dark web for company credentials in breach dumps."
      },

      "tool_spotlight": {
        "name": "Have I Been Pwned",
        "category": "Breach Monitoring",
        "description": "Free service to check if credentials appear in known breaches",
        "free_tier": "Yes - personal and API available",
        "website": "https://haveibeenpwned.com",
        "career_relevance": "SOC analysts use the API to check exposed credentials; security engineers integrate it into password policies"
      },

      "exam_tips": [
        "NIST 800-63B: Length matters more than complexity",
        "Password spraying = few passwords, many accounts (avoids lockout)",
        "Credential stuffing = using leaked passwords from other breaches",
        "bcrypt, scrypt, Argon2 are good for password hashing (intentionally slow)",
        "MD5/SHA1 are BAD for password storage (too fast to hash)"
      ],

      "glossary_terms": [
        {
          "term": "Password Spraying",
          "definition": "An attack that attempts a few common passwords against many accounts to avoid account lockout triggers.",
          "exam_note": "Different from brute force. Distributed across accounts. Harder to detect."
        },
        {
          "term": "Credential Stuffing",
          "definition": "An attack using username/password pairs obtained from data breaches to gain unauthorized access to user accounts on other services.",
          "exam_note": "Exploits password reuse. Use breach monitoring. MFA blocks this."
        },
        {
          "term": "Password Salting",
          "definition": "Adding a unique random value to each password before hashing to prevent rainbow table attacks and ensure identical passwords have different hashes.",
          "exam_note": "Each password gets unique salt. Prevents precomputed attacks."
        },
        {
          "term": "bcrypt",
          "definition": "A password hashing function designed to be computationally expensive, making brute force attacks impractical.",
          "exam_note": "Slow by design. Better than MD5/SHA for passwords. Industry standard."
        }
      ],

      "knowledge_check": {
        "question": "A security team notices that many accounts are receiving exactly 2 failed login attempts each, spread across the organization over several days. No account lockouts have triggered. What type of attack is this most likely?",
        "options": [
          "Brute force attack targeting password complexity",
          "Credential stuffing using leaked passwords",
          "Password spraying trying common passwords below lockout threshold",
          "Dictionary attack against a single high-value account"
        ],
        "correct": 2,
        "explanation": "This pattern - a few failures per account across many accounts - is characteristic of password spraying. Attackers stay below the lockout threshold (often 5 attempts) by trying just 1-2 common passwords per account. The distributed nature across many accounts and days suggests systematic spraying. Brute force and dictionary attacks typically target single accounts with many attempts."
      }
    }
  ],

  "deep_dive": {
    "title": "Hands-On Lab: Linux Authentication",
    "introduction": "Practice configuring and testing authentication controls on Linux systems.",
    "prerequisites": [
      "Linux VM (Ubuntu 22.04 LTS recommended)",
      "Sudo access",
      "SSH installed"
    ],
    "labs": [
      {
        "lab_id": "LAB-003-1",
        "title": "Lab 1: SSH Key Authentication (Something You Have)",
        "objective": "Configure passwordless SSH using key pairs",
        "estimated_time": "15 minutes",
        "steps": [
          {
            "step": 1,
            "instruction": "Generate an SSH key pair",
            "command": "ssh-keygen -t ed25519 -C 'security-lab-key'",
            "expected_output": "Generating public/private ed25519 key pair...",
            "explanation": "Creates a key pair - private key stays with you (something you have), public key goes to servers"
          },
          {
            "step": 2,
            "instruction": "View the public key",
            "command": "cat ~/.ssh/id_ed25519.pub",
            "expected_output": "ssh-ed25519 AAAA... security-lab-key",
            "explanation": "This public key will be added to servers you want to access"
          },
          {
            "step": 3,
            "instruction": "Copy public key to authorized_keys (local test)",
            "command": "cat ~/.ssh/id_ed25519.pub >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys",
            "expected_output": "(no output)",
            "explanation": "Adding your public key to your own authorized_keys for testing"
          },
          {
            "step": 4,
            "instruction": "Test SSH key authentication",
            "command": "ssh -i ~/.ssh/id_ed25519 localhost 'echo Key auth successful!'",
            "expected_output": "Key auth successful!",
            "explanation": "If you see the message, key authentication is working"
          }
        ],
        "control_mapping": {
          "principle": "Authentication - Something You Have",
          "control_type": "Technical/Preventive",
          "frameworks": ["CIS Control 5.2", "NIST 800-53 IA-2"]
        }
      },
      {
        "lab_id": "LAB-003-2",
        "title": "Lab 2: Password Policy Configuration",
        "objective": "Configure password strength requirements using PAM",
        "estimated_time": "15 minutes",
        "steps": [
          {
            "step": 1,
            "instruction": "Install password quality checking",
            "command": "sudo apt install -y libpam-pwquality",
            "expected_output": "(installation output)",
            "explanation": "pwquality module enforces password complexity rules"
          },
          {
            "step": 2,
            "instruction": "View current password policy",
            "command": "cat /etc/security/pwquality.conf",
            "expected_output": "(default configuration)",
            "explanation": "Current password policy settings"
          },
          {
            "step": 3,
            "instruction": "Configure minimum length (create backup first)",
            "command": "sudo cp /etc/security/pwquality.conf /etc/security/pwquality.conf.bak && echo 'minlen = 12' | sudo tee -a /etc/security/pwquality.conf",
            "expected_output": "minlen = 12",
            "explanation": "Requiring 12-character minimum aligns with modern guidance"
          },
          {
            "step": 4,
            "instruction": "Test password policy",
            "command": "echo 'short' | pwscore",
            "expected_output": "Password quality check failed...",
            "explanation": "Short passwords should now be rejected"
          }
        ],
        "control_mapping": {
          "principle": "Authentication - Something You Know",
          "control_type": "Technical/Preventive",
          "frameworks": ["CIS Control 5.3", "NIST 800-53 IA-5"]
        }
      }
    ]
  },

  "practice_platforms": {
    "title": "Where to Practice Authentication Concepts",
    "platforms": [
      {
        "name": "TryHackMe",
        "url": "https://tryhackme.com",
        "relevant_rooms": ["Active Directory Basics", "Attacking Kerberos", "Password Attacks"]
      },
      {
        "name": "HackTheBox Academy",
        "url": "https://academy.hackthebox.com",
        "relevant_modules": ["Introduction to Active Directory", "Password Attacks"]
      },
      {
        "name": "LetsDefend",
        "url": "https://letsdefend.io",
        "relevant_paths": ["SOC Analyst path includes authentication monitoring"]
      }
    ]
  },

  "hands_on_activity": {
    "title": "Authentication Risk Assessment",
    "objective": "Assess authentication methods for different scenarios",
    "scenario": "You're consulting for a company with three user groups: 1) General employees accessing email and files, 2) IT administrators with privileged system access, 3) Customers accessing an external portal. Design authentication requirements for each.",
    "steps": [
      "List authentication factors appropriate for each group",
      "Recommend specific MFA methods for each",
      "Identify risks if authentication is compromised",
      "Document compensating controls for MFA bypass scenarios",
      "Create a table comparing your recommendations"
    ],
    "expected_outcome": "A tiered authentication strategy with risk-appropriate controls for each user type",
    "reflection_questions": [
      "Why shouldn't all users have the same authentication requirements?",
      "What's the cost (money and usability) of hardware tokens for each group?",
      "How do you handle MFA for users who lose their device?",
      "What monitoring should you implement for each authentication tier?"
    ]
  },

  "what_would_you_do": {
    "scenario": "The Password Debate",
    "context": "Your company currently requires password changes every 90 days with complexity requirements (uppercase, lowercase, number, special character). IT leadership has read that NIST now recommends against forced rotation. Some executives are skeptical about changing 'what's always worked.' You need to present a recommendation.",
    "question": "How do you approach modernizing the password policy?",
    "options": [
      {
        "id": "a",
        "text": "Keep the current policy - if it's not broken, don't fix it",
        "is_best": false,
        "feedback": "The current policy IS broken - it leads to predictable passwords (Company1!, Company2!) and user frustration. Keeping it ignores evidence-based guidance.",
        "consequences": "Password spraying attacks succeed because users create predictable patterns. Password reset tickets remain high."
      },
      {
        "id": "b",
        "text": "Remove rotation AND complexity requirements immediately",
        "is_best": false,
        "feedback": "While NIST guidance is good, removing all requirements without compensating controls (like breach monitoring or MFA) could weaken security short-term.",
        "consequences": "Some users choose very weak passwords. Without breach monitoring, compromised credentials go undetected."
      },
      {
        "id": "c",
        "text": "Implement NIST recommendations: longer minimum, breach monitoring, MFA, ban common passwords, remove forced rotation",
        "is_best": true,
        "feedback": "This comprehensive approach follows modern guidance: length > complexity, check against breach databases, add MFA, ban known bad passwords. Present data showing 90-day rotation leads to predictable patterns.",
        "consequences": "Users create stronger passphrases. MFA blocks credential theft. Breach monitoring catches exposed passwords. Help desk tickets decrease."
      },
      {
        "id": "d",
        "text": "Let users choose their own password policy",
        "is_best": false,
        "feedback": "Users generally choose convenience over security. A consistent policy applied appropriately is necessary for organizational security.",
        "consequences": "Inconsistent security posture. Some users choose strong passwords, many don't. No way to ensure minimum security baseline."
      }
    ],
    "key_lesson": "Security policy changes should be evidence-based and comprehensive. NIST 800-63B recommendations work because they address real user behavior. But policy changes need compensating controls (MFA, breach monitoring) to succeed."
  },

  "summary": {
    "key_takeaways": [
      "Five authentication factors: know, have, are, somewhere, do - true MFA requires different types",
      "Hardware tokens (FIDO2) provide phishing-resistant authentication - gold standard for privileged accounts",
      "Kerberos uses tickets (not passwords over the wire); RADIUS encrypts password only; TACACS+ encrypts everything",
      "OAuth is authorization (not authentication); OIDC adds authentication to OAuth; SAML is XML-based enterprise SSO",
      "Modern password guidance: length > complexity, don't force rotation, ban common passwords, use slow hashing"
    ],
    "exam_essentials": [
      "Know all five factor types and examples of each",
      "Understand MFA vs. two-step verification (different factor types required)",
      "Compare RADIUS (encrypts password) vs TACACS+ (encrypts all)",
      "Know OAuth vs OIDC vs SAML differences",
      "Password attacks: brute force, dictionary, spraying, stuffing - know the differences"
    ],
    "connection_to_next": "Authentication verifies WHO you are. The next lesson covers Cryptographic Fundamentals - HOW we protect data using encryption, hashing, and digital signatures that underpin many authentication systems."
  },

  "related_content": {
    "simulations": ["D1-SIM-002_Security_Concepts"],
    "remediation": ["D1-REM-002_Authentication_Access"],
    "next_lesson": "D1-LESSON-004_Cryptographic_Fundamentals",
    "previous_lesson": "D1-LESSON-002_CIA_Triad_Fundamentals"
  }
}
