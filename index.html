<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CompTIA Security+ SY0-701 Training Platform">
    <meta name="theme-color" content="#0a0a0a">
    <title>Security+ SY0-701 Training Platform</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
/* ================================================
   ELEGANT DESIGN SYSTEM - COMPLETE
   ================================================ */

:root {
    --neutral-50: #fafafa;
    --neutral-100: #f5f5f5;
    --neutral-200: #e5e5e5;
    --neutral-300: #d4d4d4;
    --neutral-400: #a3a3a3;
    --neutral-500: #737373;
    --neutral-600: #525252;
    --neutral-700: #404040;
    --neutral-800: #262626;
    --neutral-900: #171717;
    --neutral-950: #0a0a0a;
    
    --primary-500: #3b82f6;
    --primary-600: #2563eb;
    --primary-700: #1d4ed8;
    
    --success-main: #22c55e;
    --warning-main: #eab308;
    --danger-main: #ef4444;
    --info-main: #3b82f6;
    
    --font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    --font-family-mono: 'JetBrains Mono', 'SF Mono', Monaco, monospace;
    
    --space-1: 0.25rem;
    --space-2: 0.5rem;
    --space-3: 0.75rem;
    --space-4: 1rem;
    --space-5: 1.25rem;
    --space-6: 1.5rem;
    --space-8: 2rem;
    
    --radius-sm: 0.25rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --radius-full: 9999px;
    
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
    
    --z-dropdown: 1000;
    --z-sticky: 1020;
    --z-fixed: 1030;
    --z-modal: 1050;
    
    --domain-1: #6366f1;
    --domain-2: #f59e0b;
    --domain-3: #10b981;
    --domain-4: #8b5cf6;
    --domain-5: #ec4899;
}

[data-theme="dark"] {
    --bg-primary: #0a0a0a;
    --bg-secondary: #141414;
    --bg-tertiary: #1a1a1a;
    --bg-hover: #262626;
    --bg-active: #2a2a2a;
    --text-primary: #fafafa;
    --text-secondary: #a3a3a3;
    --text-tertiary: #737373;
    --text-inverse: #0a0a0a;
    --border-subtle: rgba(255, 255, 255, 0.08);
    --border-default: rgba(255, 255, 255, 0.12);
    --border-strong: rgba(255, 255, 255, 0.16);
    --accent: #3b82f6;
    --accent-hover: #2563eb;
    --accent-subtle: rgba(59, 130, 246, 0.15);
}

[data-theme="light"] {
    --bg-primary: #ffffff;
    --bg-secondary: #fafafa;
    --bg-tertiary: #f5f5f5;
    --bg-hover: #e5e5e5;
    --bg-active: #d4d4d4;
    --text-primary: #0a0a0a;
    --text-secondary: #525252;
    --text-tertiary: #737373;
    --text-inverse: #ffffff;
    --border-subtle: rgba(0, 0, 0, 0.06);
    --border-default: rgba(0, 0, 0, 0.09);
    --border-strong: rgba(0, 0, 0, 0.12);
    --accent: #2563eb;
    --accent-hover: #1d4ed8;
    --accent-subtle: rgba(37, 99, 235, 0.08);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

body {
    font-family: var(--font-family-sans);
    font-size: 1rem;
    line-height: 1.6;
    color: var(--text-primary);
    background-color: var(--bg-primary);
    min-height: 100vh;
    transition: background-color var(--transition-base), color var(--transition-base);
}

h1, h2, h3, h4, h5, h6 {
    font-weight: 600;
    line-height: 1.3;
    color: var(--text-primary);
    margin-top: 0;
}

h1 { font-size: 2.25rem; font-weight: 700; letter-spacing: -0.025em; }
h2 { font-size: 1.875rem; font-weight: 600; }
h3 { font-size: 1.5rem; font-weight: 600; }
h4 { font-size: 1.25rem; }

p { margin-bottom: var(--space-4); color: var(--text-secondary); }
a { color: var(--accent); text-decoration: none; transition: color var(--transition-fast); }
a:hover { color: var(--accent-hover); }

.container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--space-6);
}

/* Header */
.header {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-subtle);
    position: sticky;
    top: 0;
    z-index: var(--z-sticky);
    backdrop-filter: blur(10px);
}

.header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 64px;
    padding: 0 var(--space-6);
    max-width: 1400px;
    margin: 0 auto;
}

.logo {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.logo-icon { font-size: 1.5rem; }

.nav {
    display: flex;
    align-items: center;
    gap: var(--space-1);
}

.nav-item {
    padding: var(--space-2) var(--space-4);
    color: var(--text-secondary);
    background: transparent;
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
    font-size: 0.875rem;
    font-weight: 500;
    font-family: inherit;
}

.nav-item:hover {
    color: var(--text-primary);
    background: var(--bg-hover);
}

.nav-item.active {
    color: var(--accent);
    background: var(--accent-subtle);
}

/* Cards */
.card {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-subtle);
    padding: var(--space-6);
    transition: all var(--transition-base);
}

.card:hover {
    border-color: var(--border-default);
    box-shadow: var(--shadow-lg);
}

.card-header {
    margin-bottom: var(--space-4);
}

.card-title {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: var(--space-1);
}

.card-subtitle {
    font-size: 0.875rem;
    color: var(--text-tertiary);
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-5);
    font-size: 0.875rem;
    font-weight: 500;
    font-family: inherit;
    border-radius: var(--radius-md);
    border: none;
    cursor: pointer;
    transition: all var(--transition-fast);
    text-decoration: none;
    position: relative;
    overflow: hidden;
}

.btn-primary {
    background: var(--accent);
    color: white;
}

.btn-primary:hover {
    background: var(--accent-hover);
    transform: translateY(-1px);
}

.btn-secondary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 1px solid var(--border-default);
}

.btn-secondary:hover {
    background: var(--bg-hover);
    border-color: var(--border-strong);
}

.btn-ghost {
    background: transparent;
    color: var(--text-secondary);
}

.btn-ghost:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
}

.btn-sm {
    padding: var(--space-2) var(--space-3);
    font-size: 0.8rem;
}

.btn-lg {
    padding: var(--space-4) var(--space-6);
    font-size: 1rem;
}

/* Badges */
.badge {
    display: inline-flex;
    align-items: center;
    padding: var(--space-1) var(--space-2);
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: var(--radius-full);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.badge-primary { background: var(--accent-subtle); color: var(--accent); }
.badge-success { background: rgba(34, 197, 94, 0.1); color: var(--success-main); }
.badge-warning { background: rgba(234, 179, 8, 0.1); color: var(--warning-main); }
.badge-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger-main); }

/* Progress Bars */
.progress {
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-full);
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background: var(--accent);
    transition: width var(--transition-base) ease-out;
}

/* Grid */
.grid {
    display: grid;
    gap: var(--space-6);
}

.grid-2 { grid-template-columns: repeat(2, 1fr); }
.grid-3 { grid-template-columns: repeat(3, 1fr); }
.grid-auto { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }

/* Utilities */
.flex { display: flex; }
.flex-col { flex-direction: column; }
.items-center { align-items: center; }
.justify-between { justify-content: space-between; }
.gap-2 { gap: var(--space-2); }
.gap-3 { gap: var(--space-3); }
.gap-4 { gap: var(--space-4); }
.mb-2 { margin-bottom: var(--space-2); }
.mb-4 { margin-bottom: var(--space-4); }
.mb-6 { margin-bottom: var(--space-6); }
.mt-4 { margin-top: var(--space-4); }
.mt-6 { margin-top: var(--space-6); }
.text-center { text-align: center; }
.text-muted { color: var(--text-tertiary); }
.text-sm { font-size: 0.875rem; }

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.animate-fadeIn { animation: fadeIn var(--transition-base) ease-out; }
.animate-slideUp { animation: slideUp var(--transition-base) ease-out; }

/* Domain Colors */
.domain-1 { --domain-color: var(--domain-1); }
.domain-2 { --domain-color: var(--domain-2); }
.domain-3 { --domain-color: var(--domain-3); }
.domain-4 { --domain-color: var(--domain-4); }
.domain-5 { --domain-color: var(--domain-5); }

.domain-card {
    border-left: 4px solid var(--domain-color, var(--accent));
}

/* Theme Toggle */
.theme-toggle {
    position: fixed;
    bottom: var(--space-6);
    right: var(--space-6);
    z-index: var(--z-fixed);
}

.theme-toggle-btn {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-full);
    background: var(--bg-secondary);
    border: 1px solid var(--border-default);
    color: var(--text-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-base);
    box-shadow: var(--shadow-lg);
    font-size: 1.25rem;
}

.theme-toggle-btn:hover {
    transform: scale(1.1);
}

/* Dropdown */
.dropdown { position: relative; display: inline-block; }

.dropdown-content {
    display: none;
    position: absolute;
    background: var(--bg-secondary);
    min-width: 220px;
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    z-index: var(--z-dropdown);
    top: 100%;
    margin-top: var(--space-2);
    padding: var(--space-2);
}

.dropdown:hover .dropdown-content { display: block; }

.dropdown-content a, .dropdown-content button {
    color: var(--text-primary);
    padding: var(--space-3) var(--space-4);
    text-decoration: none;
    display: block;
    transition: background var(--transition-fast);
    font-size: 0.875rem;
    background: none;
    border: none;
    width: 100%;
    text-align: left;
    cursor: pointer;
    border-radius: var(--radius-md);
    font-family: inherit;
}

.dropdown-content a:hover, .dropdown-content button:hover {
    background: var(--bg-hover);
}

/* Forms */
.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: var(--space-3) var(--space-4);
    font-size: 1rem;
    font-family: inherit;
    background: var(--bg-primary);
    color: var(--text-primary);
    border: 1px solid var(--border-default);
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-subtle);
}

/* Loading */
.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border-default);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Learning Cards Grid */
.learning-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--space-4);
}

.learning-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    padding: var(--space-5);
    cursor: pointer;
    transition: all var(--transition-base);
    text-align: center;
}

.learning-card:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.learning-card-icon {
    font-size: 2.5rem;
    margin-bottom: var(--space-3);
}

/* Simulation Styles */
.sim-option {
    background: var(--bg-tertiary);
    border: 2px solid var(--border-default);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-align: left;
}

.sim-option:hover {
    border-color: var(--accent);
    background: var(--bg-hover);
}

.sim-option.selected {
    border-color: var(--accent);
    background: var(--accent-subtle);
}

.sim-option.correct {
    border-color: var(--success-main);
    background: rgba(34, 197, 94, 0.1);
}

.sim-option.incorrect {
    border-color: var(--danger-main);
    background: rgba(239, 68, 68, 0.1);
}

/* Quiz Option Styles */
.quiz-option {
    background: var(--bg-tertiary);
    border: 2px solid var(--border-default);
    border-radius: var(--radius-md);
    padding: var(--space-4);
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
}

.quiz-option:hover {
    border-color: var(--accent);
}

.quiz-option.selected {
    border-color: var(--accent);
    background: var(--accent-subtle);
}

/* Alert boxes */
.alert {
    padding: var(--space-4);
    border-radius: var(--radius-md);
    margin-bottom: var(--space-4);
}

.alert-success {
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid var(--success-main);
    color: var(--success-main);
}

.alert-warning {
    background: rgba(234, 179, 8, 0.1);
    border: 1px solid var(--warning-main);
    color: var(--warning-main);
}

.alert-danger {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid var(--danger-main);
    color: var(--danger-main);
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .container { padding: var(--space-4); }
    h1 { font-size: 1.875rem; }
    .header-content { padding: 0 var(--space-4); }
    .nav { display: none; }
    .grid-2, .grid-3 { grid-template-columns: 1fr; }
}
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">üõ°Ô∏è</span>
                    <span>Security+ Training</span>
                </div>
                <nav class="nav" id="main-nav">
                    <button class="nav-item active" onclick="showDashboard()">Dashboard</button>
                    <div class="dropdown">
                        <button class="nav-item">Domains ‚ñæ</button>
                        <div class="dropdown-content" id="domains-dropdown"></div>
                    </div>
                    <button class="nav-item" onclick="showAllSimulations()">Simulations</button>
                    <button class="nav-item" onclick="showQuizHub()">Quiz</button>
                    <button class="nav-item" onclick="showProgress()">Progress</button>
                </nav>
            </div>
        </header>
        
        <!-- Main Content -->
        <main id="content">
            <div class="container text-center" style="padding-top: 100px;">
                <div class="loading-spinner" style="margin: 0 auto;"></div>
                <h2 class="mt-4">Loading Platform...</h2>
            </div>
        </main>
    </div>
    
    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="theme-toggle-btn" onclick="toggleTheme()" title="Toggle theme">
            <span id="theme-icon">‚òÄÔ∏è</span>
        </button>
    </div>

<script>
// ================================================
// SECURITY+ TRAINING PLATFORM - COMPLETE APPLICATION
// ================================================

// ================================================
// GLOBAL STATE & DATA
// ================================================

const APP = {
    initialized: false,
    currentView: 'dashboard',
    currentDomain: null,
    currentSimulation: null,
    currentQuiz: null,
    progress: {
        domains: {
            1: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 },
            2: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 },
            3: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 },
            4: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 },
            5: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 }
        },
        overallProgress: 0,
        totalScore: 0
    },
    state: {
        currentSimulation: null,
        currentDecisionIndex: 0,
        simulationScore: 0,
        selectedOption: null,
        quizQuestions: [],
        currentQuestionIndex: 0,
        quizScore: 0
    }
};

const DOMAINS = [
    {
        id: 1,
        name: "General Security Concepts",
        description: "Security controls, CIA triad, authentication, zero trust architecture",
        examWeight: "12%",
        color: "#6366f1",
        lessons: 8,
        simulations: 5
    },
    {
        id: 2,
        name: "Threats, Vulnerabilities & Mitigations",
        description: "Threat actors, attack types, malware, vulnerability management",
        examWeight: "22%",
        color: "#f59e0b",
        lessons: 12,
        simulations: 5
    },
    {
        id: 3,
        name: "Security Architecture",
        description: "Cloud security, network architecture, cryptography, resilience",
        examWeight: "18%",
        color: "#10b981",
        lessons: 8,
        simulations: 5
    },
    {
        id: 4,
        name: "Security Operations",
        description: "Monitoring, incident response, forensics, vulnerability management",
        examWeight: "28%",
        color: "#8b5cf6",
        lessons: 7,
        simulations: 5
    },
    {
        id: 5,
        name: "Security Program Management",
        description: "Governance, risk management, compliance, third-party risk",
        examWeight: "20%",
        color: "#ec4899",
        lessons: 6,
        simulations: 5
    }
];

// Sample simulation data
const SIMULATIONS = {
    "D1-SIM-001": {
        id: "D1-SIM-001",
        title: "Security Controls Implementation",
        domain: 1,
        difficulty: "intermediate",
        duration: "45 min",
        role: "Security Analyst",
        organization: {
            name: "Pinnacle Insurance Group",
            industry: "Insurance / Financial Services"
        },
        scenario: "You're a security analyst at Pinnacle Insurance Group. A regulatory audit revealed gaps in the security controls framework. Your task is to help design and implement a comprehensive security controls program.",
        learning_objectives: [
            "Understand security control categories (technical, managerial, operational, physical)",
            "Differentiate between control types (preventive, detective, corrective)",
            "Apply appropriate controls to address specific security risks"
        ],
        decision_points: [
            {
                id: "dp1",
                title: "Control Categories Assessment",
                situation: "The CISO asks you to assess the current state of security controls. You find:\n\n‚Ä¢ IT Department: Firewalls, antivirus, encryption tools\n‚Ä¢ HR Department: Background checks, employee handbook\n‚Ä¢ Facilities: Badge readers, security cameras\n‚Ä¢ Security Team: Incident response procedures\n\nHow do you categorize these existing controls?",
                options: [
                    {
                        id: "a",
                        text: "All controls are technical because they protect against cyber threats",
                        is_optimal: false,
                        points: 5,
                        feedback: "Incorrect. Background checks are managerial controls. Badge readers and cameras are physical controls. Only firewalls, antivirus, and encryption are technical controls.",
                        learning_note: "Security controls span multiple categories beyond just technology."
                    },
                    {
                        id: "b",
                        text: "Technical (firewalls, AV, encryption), Managerial (background checks, handbook), Physical (badges, cameras), Operational (IR procedures)",
                        is_optimal: true,
                        points: 25,
                        feedback: "Excellent categorization! You correctly identified all four control categories.",
                        learning_note: "The four control categories are: Technical, Managerial/Administrative, Physical, and Operational."
                    },
                    {
                        id: "c",
                        text: "Preventive controls (firewalls, badges) and Detective controls (antivirus, cameras)",
                        is_optimal: false,
                        points: 10,
                        feedback: "You're describing control types, not categories. Categories and types are different classification schemes.",
                        learning_note: "Control categories and control types are different dimensions of classification."
                    },
                    {
                        id: "d",
                        text: "Hardware controls and software controls",
                        is_optimal: false,
                        points: 0,
                        feedback: "This classification is too narrow and misses managerial, physical, and operational categories entirely.",
                        learning_note: "Security controls extend far beyond IT hardware and software."
                    }
                ]
            },
            {
                id: "dp2",
                title: "Control Types Selection",
                situation: "The CISO wants to address unauthorized access to customer health information. She asks: 'What types of controls should we implement? I want to prevent breaches, detect if something goes wrong, and be able to respond.'\n\nWhat control types do you recommend?",
                options: [
                    {
                        id: "a",
                        text: "Focus on preventive controls only - if we prevent all breaches, we don't need detection or response",
                        is_optimal: false,
                        points: 5,
                        feedback: "Prevention alone is insufficient. No preventive control is 100% effective. Without detective controls, you won't know when prevention fails.",
                        learning_note: "Prevention is important but will eventually fail. Detective and corrective controls are essential."
                    },
                    {
                        id: "b",
                        text: "Layered approach: Preventive (access controls, encryption), Detective (logging, monitoring), Corrective (incident response, backup restoration)",
                        is_optimal: true,
                        points: 25,
                        feedback: "Excellent approach! This defense-in-depth strategy ensures security even when individual controls fail.",
                        learning_note: "Control types work together: Preventive stops threats, Detective identifies incidents, Corrective enables recovery."
                    },
                    {
                        id: "c",
                        text: "Detective controls are most important - we need to catch bad actors in the act",
                        is_optimal: false,
                        points: 10,
                        feedback: "Detection is important but catching breaches in progress still means damage occurs. Prevention reduces incidents to detect.",
                        learning_note: "A balanced approach uses all control types together."
                    },
                    {
                        id: "d",
                        text: "Corrective controls should be our priority so we can recover quickly",
                        is_optimal: false,
                        points: 5,
                        feedback: "While recovery capability is important, focusing only on correction means accepting preventable incidents.",
                        learning_note: "All three control types are necessary for comprehensive security."
                    }
                ]
            },
            {
                id: "dp3",
                title: "Compensating Controls",
                situation: "The legacy underwriting system cannot support modern MFA. The vendor will release an update in 6 months. The CISO asks: 'We can't wait 6 months with no protection. What can we do in the meantime?'\n\nWhat do you recommend?",
                options: [
                    {
                        id: "a",
                        text: "Accept the risk and wait for the vendor update",
                        is_optimal: false,
                        points: 0,
                        feedback: "Accepting significant risk for 6 months is not advisable when alternatives exist. This approach leaves sensitive data exposed.",
                        learning_note: "Compensating controls can provide alternative protection when primary controls aren't feasible."
                    },
                    {
                        id: "b",
                        text: "Implement compensating controls: network segmentation, enhanced monitoring, IP restrictions, and stronger password policies",
                        is_optimal: true,
                        points: 25,
                        feedback: "Excellent approach! These compensating controls provide alternative protection while you wait for MFA capability.",
                        learning_note: "Compensating controls provide equivalent security through alternative means when primary controls can't be implemented."
                    },
                    {
                        id: "c",
                        text: "Replace the entire underwriting system immediately",
                        is_optimal: false,
                        points: 5,
                        feedback: "Complete system replacement is expensive, risky, and time-consuming. Compensating controls are more practical for a 6-month gap.",
                        learning_note: "Compensating controls are temporary measures, not permanent replacements."
                    },
                    {
                        id: "d",
                        text: "Disable remote access to the system until the update is ready",
                        is_optimal: false,
                        points: 10,
                        feedback: "This would significantly impact business operations. Compensating controls can maintain security without disrupting business.",
                        learning_note: "Security must balance protection with operational requirements."
                    }
                ]
            }
        ],
        passing_score: 50,
        max_score: 75
    },
    "D2-SIM-001": {
        id: "D2-SIM-001",
        title: "Phishing Campaign Investigation",
        domain: 2,
        difficulty: "intermediate",
        duration: "40 min",
        role: "SOC Analyst",
        organization: {
            name: "TechCorp Industries",
            industry: "Technology"
        },
        scenario: "Multiple employees have reported suspicious emails. As the SOC analyst on duty, you need to investigate the potential phishing campaign and contain any threats.",
        learning_objectives: [
            "Identify phishing indicators and attack patterns",
            "Analyze email headers and malicious content",
            "Execute appropriate containment procedures"
        ],
        decision_points: [
            {
                id: "dp1",
                title: "Initial Assessment",
                situation: "You receive 5 reports of suspicious emails within 30 minutes. The emails claim to be from 'IT Support' asking users to verify their credentials through a link. Two users admit they clicked the link.\n\nWhat is your first priority?",
                options: [
                    {
                        id: "a",
                        text: "Immediately reset passwords for the two users who clicked",
                        is_optimal: false,
                        points: 15,
                        feedback: "Password reset is important but not the first step. You need to understand the scope and contain the threat first.",
                        learning_note: "Incident response follows a process: Identify, Contain, Eradicate, Recover."
                    },
                    {
                        id: "b",
                        text: "Block the malicious domain at the email gateway and firewall, then assess compromised accounts",
                        is_optimal: true,
                        points: 25,
                        feedback: "Correct! Containment prevents additional victims while you investigate. Then you can focus on compromised accounts.",
                        learning_note: "Containment is critical to prevent the attack from spreading to more users."
                    },
                    {
                        id: "c",
                        text: "Send a company-wide warning email immediately",
                        is_optimal: false,
                        points: 10,
                        feedback: "Warning users is good but the malicious link is still active. Block the threat first to prevent more clicks.",
                        learning_note: "Technical containment should precede user communication."
                    },
                    {
                        id: "d",
                        text: "Forward the email to the FBI for investigation",
                        is_optimal: false,
                        points: 5,
                        feedback: "External reporting may be appropriate later, but your immediate priority is protecting your organization.",
                        learning_note: "Containment and internal investigation come before external reporting."
                    }
                ]
            },
            {
                id: "dp2",
                title: "Compromise Assessment",
                situation: "After blocking the domain, you analyze the two accounts that clicked the link. You find:\n\n‚Ä¢ Both entered credentials on the fake site\n‚Ä¢ One account shows login from unusual IP (foreign country)\n‚Ä¢ 47 emails were forwarded to external address\n‚Ä¢ Calendar and contact data was exported\n\nWhat does this indicate?",
                options: [
                    {
                        id: "a",
                        text: "Standard phishing - credentials stolen but no further compromise",
                        is_optimal: false,
                        points: 5,
                        feedback: "The evidence shows active compromise beyond just credential theft. The attacker accessed and exfiltrated data.",
                        learning_note: "Look for indicators of compromise beyond the initial attack vector."
                    },
                    {
                        id: "b",
                        text: "Account takeover with data exfiltration - Business Email Compromise (BEC) attack",
                        is_optimal: true,
                        points: 25,
                        feedback: "Correct! The foreign login, email forwarding, and data export indicate full account takeover and BEC.",
                        learning_note: "BEC attacks often involve account takeover followed by data exfiltration or fraud."
                    },
                    {
                        id: "c",
                        text: "False positive - the user probably accessed from VPN",
                        is_optimal: false,
                        points: 0,
                        feedback: "The evidence (47 forwarded emails, exported data) clearly indicates malicious activity, not normal user behavior.",
                        learning_note: "Don't dismiss clear indicators of compromise without thorough investigation."
                    },
                    {
                        id: "d",
                        text: "Ransomware infection in progress",
                        is_optimal: false,
                        points: 5,
                        feedback: "The indicators (email forwarding, data export) are consistent with BEC, not ransomware.",
                        learning_note: "Different attack types have different indicators. Match evidence to attack patterns."
                    }
                ]
            }
        ],
        passing_score: 40,
        max_score: 50
    },
    "D3-SIM-001": {
        id: "D3-SIM-001",
        title: "Cloud Security Architecture",
        domain: 3,
        difficulty: "advanced",
        duration: "50 min",
        role: "Cloud Security Architect",
        organization: {
            name: "GlobalBank Financial",
            industry: "Financial Services"
        },
        scenario: "GlobalBank is migrating critical applications to AWS. As the cloud security architect, you must design security controls for the cloud environment.",
        learning_objectives: [
            "Apply cloud security principles and shared responsibility model",
            "Design secure cloud architecture patterns",
            "Implement cloud-native security controls"
        ],
        decision_points: [
            {
                id: "dp1",
                title: "Shared Responsibility",
                situation: "The CIO asks: 'If we move to AWS, they handle all the security, right? That's the whole point of the cloud.'\n\nHow do you explain the security responsibilities?",
                options: [
                    {
                        id: "a",
                        text: "Yes, AWS handles everything - that's why we're paying them",
                        is_optimal: false,
                        points: 0,
                        feedback: "Incorrect. Cloud providers use a shared responsibility model. AWS secures the cloud infrastructure; you secure what you put in the cloud.",
                        learning_note: "Understanding the shared responsibility model is critical for cloud security."
                    },
                    {
                        id: "b",
                        text: "AWS secures the infrastructure (security OF the cloud), we secure our data and configurations (security IN the cloud)",
                        is_optimal: true,
                        points: 25,
                        feedback: "Correct! This is the shared responsibility model. AWS handles physical security, hypervisors, network infrastructure. You handle IAM, encryption, data classification.",
                        learning_note: "Security OF the cloud vs security IN the cloud is the key distinction."
                    },
                    {
                        id: "c",
                        text: "We need to build everything ourselves - cloud providers can't be trusted",
                        is_optimal: false,
                        points: 5,
                        feedback: "This ignores the security capabilities cloud providers offer and would be inefficient and potentially less secure.",
                        learning_note: "Leverage cloud provider security capabilities appropriately."
                    },
                    {
                        id: "d",
                        text: "We only need to secure the network - AWS handles identity and data",
                        is_optimal: false,
                        points: 5,
                        feedback: "Actually, IAM and data protection are primarily your responsibility in IaaS/PaaS models.",
                        learning_note: "Identity and data protection are customer responsibilities in most cloud models."
                    }
                ]
            }
        ],
        passing_score: 20,
        max_score: 25
    },
    "D4-SIM-001": {
        id: "D4-SIM-001",
        title: "SOC Operations - Active Threat",
        domain: 4,
        difficulty: "intermediate",
        duration: "45 min",
        role: "SOC Analyst",
        organization: {
            name: "MedCare Health Systems",
            industry: "Healthcare"
        },
        scenario: "You're the SOC analyst on the night shift when SIEM alerts indicate potential ransomware activity. Multiple endpoints are showing suspicious behavior.",
        learning_objectives: [
            "Analyze SIEM alerts and correlate events",
            "Execute incident response procedures",
            "Coordinate containment and recovery efforts"
        ],
        decision_points: [
            {
                id: "dp1",
                title: "Alert Triage",
                situation: "Your SIEM shows:\n\n‚Ä¢ 15 endpoints with 'vssadmin delete shadows' commands\n‚Ä¢ Unusual PowerShell activity on domain controller\n‚Ä¢ Network traffic to known C2 IP addresses\n‚Ä¢ File encryption activity detected\n\nHow do you classify this incident?",
                options: [
                    {
                        id: "a",
                        text: "False positive - probably IT maintenance",
                        is_optimal: false,
                        points: 0,
                        feedback: "These are classic ransomware indicators. Deleting shadow copies, C2 traffic, and file encryption together indicate active ransomware.",
                        learning_note: "Know the common indicators of ransomware attacks."
                    },
                    {
                        id: "b",
                        text: "Critical severity - active ransomware attack in progress",
                        is_optimal: true,
                        points: 25,
                        feedback: "Correct! Shadow copy deletion + C2 traffic + encryption activity = ransomware attack. This requires immediate escalation.",
                        learning_note: "Ransomware indicators: shadow deletion, C2 communication, mass file encryption, lateral movement."
                    },
                    {
                        id: "c",
                        text: "Medium severity - monitor and gather more data",
                        is_optimal: false,
                        points: 5,
                        feedback: "With active encryption occurring, every minute of delay means more encrypted files. Immediate action is required.",
                        learning_note: "Active ransomware requires immediate response, not extended monitoring."
                    },
                    {
                        id: "d",
                        text: "Low severity - schedule investigation for morning shift",
                        is_optimal: false,
                        points: 0,
                        feedback: "By morning, the entire network could be encrypted. Ransomware spreads rapidly and requires immediate response.",
                        learning_note: "Never delay response to potential ransomware."
                    }
                ]
            }
        ],
        passing_score: 20,
        max_score: 25
    },
    "D5-SIM-001": {
        id: "D5-SIM-001",
        title: "Security Governance Framework",
        domain: 5,
        difficulty: "intermediate",
        duration: "40 min",
        role: "GRC Analyst",
        organization: {
            name: "DataFlow Analytics",
            industry: "Data Analytics / Technology"
        },
        scenario: "DataFlow Analytics has grown rapidly and needs to establish formal security governance. As the new GRC analyst, you're tasked with developing the governance framework.",
        learning_objectives: [
            "Understand security governance principles",
            "Develop policies, standards, and procedures",
            "Align security with business objectives"
        ],
        decision_points: [
            {
                id: "dp1",
                title: "Governance Foundation",
                situation: "The CEO asks: 'We need security governance, but I don't want bureaucracy slowing us down. What's the minimum we need?'\n\nHow do you approach this?",
                options: [
                    {
                        id: "a",
                        text: "Skip formal governance - it's just paperwork that slows innovation",
                        is_optimal: false,
                        points: 0,
                        feedback: "Without governance, security becomes inconsistent and unmeasurable. You can't manage what you don't govern.",
                        learning_note: "Governance provides direction and accountability for security."
                    },
                    {
                        id: "b",
                        text: "Implement risk-based governance: essential policies, clear roles, business-aligned controls, and agile review processes",
                        is_optimal: true,
                        points: 25,
                        feedback: "Excellent! Risk-based governance provides structure without excessive bureaucracy. Focus on high-risk areas first.",
                        learning_note: "Good governance is proportional to risk and enables rather than hinders business."
                    },
                    {
                        id: "c",
                        text: "Adopt a complete enterprise framework like COBIT immediately",
                        is_optimal: false,
                        points: 10,
                        feedback: "Full enterprise frameworks may be too heavy for a growing company. Start with essentials and scale.",
                        learning_note: "Governance should be appropriate to organization size and maturity."
                    },
                    {
                        id: "d",
                        text: "Just document what we already do - that's governance enough",
                        is_optimal: false,
                        points: 5,
                        feedback: "Documenting current practices is a start, but governance also requires intentional design and continuous improvement.",
                        learning_note: "Governance is proactive, not just documentation of current state."
                    }
                ]
            }
        ],
        passing_score: 20,
        max_score: 25
    }
};

// Sample question bank
const QUESTION_BANK = {
    1: [
        {
            id: "D1-Q001",
            question: "Which security control type is a firewall classified as?",
            options: ["Physical", "Technical", "Administrative", "Operational"],
            correct_answer: 1,
            explanation: "A firewall is a technical (logical) control that uses technology to restrict network access based on defined rules."
        },
        {
            id: "D1-Q002",
            question: "What is the primary purpose of defense in depth?",
            options: ["To reduce costs", "To implement multiple layers of security", "To focus on perimeter security only", "To eliminate security policies"],
            correct_answer: 1,
            explanation: "Defense in depth uses multiple layers of security controls so that if one fails, others continue to provide protection."
        },
        {
            id: "D1-Q003",
            question: "Which principle ensures users only have access necessary for their job?",
            options: ["Defense in depth", "Least privilege", "Separation of duties", "Need to know"],
            correct_answer: 1,
            explanation: "Least privilege ensures users have only the minimum access rights required to perform their job functions."
        },
        {
            id: "D1-Q004",
            question: "What does the 'A' in the CIA triad stand for?",
            options: ["Authentication", "Authorization", "Availability", "Accountability"],
            correct_answer: 2,
            explanation: "The CIA triad consists of Confidentiality, Integrity, and Availability - the three core principles of information security."
        },
        {
            id: "D1-Q005",
            question: "Which authentication factor is 'something you are'?",
            options: ["Password", "Smart card", "Fingerprint", "Security token"],
            correct_answer: 2,
            explanation: "Biometrics like fingerprints represent 'something you are' - inherent characteristics unique to the individual."
        }
    ],
    2: [
        {
            id: "D2-Q001",
            question: "Which threat actor is typically motivated by financial gain?",
            options: ["Hacktivist", "Nation-state", "Organized crime", "Script kiddie"],
            correct_answer: 2,
            explanation: "Organized crime groups are primarily motivated by financial gain through activities like ransomware, fraud, and data theft."
        },
        {
            id: "D2-Q002",
            question: "What type of malware encrypts files and demands payment?",
            options: ["Trojan", "Worm", "Ransomware", "Spyware"],
            correct_answer: 2,
            explanation: "Ransomware encrypts victim files and demands payment (usually cryptocurrency) for the decryption key."
        },
        {
            id: "D2-Q003",
            question: "Which attack involves tricking users into revealing sensitive information?",
            options: ["DDoS", "SQL injection", "Phishing", "Buffer overflow"],
            correct_answer: 2,
            explanation: "Phishing uses deceptive communications to trick users into revealing credentials or sensitive information."
        }
    ],
    3: [
        {
            id: "D3-Q001",
            question: "In the cloud shared responsibility model, who secures the data?",
            options: ["Cloud provider only", "Customer only", "Shared between both", "Neither - data is auto-secured"],
            correct_answer: 1,
            explanation: "In IaaS/PaaS, data security is the customer's responsibility. The provider secures infrastructure."
        },
        {
            id: "D3-Q002",
            question: "Which encryption type uses the same key for encryption and decryption?",
            options: ["Asymmetric", "Symmetric", "Hashing", "Digital signature"],
            correct_answer: 1,
            explanation: "Symmetric encryption uses the same secret key for both encryption and decryption (e.g., AES)."
        }
    ],
    4: [
        {
            id: "D4-Q001",
            question: "What is the first phase of incident response?",
            options: ["Containment", "Eradication", "Preparation", "Identification"],
            correct_answer: 2,
            explanation: "Preparation is the first phase - establishing IR capabilities before incidents occur."
        },
        {
            id: "D4-Q002",
            question: "Which log source would show failed authentication attempts?",
            options: ["Application logs", "Security logs", "System logs", "Network logs"],
            correct_answer: 1,
            explanation: "Security logs (Windows Security Event Log, auth.log on Linux) record authentication events."
        }
    ],
    5: [
        {
            id: "D5-Q001",
            question: "What is the purpose of a security policy?",
            options: ["Technical implementation details", "High-level security direction", "Step-by-step procedures", "Network diagrams"],
            correct_answer: 1,
            explanation: "Policies provide high-level direction and principles. Procedures contain step-by-step details."
        },
        {
            id: "D5-Q002",
            question: "Which risk response involves purchasing insurance?",
            options: ["Avoidance", "Mitigation", "Transfer", "Acceptance"],
            correct_answer: 2,
            explanation: "Risk transfer shifts the financial impact to a third party, such as through insurance or contracts."
        }
    ]
};

// ================================================
// THEME MANAGEMENT
// ================================================

function toggleTheme() {
    const html = document.documentElement;
    const current = html.getAttribute('data-theme');
    const newTheme = current === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    document.getElementById('theme-icon').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
}

function initTheme() {
    const saved = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', saved);
    document.getElementById('theme-icon').textContent = saved === 'dark' ? '‚òÄÔ∏è' : 'üåô';
}

// ================================================
// NAVIGATION FUNCTIONS
// ================================================

function showDashboard() {
    APP.currentView = 'dashboard';
    updateNav('dashboard');
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn">
            <div class="mb-6">
                <h1 class="mb-2">Welcome to Security+ Training</h1>
                <p class="text-muted">Master cybersecurity concepts and prepare for the SY0-701 certification</p>
            </div>
            
            <div class="card mb-6">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="mb-2">Overall Progress</h3>
                        <p class="text-sm text-muted">${calculateOverallProgress()}% Complete</p>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--accent);">${APP.progress.totalScore}</div>
                        <div class="text-sm text-muted">Points earned</div>
                    </div>
                </div>
                <div class="progress">
                    <div class="progress-bar" style="width: ${calculateOverallProgress()}%;"></div>
                </div>
            </div>
            
            <h2 class="mb-4">Exam Domains</h2>
            <div class="grid grid-auto">
                ${DOMAINS.map((domain, index) => `
                    <div class="card domain-card domain-${domain.id} animate-slideUp" style="animation-delay: ${index * 0.1}s; cursor: pointer;" onclick="showDomainView(${domain.id})">
                        <div class="card-header">
                            <div class="flex justify-between items-center">
                                <span class="badge" style="background: ${domain.color}20; color: ${domain.color};">Domain ${domain.id}</span>
                                <span class="badge badge-primary">${domain.examWeight}</span>
                            </div>
                            <h3 class="card-title mt-4">${domain.name}</h3>
                            <p class="card-subtitle">${domain.description}</p>
                        </div>
                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-muted">Progress</span>
                                <span>${calculateDomainProgress(domain.id)}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" style="width: ${calculateDomainProgress(domain.id)}%; background: ${domain.color};"></div>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); showDomainView(${domain.id})">
                                Start Learning
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
            
            <div class="mt-6">
                <h2 class="mb-4">Quick Actions</h2>
                <div class="flex gap-3" style="flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="showAllSimulations()">
                        üéÆ Start a Simulation
                    </button>
                    <button class="btn btn-secondary" onclick="startRandomQuiz()">
                        üìù Quick Quiz
                    </button>
                    <button class="btn btn-secondary" onclick="showPracticeExam()">
                        üéØ Practice Exam
                    </button>
                </div>
            </div>
        </div>
    `;
}

function showDomainView(domainId) {
    const domain = DOMAINS.find(d => d.id === domainId);
    if (!domain) return;
    
    APP.currentDomain = domainId;
    APP.currentView = 'domain';
    updateNav('domains');
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn">
            <button class="btn btn-ghost mb-4" onclick="showDashboard()">
                ‚Üê Back to Dashboard
            </button>
            
            <div class="card mb-6" style="border-left: 4px solid ${domain.color};">
                <div class="flex justify-between items-center">
                    <div>
                        <span class="badge" style="background: ${domain.color}20; color: ${domain.color};">Domain ${domain.id}</span>
                        <h1 class="mt-4 mb-2">${domain.name}</h1>
                        <p class="text-muted">${domain.description}</p>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 2.5rem; font-weight: 700; color: ${domain.color};">${domain.examWeight}</div>
                        <div class="text-sm text-muted">of exam</div>
                    </div>
                </div>
            </div>
            
            <h2 class="mb-4">Learning Activities</h2>
            <div class="learning-grid">
                <div class="learning-card" onclick="showLessons(${domainId})">
                    <div class="learning-card-icon">üìö</div>
                    <h3>Lessons</h3>
                    <p class="text-sm text-muted">${domain.lessons} comprehensive lessons</p>
                    <button class="btn btn-primary btn-sm mt-4">View Lessons</button>
                </div>
                
                <div class="learning-card" onclick="showDomainSimulations(${domainId})">
                    <div class="learning-card-icon">üéÆ</div>
                    <h3>Simulations</h3>
                    <p class="text-sm text-muted">${domain.simulations} real-world scenarios</p>
                    <button class="btn btn-primary btn-sm mt-4">Start Simulation</button>
                </div>
                
                <div class="learning-card" onclick="startDomainQuiz(${domainId})">
                    <div class="learning-card-icon">üìù</div>
                    <h3>Quiz</h3>
                    <p class="text-sm text-muted">Test your knowledge</p>
                    <button class="btn btn-primary btn-sm mt-4">Take Quiz</button>
                </div>
                
                <div class="learning-card" onclick="showFlashcards(${domainId})">
                    <div class="learning-card-icon">üé¥</div>
                    <h3>Flashcards</h3>
                    <p class="text-sm text-muted">Quick term review</p>
                    <button class="btn btn-primary btn-sm mt-4">Study Cards</button>
                </div>
            </div>
        </div>
    `;
}

function showAllSimulations() {
    APP.currentView = 'simulations';
    updateNav('simulations');
    
    const content = document.getElementById('content');
    const simList = Object.values(SIMULATIONS);
    
    content.innerHTML = `
        <div class="container animate-fadeIn">
            <button class="btn btn-ghost mb-4" onclick="showDashboard()">
                ‚Üê Back to Dashboard
            </button>
            
            <h1 class="mb-2">Interactive Simulations</h1>
            <p class="text-muted mb-6">Real-world security scenarios to develop practical skills</p>
            
            <div class="grid grid-auto">
                ${simList.map(sim => {
                    const domain = DOMAINS.find(d => d.id === sim.domain);
                    return `
                        <div class="card domain-${sim.domain}" style="border-left: 4px solid ${domain.color};">
                            <div class="flex justify-between items-center mb-4">
                                <span class="badge" style="background: ${domain.color}20; color: ${domain.color};">Domain ${sim.domain}</span>
                                <span class="badge badge-${sim.difficulty === 'advanced' ? 'danger' : sim.difficulty === 'intermediate' ? 'warning' : 'success'}">${sim.difficulty}</span>
                            </div>
                            <h3 class="mb-2">${sim.title}</h3>
                            <p class="text-sm text-muted mb-4">${sim.scenario.substring(0, 120)}...</p>
                            <div class="flex justify-between items-center text-sm text-muted mb-4">
                                <span>üïê ${sim.duration}</span>
                                <span>üë§ ${sim.role}</span>
                            </div>
                            <button class="btn btn-primary" onclick="startSimulation('${sim.id}')">
                                Start Simulation
                            </button>
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function showDomainSimulations(domainId) {
    const domain = DOMAINS.find(d => d.id === domainId);
    const simList = Object.values(SIMULATIONS).filter(s => s.domain === domainId);
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn">
            <button class="btn btn-ghost mb-4" onclick="showDomainView(${domainId})">
                ‚Üê Back to ${domain.name}
            </button>
            
            <h1 class="mb-2">${domain.name} Simulations</h1>
            <p class="text-muted mb-6">Practice real-world scenarios for this domain</p>
            
            <div class="grid grid-auto">
                ${simList.length > 0 ? simList.map(sim => `
                    <div class="card" style="border-left: 4px solid ${domain.color};">
                        <span class="badge badge-${sim.difficulty === 'advanced' ? 'danger' : 'warning'} mb-4">${sim.difficulty}</span>
                        <h3 class="mb-2">${sim.title}</h3>
                        <p class="text-sm text-muted mb-4">${sim.scenario.substring(0, 120)}...</p>
                        <div class="flex gap-2 text-sm text-muted mb-4">
                            <span>üïê ${sim.duration}</span>
                            <span>üë§ ${sim.role}</span>
                        </div>
                        <button class="btn btn-primary" onclick="startSimulation('${sim.id}')">
                            Start Simulation
                        </button>
                    </div>
                `).join('') : '<p class="text-muted">No simulations available for this domain yet.</p>'}
            </div>
        </div>
    `;
}

// ================================================
// SIMULATION ENGINE
// ================================================

function startSimulation(simId) {
    const sim = SIMULATIONS[simId];
    if (!sim) {
        alert('Simulation not found: ' + simId);
        return;
    }
    
    APP.state.currentSimulation = sim;
    APP.state.currentDecisionIndex = 0;
    APP.state.simulationScore = 0;
    APP.state.selectedOption = null;
    
    showSimulationIntro();
}

function showSimulationIntro() {
    const sim = APP.state.currentSimulation;
    const domain = DOMAINS.find(d => d.id === sim.domain);
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn" style="max-width: 900px;">
            <button class="btn btn-ghost mb-4" onclick="showAllSimulations()">
                ‚Üê Exit Simulation
            </button>
            
            <div class="card" style="border-left: 4px solid ${domain.color};">
                <div class="flex gap-2 mb-4">
                    <span class="badge" style="background: ${domain.color}20; color: ${domain.color};">Domain ${sim.domain}</span>
                    <span class="badge badge-warning">${sim.difficulty}</span>
                </div>
                
                <h1 class="mb-4">${sim.title}</h1>
                
                <div style="background: var(--bg-tertiary); padding: var(--space-5); border-radius: var(--radius-lg); margin-bottom: var(--space-6);">
                    <div class="flex gap-4 mb-4">
                        <div>
                            <div class="text-sm text-muted">Your Role</div>
                            <div style="font-weight: 600;">${sim.role}</div>
                        </div>
                        <div>
                            <div class="text-sm text-muted">Organization</div>
                            <div style="font-weight: 600;">${sim.organization.name}</div>
                        </div>
                        <div>
                            <div class="text-sm text-muted">Duration</div>
                            <div style="font-weight: 600;">${sim.duration}</div>
                        </div>
                    </div>
                </div>
                
                <h3 class="mb-2">Scenario</h3>
                <p style="line-height: 1.8;">${sim.scenario}</p>
                
                <h3 class="mt-6 mb-2">Learning Objectives</h3>
                <ul style="line-height: 2;">
                    ${sim.learning_objectives.map(obj => `<li>${obj}</li>`).join('')}
                </ul>
                
                <div class="text-center mt-6">
                    <button class="btn btn-primary btn-lg" onclick="showDecisionPoint()">
                        Begin Simulation ‚Üí
                    </button>
                </div>
            </div>
        </div>
    `;
}

function showDecisionPoint() {
    const sim = APP.state.currentSimulation;
    const dpIndex = APP.state.currentDecisionIndex;
    const dp = sim.decision_points[dpIndex];
    const domain = DOMAINS.find(d => d.id === sim.domain);
    
    const progress = ((dpIndex) / sim.decision_points.length) * 100;
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn" style="max-width: 900px;">
            <div class="flex justify-between items-center mb-4">
                <button class="btn btn-ghost" onclick="confirmExitSimulation()">
                    ‚Üê Exit
                </button>
                <div class="text-sm text-muted">
                    Decision ${dpIndex + 1} of ${sim.decision_points.length}
                </div>
            </div>
            
            <div class="progress mb-6">
                <div class="progress-bar" style="width: ${progress}%; background: ${domain.color};"></div>
            </div>
            
            <div class="card">
                <h2 class="mb-4">${dp.title}</h2>
                
                <div style="background: var(--bg-tertiary); padding: var(--space-5); border-radius: var(--radius-lg); margin-bottom: var(--space-6);">
                    <p style="line-height: 1.8; white-space: pre-line;">${dp.situation}</p>
                </div>
                
                <h3 class="mb-4">What do you do?</h3>
                
                <div class="flex flex-col gap-3" id="options-container">
                    ${dp.options.map((option, i) => `
                        <div class="sim-option" onclick="selectOption('${option.id}')" id="option-${option.id}">
                            <div class="flex gap-3">
                                <div style="width: 28px; height: 28px; border-radius: 50%; background: var(--bg-hover); display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0;">
                                    ${String.fromCharCode(65 + i)}
                                </div>
                                <div>${option.text}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="text-center mt-6">
                    <button class="btn btn-primary btn-lg" onclick="submitDecision()" id="submit-btn" disabled>
                        Submit Decision
                    </button>
                </div>
            </div>
        </div>
    `;
}

function selectOption(optionId) {
    APP.state.selectedOption = optionId;
    
    // Update UI
    document.querySelectorAll('.sim-option').forEach(el => {
        el.classList.remove('selected');
    });
    document.getElementById('option-' + optionId).classList.add('selected');
    document.getElementById('submit-btn').disabled = false;
}

function submitDecision() {
    const sim = APP.state.currentSimulation;
    const dpIndex = APP.state.currentDecisionIndex;
    const dp = sim.decision_points[dpIndex];
    const selectedId = APP.state.selectedOption;
    const selectedOption = dp.options.find(o => o.id === selectedId);
    
    // Calculate score
    APP.state.simulationScore += selectedOption.points || 0;
    
    // Show feedback
    showDecisionFeedback(selectedOption, dp);
}

function showDecisionFeedback(selectedOption, dp) {
    const sim = APP.state.currentSimulation;
    const domain = DOMAINS.find(d => d.id === sim.domain);
    const isOptimal = selectedOption.is_optimal;
    const optimalOption = dp.options.find(o => o.is_optimal);
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn" style="max-width: 900px;">
            <div class="card">
                <div class="text-center mb-6">
                    <div style="font-size: 4rem;">${isOptimal ? '‚úÖ' : '‚ùå'}</div>
                    <h2 style="color: ${isOptimal ? 'var(--success-main)' : 'var(--danger-main)'};">
                        ${isOptimal ? 'Excellent Choice!' : 'Not Optimal'}
                    </h2>
                    <p class="text-muted">+${selectedOption.points || 0} points</p>
                </div>
                
                <div class="alert ${isOptimal ? 'alert-success' : 'alert-warning'}">
                    <h4 class="mb-2">Feedback</h4>
                    <p style="margin: 0;">${selectedOption.feedback}</p>
                </div>
                
                ${!isOptimal && optimalOption ? `
                    <div style="background: var(--bg-tertiary); padding: var(--space-5); border-radius: var(--radius-lg); margin-top: var(--space-4);">
                        <h4 class="mb-2" style="color: var(--success-main);">üí° Better Approach</h4>
                        <p style="margin-bottom: var(--space-2);">${optimalOption.text}</p>
                        <p class="text-sm text-muted" style="margin: 0;">${optimalOption.feedback}</p>
                    </div>
                ` : ''}
                
                ${selectedOption.learning_note ? `
                    <div style="background: var(--accent-subtle); padding: var(--space-5); border-radius: var(--radius-lg); margin-top: var(--space-4); border-left: 4px solid var(--accent);">
                        <h4 class="mb-2" style="color: var(--accent);">üìñ Key Learning</h4>
                        <p style="margin: 0;">${selectedOption.learning_note}</p>
                    </div>
                ` : ''}
                
                <div class="text-center mt-6">
                    <button class="btn btn-primary btn-lg" onclick="nextDecisionPoint()">
                        ${APP.state.currentDecisionIndex < sim.decision_points.length - 1 ? 'Next Decision ‚Üí' : 'View Results ‚Üí'}
                    </button>
                </div>
            </div>
        </div>
    `;
}

function nextDecisionPoint() {
    const sim = APP.state.currentSimulation;
    APP.state.currentDecisionIndex++;
    APP.state.selectedOption = null;
    
    if (APP.state.currentDecisionIndex >= sim.decision_points.length) {
        showSimulationResults();
    } else {
        showDecisionPoint();
    }
}

function showSimulationResults() {
    const sim = APP.state.currentSimulation;
    const score = APP.state.simulationScore;
    const maxScore = sim.max_score;
    const percentage = Math.round((score / maxScore) * 100);
    const passed = score >= sim.passing_score;
    const domain = DOMAINS.find(d => d.id === sim.domain);
    
    // Update progress
    if (passed) {
        APP.progress.domains[sim.domain].simulationsCompleted++;
        APP.progress.totalScore += score;
        saveProgress();
    }
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn" style="max-width: 800px;">
            <div class="card text-center">
                <div style="font-size: 5rem; margin-bottom: var(--space-4);">
                    ${passed ? 'üèÜ' : 'üìö'}
                </div>
                
                <h1 class="mb-2">Simulation Complete!</h1>
                <p class="text-muted mb-6">${sim.title}</p>
                
                <div style="background: var(--bg-tertiary); padding: var(--space-8); border-radius: var(--radius-xl); margin-bottom: var(--space-6);">
                    <div class="flex justify-center gap-8">
                        <div>
                            <div style="font-size: 3rem; font-weight: 700; color: var(--accent);">${score}</div>
                            <div class="text-sm text-muted">Points Earned</div>
                        </div>
                        <div>
                            <div style="font-size: 3rem; font-weight: 700; color: ${passed ? 'var(--success-main)' : 'var(--warning-main)'};">${percentage}%</div>
                            <div class="text-sm text-muted">Score</div>
                        </div>
                    </div>
                </div>
                
                <div class="badge ${passed ? 'badge-success' : 'badge-warning'}" style="font-size: 1rem; padding: var(--space-3) var(--space-5);">
                    ${passed ? '‚úì PASSED' : '‚ö† NEEDS REVIEW'}
                </div>
                
                <p class="mt-4 text-muted">
                    ${passed ? 'Great job! You demonstrated solid understanding of the concepts.' : `You needed ${sim.passing_score} points to pass. Review the material and try again!`}
                </p>
                
                <div class="flex gap-3 justify-center mt-6">
                    <button class="btn btn-primary" onclick="startSimulation('${sim.id}')">
                        üîÑ Retry Simulation
                    </button>
                    <button class="btn btn-secondary" onclick="showAllSimulations()">
                        üìã More Simulations
                    </button>
                    <button class="btn btn-ghost" onclick="showDashboard()">
                        üè† Dashboard
                    </button>
                </div>
            </div>
        </div>
    `;
}

function confirmExitSimulation() {
    if (confirm('Are you sure you want to exit? Your progress will be lost.')) {
        showAllSimulations();
    }
}

// ================================================
// QUIZ ENGINE
// ================================================

function showQuizHub() {
    APP.currentView = 'quiz';
    updateNav('quiz');
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn">
            <h1 class="mb-2">Practice Quizzes</h1>
            <p class="text-muted mb-6">Test your knowledge with exam-style questions</p>
            
            <div class="grid grid-auto">
                ${DOMAINS.map(domain => `
                    <div class="card" style="border-left: 4px solid ${domain.color};">
                        <span class="badge mb-4" style="background: ${domain.color}20; color: ${domain.color};">Domain ${domain.id}</span>
                        <h3 class="mb-2">${domain.name}</h3>
                        <p class="text-sm text-muted mb-4">${QUESTION_BANK[domain.id]?.length || 0} questions available</p>
                        <button class="btn btn-primary" onclick="startDomainQuiz(${domain.id})">
                            Start Quiz
                        </button>
                    </div>
                `).join('')}
            </div>
            
            <div class="card mt-6">
                <h3 class="mb-4">üéØ Practice Exam</h3>
                <p class="text-muted mb-4">Simulate the actual exam with questions from all domains, weighted by exam percentages.</p>
                <button class="btn btn-primary btn-lg" onclick="showPracticeExam()">
                    Start Practice Exam
                </button>
            </div>
        </div>
    `;
}

function startDomainQuiz(domainId) {
    const questions = QUESTION_BANK[domainId] || [];
    if (questions.length === 0) {
        alert('No questions available for this domain yet.');
        return;
    }
    
    // Shuffle and take up to 10 questions
    APP.state.quizQuestions = shuffleArray([...questions]).slice(0, 10);
    APP.state.currentQuestionIndex = 0;
    APP.state.quizScore = 0;
    APP.state.quizDomain = domainId;
    APP.state.selectedOption = null;
    
    showQuizQuestion();
}

function startRandomQuiz() {
    // Get questions from all domains
    let allQuestions = [];
    Object.values(QUESTION_BANK).forEach(domainQuestions => {
        allQuestions = allQuestions.concat(domainQuestions);
    });
    
    if (allQuestions.length === 0) {
        alert('No questions available yet.');
        return;
    }
    
    APP.state.quizQuestions = shuffleArray(allQuestions).slice(0, 10);
    APP.state.currentQuestionIndex = 0;
    APP.state.quizScore = 0;
    APP.state.quizDomain = null;
    APP.state.selectedOption = null;
    
    showQuizQuestion();
}

function showQuizQuestion() {
    const questions = APP.state.quizQuestions;
    const index = APP.state.currentQuestionIndex;
    const question = questions[index];
    const progress = ((index) / questions.length) * 100;
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn" style="max-width: 800px;">
            <div class="flex justify-between items-center mb-4">
                <button class="btn btn-ghost" onclick="confirmExitQuiz()">
                    ‚Üê Exit Quiz
                </button>
                <div class="text-sm text-muted">
                    Question ${index + 1} of ${questions.length}
                </div>
            </div>
            
            <div class="progress mb-6">
                <div class="progress-bar" style="width: ${progress}%;"></div>
            </div>
            
            <div class="card">
                <h3 class="mb-6">${question.question}</h3>
                
                <div class="flex flex-col gap-3" id="quiz-options">
                    ${question.options.map((option, i) => `
                        <div class="quiz-option" onclick="selectQuizOption(${i})" id="quiz-option-${i}">
                            <div style="width: 28px; height: 28px; border-radius: 50%; background: var(--bg-hover); display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0;">
                                ${String.fromCharCode(65 + i)}
                            </div>
                            <div>${option}</div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="text-center mt-6">
                    <button class="btn btn-primary btn-lg" onclick="submitQuizAnswer()" id="quiz-submit-btn" disabled>
                        Submit Answer
                    </button>
                </div>
            </div>
        </div>
    `;
}

function selectQuizOption(index) {
    APP.state.selectedOption = index;
    
    document.querySelectorAll('.quiz-option').forEach((el, i) => {
        el.classList.remove('selected');
    });
    document.getElementById('quiz-option-' + index).classList.add('selected');
    document.getElementById('quiz-submit-btn').disabled = false;
}

function submitQuizAnswer() {
    const question = APP.state.quizQuestions[APP.state.currentQuestionIndex];
    const selected = APP.state.selectedOption;
    const correct = question.correct_answer;
    const isCorrect = selected === correct;
    
    if (isCorrect) {
        APP.state.quizScore++;
    }
    
    showQuizFeedback(question, selected, correct, isCorrect);
}

function showQuizFeedback(question, selected, correct, isCorrect) {
    const content = document.getElementById('content');
    const questions = APP.state.quizQuestions;
    const index = APP.state.currentQuestionIndex;
    
    content.innerHTML = `
        <div class="container animate-fadeIn" style="max-width: 800px;">
            <div class="card">
                <div class="text-center mb-6">
                    <div style="font-size: 4rem;">${isCorrect ? '‚úÖ' : '‚ùå'}</div>
                    <h2 style="color: ${isCorrect ? 'var(--success-main)' : 'var(--danger-main)'};">
                        ${isCorrect ? 'Correct!' : 'Incorrect'}
                    </h2>
                </div>
                
                <h3 class="mb-4">${question.question}</h3>
                
                <div class="flex flex-col gap-3 mb-6">
                    ${question.options.map((option, i) => `
                        <div class="quiz-option ${i === correct ? 'correct' : (i === selected && !isCorrect ? 'incorrect' : '')}" style="cursor: default;">
                            <div style="width: 28px; height: 28px; border-radius: 50%; background: ${i === correct ? 'var(--success-main)' : (i === selected && !isCorrect ? 'var(--danger-main)' : 'var(--bg-hover)')}; color: ${i === correct || (i === selected && !isCorrect) ? 'white' : 'inherit'}; display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0;">
                                ${i === correct ? '‚úì' : (i === selected && !isCorrect ? '‚úó' : String.fromCharCode(65 + i))}
                            </div>
                            <div>${option}</div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="background: var(--accent-subtle); padding: var(--space-5); border-radius: var(--radius-lg); border-left: 4px solid var(--accent);">
                    <h4 class="mb-2" style="color: var(--accent);">üìñ Explanation</h4>
                    <p style="margin: 0;">${question.explanation}</p>
                </div>
                
                <div class="text-center mt-6">
                    <button class="btn btn-primary btn-lg" onclick="nextQuizQuestion()">
                        ${index < questions.length - 1 ? 'Next Question ‚Üí' : 'View Results ‚Üí'}
                    </button>
                </div>
            </div>
        </div>
    `;
}

function nextQuizQuestion() {
    APP.state.currentQuestionIndex++;
    APP.state.selectedOption = null;
    
    if (APP.state.currentQuestionIndex >= APP.state.quizQuestions.length) {
        showQuizResults();
    } else {
        showQuizQuestion();
    }
}

function showQuizResults() {
    const score = APP.state.quizScore;
    const total = APP.state.quizQuestions.length;
    const percentage = Math.round((score / total) * 100);
    const passed = percentage >= 70;
    
    // Update progress
    if (passed && APP.state.quizDomain) {
        APP.progress.domains[APP.state.quizDomain].quizzesPassed++;
        APP.progress.totalScore += score * 5;
        saveProgress();
    }
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn" style="max-width: 700px;">
            <div class="card text-center">
                <div style="font-size: 5rem; margin-bottom: var(--space-4);">
                    ${passed ? 'üéâ' : 'üìö'}
                </div>
                
                <h1 class="mb-2">Quiz Complete!</h1>
                
                <div style="background: var(--bg-tertiary); padding: var(--space-8); border-radius: var(--radius-xl); margin: var(--space-6) 0;">
                    <div style="font-size: 4rem; font-weight: 700; color: ${passed ? 'var(--success-main)' : 'var(--warning-main)'};">
                        ${percentage}%
                    </div>
                    <div class="text-muted">${score} of ${total} correct</div>
                </div>
                
                <div class="badge ${passed ? 'badge-success' : 'badge-warning'}" style="font-size: 1rem; padding: var(--space-3) var(--space-5);">
                    ${passed ? '‚úì PASSED' : '‚ö† NEEDS REVIEW'}
                </div>
                
                <div class="flex gap-3 justify-center mt-6">
                    ${APP.state.quizDomain ? `
                        <button class="btn btn-primary" onclick="startDomainQuiz(${APP.state.quizDomain})">
                            üîÑ Retry Quiz
                        </button>
                    ` : `
                        <button class="btn btn-primary" onclick="startRandomQuiz()">
                            üîÑ New Quiz
                        </button>
                    `}
                    <button class="btn btn-secondary" onclick="showQuizHub()">
                        üìù All Quizzes
                    </button>
                    <button class="btn btn-ghost" onclick="showDashboard()">
                        üè† Dashboard
                    </button>
                </div>
            </div>
        </div>
    `;
}

function confirmExitQuiz() {
    if (confirm('Are you sure you want to exit? Your progress will be lost.')) {
        showQuizHub();
    }
}

function showPracticeExam() {
    alert('Practice Exam feature coming soon! This will simulate the full 90-question, 90-minute exam.');
    showQuizHub();
}

// ================================================
// PROGRESS & UTILITIES
// ================================================

function showProgress() {
    APP.currentView = 'progress';
    updateNav('progress');
    
    const content = document.getElementById('content');
    content.innerHTML = `
        <div class="container animate-fadeIn">
            <h1 class="mb-2">Your Progress</h1>
            <p class="text-muted mb-6">Track your learning journey</p>
            
            <div class="card mb-6">
                <h3 class="mb-4">Overall Statistics</h3>
                <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-4);">
                    <div style="text-align: center; padding: var(--space-4); background: var(--bg-tertiary); border-radius: var(--radius-lg);">
                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--accent);">${APP.progress.totalScore}</div>
                        <div class="text-sm text-muted">Total Points</div>
                    </div>
                    <div style="text-align: center; padding: var(--space-4); background: var(--bg-tertiary); border-radius: var(--radius-lg);">
                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--success-main);">${calculateOverallProgress()}%</div>
                        <div class="text-sm text-muted">Overall Progress</div>
                    </div>
                    <div style="text-align: center; padding: var(--space-4); background: var(--bg-tertiary); border-radius: var(--radius-lg);">
                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--warning-main);">${getTotalSimulationsCompleted()}</div>
                        <div class="text-sm text-muted">Simulations Done</div>
                    </div>
                    <div style="text-align: center; padding: var(--space-4); background: var(--bg-tertiary); border-radius: var(--radius-lg);">
                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--domain-5);">${getTotalQuizzesPassed()}</div>
                        <div class="text-sm text-muted">Quizzes Passed</div>
                    </div>
                </div>
            </div>
            
            <h3 class="mb-4">Domain Progress</h3>
            <div class="grid grid-auto">
                ${DOMAINS.map(domain => {
                    const progress = calculateDomainProgress(domain.id);
                    const domainData = APP.progress.domains[domain.id];
                    return `
                        <div class="card" style="border-left: 4px solid ${domain.color};">
                            <div class="flex justify-between items-center mb-4">
                                <h4>${domain.name}</h4>
                                <span style="font-weight: 700; color: ${domain.color};">${progress}%</span>
                            </div>
                            <div class="progress mb-4">
                                <div class="progress-bar" style="width: ${progress}%; background: ${domain.color};"></div>
                            </div>
                            <div class="flex gap-4 text-sm text-muted">
                                <span>üìö ${domainData.lessonsCompleted} lessons</span>
                                <span>üéÆ ${domainData.simulationsCompleted} sims</span>
                                <span>üìù ${domainData.quizzesPassed} quizzes</span>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
            
            <div class="card mt-6">
                <h3 class="mb-4">Reset Progress</h3>
                <p class="text-muted mb-4">This will reset all your progress data. This action cannot be undone.</p>
                <button class="btn btn-ghost" onclick="confirmResetProgress()" style="color: var(--danger-main);">
                    üóëÔ∏è Reset All Progress
                </button>
            </div>
        </div>
    `;
}

function showLessons(domainId) {
    const domain = DOMAINS.find(d => d.id === domainId);
    alert(`Lessons for ${domain.name} - Feature coming soon!`);
}

function showFlashcards(domainId) {
    const domain = DOMAINS.find(d => d.id === domainId);
    alert(`Flashcards for ${domain.name} - Feature coming soon!`);
}

function calculateOverallProgress() {
    let total = 0;
    DOMAINS.forEach(domain => {
        total += calculateDomainProgress(domain.id);
    });
    return Math.round(total / DOMAINS.length);
}

function calculateDomainProgress(domainId) {
    const domainData = APP.progress.domains[domainId];
    const domain = DOMAINS.find(d => d.id === domainId);
    
    // Calculate based on completed activities
    const lessonProgress = (domainData.lessonsCompleted / domain.lessons) * 40;
    const simProgress = (domainData.simulationsCompleted / domain.simulations) * 30;
    const quizProgress = (domainData.quizzesPassed / 3) * 30; // Assume 3 quiz attempts needed
    
    return Math.min(100, Math.round(lessonProgress + simProgress + quizProgress));
}

function getTotalSimulationsCompleted() {
    return Object.values(APP.progress.domains).reduce((sum, d) => sum + d.simulationsCompleted, 0);
}

function getTotalQuizzesPassed() {
    return Object.values(APP.progress.domains).reduce((sum, d) => sum + d.quizzesPassed, 0);
}

function saveProgress() {
    localStorage.setItem('securityPlusProgress', JSON.stringify(APP.progress));
}

function loadProgress() {
    const saved = localStorage.getItem('securityPlusProgress');
    if (saved) {
        APP.progress = JSON.parse(saved);
    }
}

function confirmResetProgress() {
    if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
        APP.progress = {
            domains: {
                1: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 },
                2: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 },
                3: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 },
                4: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 },
                5: { lessonsCompleted: 0, quizzesPassed: 0, simulationsCompleted: 0 }
            },
            overallProgress: 0,
            totalScore: 0
        };
        saveProgress();
        showProgress();
    }
}

function updateNav(active) {
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    // Add active class to current
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => {
        if (item.textContent.toLowerCase().includes(active.toLowerCase())) {
            item.classList.add('active');
        }
    });
}

function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// ================================================
// INITIALIZATION
// ================================================

function initApp() {
    console.log('üõ°Ô∏è Initializing Security+ Training Platform...');
    
    // Initialize theme
    initTheme();
    
    // Load saved progress
    loadProgress();
    
    // Populate domains dropdown
    const dropdown = document.getElementById('domains-dropdown');
    if (dropdown) {
        dropdown.innerHTML = DOMAINS.map(domain => `
            <button onclick="showDomainView(${domain.id})">${domain.name}</button>
        `).join('');
    }
    
    // Show dashboard
    showDashboard();
    
    // Mark as initialized
    APP.initialized = true;
    console.log('‚úÖ Platform initialized successfully!');
}

// Start the app when DOM is ready
document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>
